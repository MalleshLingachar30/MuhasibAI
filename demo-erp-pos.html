<!DOCTYPE html>
<html lang="ar" dir="rtl" id="html-root">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مُحاسِب - محاسبة ERP/POS بالذكاء الاصطناعي | ERP/POS AI Accounting</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <!-- PDF Generation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        /* Base Styles from main site */
        .icon { display: inline-flex; align-items: center; justify-content: center; vertical-align: middle; }
        .icon svg { width: 1em; height: 1em; stroke-width: 2; }
        .icon-sm svg { width: 0.875em; height: 0.875em; }
        .icon-lg svg { width: 1.25em; height: 1.25em; }
        .icon-xl svg { width: 2em; height: 2em; }
        .icon-2xl svg { width: 2.5em; height: 2.5em; }
        .icon-3xl svg { width: 3rem; height: 3rem; }
        .icon-4xl svg { width: 4rem; height: 4rem; }
        .icon-emerald { color: #34d399; }
        .icon-purple { color: #a78bfa; }
        .icon-cyan { color: #22d3d1; }
        .icon-white { color: #fff; }
        .icon-amber { color: #fbbf24; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Tajawal', sans-serif; background: #020617; color: #fff; line-height: 1.6; min-height: 100vh; }
        [dir="ltr"] body { font-family: 'Inter', sans-serif; }
        a { text-decoration: none; color: inherit; }
        
        /* Header */
        header { position: fixed; top: 0; width: 100%; background: rgba(2,6,23,0.9); backdrop-filter: blur(8px); z-index: 50; border-bottom: 1px solid #1e293b; }
        .header-inner { display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; max-width: 1400px; margin: 0 auto; }
        .logo { display: flex; align-items: center; gap: 0.5rem; }
        .logo-icon { width: 40px; height: 40px; background: linear-gradient(135deg, #34d399, #22d3d1); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #020617; font-size: 1.25rem; }
        .logo-text { font-size: 1.25rem; font-weight: bold; }
        .header-actions { display: flex; align-items: center; gap: 1rem; }
        .lang-toggle { display: flex; background: #1e293b; border-radius: 8px; padding: 4px; }
        .lang-btn { padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.875rem; font-weight: 500; border: none; cursor: pointer; transition: all 0.3s; background: transparent; color: #94a3b8; }
        .lang-btn.active { background: #10b981; color: #fff; }
        .back-btn { display: flex; align-items: center; gap: 0.5rem; color: #94a3b8; font-size: 0.875rem; transition: color 0.3s; }
        .back-btn:hover { color: #fff; }
        
        /* Main Container */
        .demo-container { padding: 7rem 2rem 3rem; max-width: 1400px; margin: 0 auto; }
        
        /* Page Header */
        .page-header { text-align: center; margin-bottom: 2rem; }
        .page-badge { display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(52,211,153,0.15); border: 1px solid rgba(52,211,153,0.3); border-radius: 50px; padding: 0.5rem 1.25rem; color: #34d399; font-size: 0.875rem; margin-bottom: 1rem; }
        .page-title { font-size: 2rem; font-weight: 800; margin-bottom: 0.75rem; }
        @media(min-width:768px) { .page-title { font-size: 2.5rem; } }
        .gradient-text { background: linear-gradient(to left, #34d399, #22d3d1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .page-subtitle { color: #94a3b8; font-size: 1rem; max-width: 600px; margin: 0 auto; }
        
        /* Demo Flow Container */
        .demo-flow { display: grid; grid-template-columns: 1fr auto 1fr auto 1fr; align-items: stretch; gap: 1rem; margin-top: 2rem; }
        @media(max-width: 1024px) { 
            .demo-flow { grid-template-columns: 1fr; gap: 1.5rem; }
            .flow-arrow { display: none; }
        }
        
        /* Flow Arrows */
        .flow-arrow { display: flex; align-items: center; justify-content: center; padding: 0 0.5rem; }
        .flow-arrow svg { width: 2rem; height: 2rem; color: #475569; transition: color 0.3s; }
        .flow-arrow.active svg { color: #34d399; }
        [dir="ltr"] .flow-arrow { transform: scaleX(-1); }
        
        /* Demo Cards */
        .demo-card { background: linear-gradient(135deg, rgba(30,41,59,0.9), rgba(15,23,42,0.9)); border-radius: 20px; border: 1px solid #1e293b; overflow: hidden; display: flex; flex-direction: column; min-height: 450px; transition: all 0.3s; }
        .demo-card.active { border-color: rgba(52,211,153,0.5); box-shadow: 0 0 40px rgba(52,211,153,0.15); }
        .demo-card.completed { border-color: rgba(52,211,153,0.5); }
        
        .card-header { padding: 1.25rem 1.5rem; border-bottom: 1px solid #1e293b; display: flex; align-items: center; gap: 1rem; }
        .card-icon-wrapper { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .card-icon-wrapper.business { background: linear-gradient(135deg, rgba(52,211,153,0.2), rgba(34,211,209,0.2)); }
        .card-icon-wrapper.ai { background: linear-gradient(135deg, rgba(52,211,153,0.2), rgba(34,211,209,0.2)); }
        .card-icon-wrapper.zatca { background: linear-gradient(135deg, rgba(251,191,36,0.2), rgba(245,158,11,0.2)); }
        .card-title { font-size: 1rem; font-weight: 700; margin-bottom: 0.25rem; }
        .card-label { font-size: 0.75rem; color: #64748b; text-transform: uppercase; letter-spacing: 0.05em; }
        .card-status { margin-right: auto; margin-left: 0; }
        [dir="ltr"] .card-status { margin-left: auto; margin-right: 0; }
        
        .status-badge { display: inline-flex; align-items: center; gap: 0.35rem; padding: 0.25rem 0.75rem; border-radius: 50px; font-size: 0.75rem; font-weight: 500; }
        .status-badge.waiting { background: rgba(100,116,139,0.2); color: #94a3b8; }
        .status-badge.processing { background: rgba(52,211,153,0.2); color: #34d399; }
        .status-badge.success { background: rgba(52,211,153,0.2); color: #34d399; }
        .status-badge.error { background: rgba(248,113,113,0.2); color: #f87171; }
        
        .card-content { flex: 1; padding: 1.5rem; display: flex; flex-direction: column; }
        
        /* Upload Zone */
        .upload-zone { flex: 1; border: 2px dashed #334155; border-radius: 16px; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem; cursor: pointer; transition: all 0.3s; text-align: center; }
        .upload-zone:hover { border-color: #34d399; background: rgba(52,211,153,0.05); }
        .upload-zone.drag-over { border-color: #34d399; background: rgba(52,211,153,0.1); }
        .upload-zone.has-file { border-style: solid; border-color: #34d399; background: rgba(52,211,153,0.05); cursor: default; }
        .upload-icon { font-size: 3rem; margin-bottom: 1rem; color: #64748b; }
        .upload-zone.has-file .upload-icon { color: #34d399; }
        .upload-text { font-size: 0.9rem; color: #94a3b8; margin-bottom: 0.5rem; }
        .upload-hint { font-size: 0.75rem; color: #64748b; }
        .upload-input { display: none; }
        
        /* File Preview */
        .file-preview { display: none; flex: 1; flex-direction: column; }
        .file-preview.show { display: flex; }
        .file-info { display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(51,65,85,0.3); border-radius: 12px; margin-bottom: 1rem; }
        .file-icon { width: 48px; height: 48px; background: rgba(52,211,153,0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center; }
        .file-name { font-size: 0.875rem; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .file-size { font-size: 0.75rem; color: #64748b; }
        .file-remove { margin-right: auto; margin-left: 0; background: none; border: none; color: #64748b; cursor: pointer; padding: 0.5rem; transition: color 0.3s; }
        [dir="ltr"] .file-remove { margin-left: auto; margin-right: 0; }
        .file-remove:hover { color: #f87171; }
        
        .invoice-preview { flex: 1; background: #0f172a; border-radius: 12px; padding: 1rem; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        .invoice-preview img { max-width: 100%; max-height: 200px; border-radius: 8px; object-fit: contain; }
        .invoice-preview .pdf-placeholder { text-align: center; color: #64748b; }
        
        .upload-btn { margin-top: 1rem; background: linear-gradient(to right, #34d399, #22d3d1); border: none; padding: 0.875rem 1.5rem; border-radius: 10px; font-weight: 600; color: #020617; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 0.5rem; width: 100%; }
        .upload-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(52,211,153,0.3); }
        .upload-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
        
        /* AI Agent Center */
        .ai-agent-center { display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .ai-avatar { width: 100px; height: 100px; border-radius: 24px; background: linear-gradient(135deg, #34d399, #22d3d1); display: flex; align-items: center; justify-content: center; font-size: 2.5rem; font-weight: bold; color: #020617; margin-bottom: 1.5rem; position: relative; }
        .ai-avatar::after { content: ''; position: absolute; inset: -4px; border-radius: 28px; border: 2px solid transparent; background: linear-gradient(135deg, #34d399, #22d3d1) border-box; -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0); -webkit-mask-composite: xor; mask-composite: exclude; opacity: 0; animation: pulse-ring 2s ease-out infinite; }
        .ai-agent-center.processing .ai-avatar::after { opacity: 1; }
        
        @keyframes pulse-ring { 0% { transform: scale(1); opacity: 0.5; } 100% { transform: scale(1.2); opacity: 0; } }
        
        .ai-status { font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem; }
        .ai-message { font-size: 0.85rem; color: #94a3b8; margin-bottom: 1.5rem; min-height: 40px; }
        
        /* Processing Steps */
        .processing-steps { width: 100%; }
        .step-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: rgba(51,65,85,0.2); border-radius: 10px; margin-bottom: 0.5rem; font-size: 0.85rem; transition: all 0.3s; }
        .step-item.active { background: rgba(52,211,153,0.15); }
        .step-item.completed { background: rgba(52,211,153,0.1); }
        .step-icon { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; background: rgba(100,116,139,0.3); color: #64748b; flex-shrink: 0; }
        .step-item.active .step-icon { background: rgba(52,211,153,0.3); color: #34d399; }
        .step-item.completed .step-icon { background: rgba(52,211,153,0.3); color: #34d399; }
        .step-text { color: #94a3b8; }
        .step-item.active .step-text { color: #fff; }
        .step-item.completed .step-text { color: #e2e8f0; }
        
        /* Spinner */
        .spinner { width: 16px; height: 16px; border: 2px solid transparent; border-top-color: currentColor; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* ZATCA Section */
        .zatca-content { display: flex; flex-direction: column; gap: 1rem; }
        .zatca-status-box { background: rgba(51,65,85,0.3); border-radius: 12px; padding: 1.25rem; text-align: center; }
        .zatca-logo { width: 80px; height: 80px; background: rgba(251,191,36,0.15); border-radius: 16px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; }
        .zatca-logo img { width: 60px; height: 60px; }
        .zatca-title { font-size: 1rem; font-weight: 600; margin-bottom: 0.25rem; }
        .zatca-subtitle { font-size: 0.8rem; color: #64748b; }
        
        /* Validation Results */
        .validation-result { display: none; flex-direction: column; gap: 0.75rem; }
        .validation-result.show { display: flex; }
        .result-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: rgba(51,65,85,0.2); border-radius: 10px; font-size: 0.85rem; }
        .result-item.success { background: rgba(52,211,153,0.1); }
        .result-icon { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .result-item.success .result-icon { background: rgba(52,211,153,0.3); color: #34d399; }
        
        /* Approved Invoice */
        .approved-invoice { display: none; }
        .approved-invoice.show { display: block; }
        .approved-badge { display: flex; align-items: center; justify-content: center; gap: 0.5rem; background: rgba(52,211,153,0.15); border: 1px solid rgba(52,211,153,0.3); border-radius: 12px; padding: 1rem; margin-bottom: 1rem; }
        .approved-badge span { color: #34d399; font-weight: 600; font-size: 0.9rem; }
        
        .qr-code-box { background: #fff; border-radius: 12px; padding: 1rem; text-align: center; margin-bottom: 1rem; }
        .qr-code { width: 120px; height: 120px; background: linear-gradient(45deg, #000 25%, transparent 25%), linear-gradient(-45deg, #000 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #000 75%), linear-gradient(-45deg, transparent 75%, #000 75%); background-size: 20px 20px; background-position: 0 0, 0 10px, 10px -10px, -10px 0px; margin: 0 auto 0.5rem; border-radius: 8px; }
        .qr-label { font-size: 0.7rem; color: #64748b; }
        
        .invoice-id { background: rgba(51,65,85,0.3); border-radius: 10px; padding: 1rem; }
        .invoice-id-label { font-size: 0.75rem; color: #64748b; margin-bottom: 0.25rem; }
        .invoice-id-value { font-family: 'Courier New', monospace; font-size: 0.8rem; color: #34d399; word-break: break-all; }
        
        .download-btn { margin-top: 1rem; background: linear-gradient(to right, #34d399, #22d3d1); border: none; padding: 0.875rem 1.5rem; border-radius: 10px; font-weight: 600; color: #020617; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 0.5rem; width: 100%; }
        .download-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(52,211,153,0.3); }
        
        /* Customer Delivery */
        .customer-delivery { display: none; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #1e293b; }
        .customer-delivery.show { display: block; }
        .delivery-header { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem; }
        .delivery-icon { width: 40px; height: 40px; background: rgba(52,211,153,0.2); border-radius: 10px; display: flex; align-items: center; justify-content: center; }
        .delivery-title { font-size: 0.9rem; font-weight: 600; }
        .delivery-subtitle { font-size: 0.75rem; color: #64748b; }
        .delivery-options { display: flex; gap: 0.5rem; }
        .delivery-option { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 0.5rem; padding: 1rem; background: rgba(51,65,85,0.3); border-radius: 10px; cursor: pointer; transition: all 0.3s; border: 1px solid transparent; }
        .delivery-option:hover { background: rgba(52,211,153,0.1); border-color: rgba(52,211,153,0.3); }
        .delivery-option span { font-size: 0.75rem; color: #94a3b8; }
        
        /* Reset Button */
        .reset-section { text-align: center; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #1e293b; }
        .reset-btn { background: rgba(51,65,85,0.5); border: 1px solid #334155; padding: 0.75rem 2rem; border-radius: 10px; color: #94a3b8; cursor: pointer; font-size: 0.875rem; transition: all 0.3s; }
        .reset-btn:hover { background: rgba(51,65,85,0.8); color: #fff; }
        
        /* Language */
        .en { display: none; }
        .ar { display: inline; }
        [dir="ltr"] .en { display: inline; }
        [dir="ltr"] .ar { display: none; }
        
        /* ============================================== */
        /* POS CONNECTION STYLES */
        /* ============================================== */
        
        .pos-connection-info { display: flex; flex-direction: column; gap: 1rem; }
        
        .pos-system-card { 
            background: linear-gradient(135deg, rgba(52,211,153,0.15), rgba(34,211,209,0.1)); 
            border: 1px solid rgba(52,211,153,0.3); 
            border-radius: 16px; 
            padding: 1.5rem; 
            text-align: center; 
        }
        .pos-logo { margin-bottom: 0.75rem; }
        .pos-system-name { font-size: 1.25rem; font-weight: 700; color: #34d399; margin-bottom: 0.25rem; }
        .pos-system-type { font-size: 0.8rem; color: #94a3b8; }
        
        .connection-details { display: flex; flex-direction: column; gap: 0.5rem; }
        .connection-item { 
            display: flex; align-items: center; gap: 0.5rem; 
            padding: 0.5rem 0.75rem; 
            background: rgba(51,65,85,0.3); 
            border-radius: 8px; 
            font-size: 0.85rem; 
            color: #94a3b8; 
        }
        .connection-item.success { color: #34d399; }
        .connection-item.success i { color: #34d399; }
        
        .last-sync { 
            display: flex; align-items: center; justify-content: center; gap: 0.5rem; 
            padding: 0.75rem; 
            background: rgba(51,65,85,0.2); 
            border-radius: 8px; 
            font-size: 0.75rem; 
            color: #64748b; 
        }
        
        /* Sales Summary Styles */
        .sales-summary-content { display: flex; flex-direction: column; gap: 0.75rem; }
        .sales-period { 
            text-align: center; 
            font-size: 0.8rem; 
            color: #64748b; 
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        /* Main Total Display */
        .main-total-display {
            display: flex;
            align-items: baseline;
            justify-content: center;
            gap: 0.5rem;
            padding: 1rem 0;
        }
        .main-total-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: #34d399;
            line-height: 1;
            transition: all 0.3s ease;
        }
        .main-total-value.updating {
            transform: scale(1.05);
            color: #22d3ee;
        }
        .main-total-currency {
            font-size: 1rem;
            font-weight: 600;
            color: #64748b;
        }
        
        /* Stats Row */
        .sales-stats-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            padding: 0.75rem;
            background: rgba(51,65,85,0.3);
            border-radius: 10px;
        }
        .stat-item-small {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            color: #94a3b8;
            font-size: 0.85rem;
        }
        .stat-item-small i { color: #64748b; }
        .stat-item-small .stat-num { font-weight: 700; color: #e2e8f0; }
        .stat-item-small.highlight .stat-num { color: #34d399; }
        .stat-item-small.highlight i { color: #34d399; }
        .stat-divider { width: 1px; height: 20px; background: #475569; }
        
        /* Sync Status */
        .sync-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            font-size: 0.75rem;
            color: #34d399;
        }
        .sync-status i { width: 14px; height: 14px; }
        
        /* Legacy grid styles kept for accounting section */
        .sales-stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; }
        .sales-stat-item { 
            background: rgba(51,65,85,0.3); 
            border-radius: 12px; 
            padding: 1rem 0.75rem; 
            text-align: center; 
        }
        .sales-stat-item.highlight { 
            background: rgba(52,211,153,0.15); 
            border: 1px solid rgba(52,211,153,0.3); 
        }
        .sales-stat-item .stat-value { 
            font-size: 1.25rem; 
            font-weight: 700; 
            color: #fff; 
            margin-bottom: 0.25rem; 
        }
        .sales-stat-item.highlight .stat-value { color: #34d399; }
        .sales-stat-item .stat-label { font-size: 0.7rem; color: #64748b; }
        
        .sync-btn { 
            width: 100%; 
            padding: 0.75rem; 
            background: rgba(52,211,153,0.15); 
            border: 1px solid rgba(52,211,153,0.3); 
            border-radius: 10px; 
            color: #34d399; 
            font-size: 0.9rem; 
            font-weight: 600; 
            cursor: pointer; 
            transition: all 0.3s; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 0.5rem; 
        }
        .sync-btn:hover { background: rgba(52,211,153,0.25); }
        .sync-btn.syncing { opacity: 0.7; cursor: not-allowed; }
        .sync-btn.syncing i { animation: spin 1s linear infinite; }
        
        /* Transactions List */
        .transactions-list { 
            display: flex; 
            flex-direction: column; 
            gap: 0.5rem; 
            max-height: 280px; 
            overflow-y: auto; 
            margin-bottom: 1rem; 
        }
        .transaction-item { 
            display: flex; 
            align-items: center; 
            gap: 0.75rem; 
            padding: 0.75rem; 
            background: rgba(51,65,85,0.3); 
            border-radius: 10px; 
            transition: all 0.3s; 
        }
        .transaction-item:hover { background: rgba(51,65,85,0.5); }
        .transaction-icon { 
            width: 36px; 
            height: 36px; 
            background: rgba(52,211,153,0.2); 
            border-radius: 8px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            color: #34d399; 
            flex-shrink: 0; 
        }
        .transaction-details { flex: 1; min-width: 0; }
        .transaction-id { font-size: 0.8rem; font-weight: 600; color: #e2e8f0; }
        .transaction-time { font-size: 0.7rem; color: #64748b; }
        .transaction-amount { text-align: left; }
        [dir="ltr"] .transaction-amount { text-align: right; }
        .transaction-amount .amount { font-size: 0.9rem; font-weight: 600; color: #34d399; }
        .transaction-amount .vat { font-size: 0.65rem; color: #64748b; }
        
        .view-all-btn-wrapper { text-align: center; }
        .view-all-btn { 
            display: inline-flex; 
            align-items: center; 
            gap: 0.5rem; 
            padding: 0.75rem 1.5rem; 
            background: linear-gradient(135deg, #34d399, #22d3d1); 
            border: none; 
            border-radius: 10px; 
            color: #020617; 
            font-size: 0.9rem; 
            font-weight: 600; 
            cursor: pointer; 
            transition: all 0.3s; 
        }
        .view-all-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(52,211,153,0.3); }
        
        /* POS Synced Sales Panel */
        .pos-sales-header { 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            padding: 0.75rem 1rem; 
            background: rgba(52,211,153,0.1); 
            border: 1px solid rgba(52,211,153,0.2); 
            border-radius: 10px; 
            margin-bottom: 1rem; 
        }
        .pos-sales-header .pos-badge { 
            display: flex; 
            align-items: center; 
            gap: 0.5rem; 
            font-size: 0.85rem; 
            color: #34d399; 
            font-weight: 600; 
        }
        .pos-sales-header .sync-info { font-size: 0.75rem; color: #64748b; }
        
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.5s ease forwards; }
        
        /* Mobile Adjustments */
        @media(max-width: 768px) {
            .demo-container { padding: 6rem 1rem 2rem; }
            .demo-card { min-height: auto; }
            .page-title { font-size: 1.75rem; }
        }
        
        /* ============================================== */
        /* ACCOUNTING SECTION STYLES */
        /* ============================================== */
        
        .accounting-section { margin-top: 3rem; animation: fadeIn 0.8s ease forwards; }
        
        /* Section Divider */
        .section-divider { display: flex; align-items: center; gap: 1.5rem; margin-bottom: 2.5rem; }
        .divider-line { flex: 1; height: 1px; background: linear-gradient(to right, transparent, #334155, transparent); }
        .divider-badge { display: flex; align-items: center; gap: 0.5rem; background: linear-gradient(135deg, rgba(52,211,153,0.15), rgba(34,211,209,0.1)); border: 1px solid rgba(52,211,153,0.3); border-radius: 50px; padding: 0.75rem 1.5rem; color: #34d399; font-size: 0.9rem; font-weight: 600; }
        
        .accounting-header { text-align: center; margin-bottom: 2rem; }
        .gradient-text-green { background: linear-gradient(to left, #34d399, #22d3d1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        
        /* Two Column Grid */
        .accounting-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-bottom: 2rem; }
        @media(max-width: 1024px) { .accounting-grid { grid-template-columns: 1fr; } }
        
        /* Panel Styles */
        .accounting-panel { background: linear-gradient(135deg, rgba(30,41,59,0.9), rgba(15,23,42,0.9)); border-radius: 20px; border: 1px solid #1e293b; overflow: hidden; transition: all 0.3s; }
        .accounting-panel:hover { border-color: rgba(52,211,153,0.3); }
        .sales-panel:hover { border-color: rgba(52,211,153,0.5); }
        .expenses-panel:hover { border-color: rgba(251,146,60,0.5); }
        
        .panel-header { padding: 1.25rem 1.5rem; border-bottom: 1px solid #1e293b; display: flex; align-items: center; gap: 1rem; }
        .panel-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .panel-icon.sales { background: linear-gradient(135deg, rgba(52,211,153,0.2), rgba(34,211,209,0.2)); color: #34d399; }
        .panel-icon.expenses { background: linear-gradient(135deg, rgba(251,146,60,0.2), rgba(249,115,22,0.2)); color: #fb923c; }
        .panel-label { font-size: 0.75rem; color: #64748b; text-transform: uppercase; letter-spacing: 0.05em; }
        .panel-title { font-size: 1rem; font-weight: 700; }
        .panel-status { margin-right: auto; margin-left: 0; }
        [dir="ltr"] .panel-status { margin-left: auto; margin-right: 0; }
        
        .panel-content { padding: 1.5rem; }
        
        /* Summary Cards */
        .summary-cards { display: grid; grid-template-columns: repeat(3, 1fr); gap: 0.75rem; margin-bottom: 1.5rem; }
        .summary-card { background: rgba(51,65,85,0.3); border-radius: 12px; padding: 1rem; text-align: center; transition: all 0.3s; }
        .summary-card.highlight { background: rgba(52,211,153,0.15); border: 1px solid rgba(52,211,153,0.3); }
        .summary-icon { color: #64748b; margin-bottom: 0.5rem; }
        .summary-card.highlight .summary-icon { color: #34d399; }
        .summary-value { font-size: 1.25rem; font-weight: 700; color: #fff; }
        .summary-card.highlight .summary-value { color: #34d399; }
        .summary-label { font-size: 0.7rem; color: #64748b; margin-top: 0.25rem; }
        
        /* Invoice List */
        .invoice-list { background: rgba(15,23,42,0.5); border-radius: 12px; padding: 1rem; margin-bottom: 1rem; }
        .list-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; font-size: 0.85rem; color: #94a3b8; }
        .list-count { background: rgba(52,211,153,0.2); color: #34d399; padding: 0.15rem 0.5rem; border-radius: 50px; font-size: 0.75rem; }
        
        .invoice-items { max-height: 200px; overflow-y: auto; }
        .invoice-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: rgba(51,65,85,0.2); border-radius: 10px; margin-bottom: 0.5rem; transition: all 0.3s; }
        .invoice-item:hover { background: rgba(51,65,85,0.4); }
        .invoice-item:last-child { margin-bottom: 0; }
        .invoice-item-icon { width: 36px; height: 36px; background: rgba(52,211,153,0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #34d399; flex-shrink: 0; }
        .invoice-item-details { flex: 1; min-width: 0; }
        .invoice-item-title { font-size: 0.8rem; font-weight: 600; color: #e2e8f0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .invoice-item-meta { font-size: 0.7rem; color: #64748b; }
        .invoice-item-amount { text-align: left; }
        [dir="ltr"] .invoice-item-amount { text-align: right; }
        .invoice-item-amount .amount { font-size: 0.9rem; font-weight: 600; color: #34d399; }
        .invoice-item-amount .amount small { font-size: 0.65rem; color: #64748b; }
        .vat-badge { font-size: 0.65rem; color: #64748b; }
        
        .add-invoice-btn { width: 100%; padding: 0.75rem; background: rgba(52,211,153,0.1); border: 1px dashed rgba(52,211,153,0.3); border-radius: 10px; color: #34d399; font-size: 0.85rem; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 0.5rem; }
        .add-invoice-btn:hover { background: rgba(52,211,153,0.2); border-style: solid; }
        
        /* Sales Bulk Upload */
        .sales-bulk-upload { margin-bottom: 1rem; }
        .sales-upload-zone { 
            background: rgba(15,23,42,0.5); 
            border: 2px dashed rgba(52,211,153,0.3); 
            border-radius: 12px; 
            padding: 1.25rem; 
            text-align: center; 
            cursor: pointer; 
            transition: all 0.3s;
        }
        .sales-upload-zone:hover { border-color: rgba(52,211,153,0.6); background: rgba(52,211,153,0.1); }
        .sales-upload-zone.drag-over { border-color: #34d399; background: rgba(52,211,153,0.15); }
        .sales-upload-zone.has-files { border-style: solid; border-color: #34d399; }
        .sales-upload-icon { margin-bottom: 0.5rem; }
        .sales-upload-text { font-size: 0.85rem; color: #e2e8f0; margin-bottom: 0.25rem; }
        .sales-upload-hint { font-size: 0.75rem; color: #64748b; }
        
        .sales-files-preview { display: none; margin-top: 1rem; }
        .sales-files-preview.show { display: block; }
        .sales-files-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem; font-size: 0.8rem; }
        .sales-files-count { color: #34d399; font-weight: 600; }
        .sales-files-clear { background: none; border: none; color: #64748b; font-size: 0.75rem; cursor: pointer; }
        .sales-files-clear:hover { color: #f87171; }
        .sales-files-list { display: flex; flex-wrap: wrap; gap: 0.5rem; max-height: 100px; overflow-y: auto; }
        .sales-file-tag { display: flex; align-items: center; gap: 0.35rem; background: rgba(52,211,153,0.15); border: 1px solid rgba(52,211,153,0.3); padding: 0.35rem 0.6rem; border-radius: 6px; font-size: 0.75rem; color: #34d399; }
        .sales-file-tag button { background: none; border: none; color: #64748b; cursor: pointer; padding: 0; margin-left: 0.25rem; }
        .sales-file-tag button:hover { color: #f87171; }
        
        .process-sales-btn { 
            width: 100%; 
            margin-top: 0.75rem; 
            padding: 0.75rem; 
            background: linear-gradient(135deg, #34d399, #22d3d1); 
            border: none; 
            border-radius: 10px; 
            color: #020617; 
            font-size: 0.85rem; 
            font-weight: 600; 
            cursor: pointer; 
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .process-sales-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(52,211,153,0.3); }
        .process-sales-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
        
        .sales-divider { display: flex; align-items: center; gap: 0.75rem; margin: 1rem 0; }
        .sales-divider-line { flex: 1; height: 1px; background: #334155; }
        .sales-divider-text { font-size: 0.7rem; color: #64748b; text-transform: uppercase; }
        
        .invoice-empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem 1rem; text-align: center; }
        
        /* Expense Categories */
        .expense-categories { display: flex; flex-direction: column; gap: 0.75rem; margin-bottom: 1rem; }
        .expense-category { background: rgba(15,23,42,0.5); border-radius: 12px; overflow: hidden; border: 1px solid transparent; transition: all 0.3s; }
        .expense-category.active { border-color: rgba(251,146,60,0.3); }
        .expense-category.has-expenses { border-color: rgba(52,211,153,0.3); }
        
        .category-header { display: flex; align-items: center; gap: 0.75rem; padding: 0.875rem 1rem; cursor: pointer; transition: all 0.3s; }
        .category-header:hover { background: rgba(51,65,85,0.3); }
        .category-icon { width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .category-icon.suppliers { background: rgba(96,165,250,0.2); color: #60a5fa; }
        .category-icon.salaries { background: rgba(167,139,250,0.2); color: #a78bfa; }
        .category-icon.rent { background: rgba(251,146,60,0.2); color: #fb923c; }
        .category-icon.misc { background: rgba(148,163,184,0.2); color: #94a3b8; }
        .category-info { flex: 1; }
        .category-title { font-size: 0.85rem; font-weight: 600; color: #e2e8f0; }
        .category-hint { font-size: 0.7rem; color: #64748b; }
        .category-amount { font-size: 0.85rem; font-weight: 600; color: #64748b; transition: color 0.3s; }
        .expense-category.has-expenses .category-amount { color: #34d399; }
        .category-chevron { color: #64748b; transition: transform 0.3s; }
        .expense-category.active .category-chevron { transform: rotate(180deg); }
        
        .category-upload { display: none; padding: 0 1rem 1rem; }
        .expense-category.active .category-upload { display: block; }
        
        .mini-upload-zone { display: flex; align-items: center; justify-content: center; gap: 0.5rem; padding: 0.75rem; background: rgba(51,65,85,0.3); border: 1px dashed #475569; border-radius: 8px; color: #94a3b8; font-size: 0.8rem; cursor: pointer; transition: all 0.3s; }
        .mini-upload-zone:hover { border-color: #fb923c; color: #fb923c; background: rgba(251,146,60,0.1); }
        
        .expense-category input[type="file"] { display: none; }
        
        .uploaded-expenses { margin-top: 0.75rem; display: flex; flex-direction: column; gap: 0.5rem; }
        .uploaded-expense { display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 0.75rem; background: rgba(52,211,153,0.1); border: 1px solid rgba(52,211,153,0.2); border-radius: 8px; font-size: 0.8rem; }
        .uploaded-expense .expense-name { flex: 1; color: #e2e8f0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .uploaded-expense .expense-amount { color: #34d399; font-weight: 600; }
        .uploaded-expense .expense-vat { color: #64748b; font-size: 0.7rem; }
        .uploaded-expense .remove-expense { background: none; border: none; color: #64748b; cursor: pointer; padding: 0.25rem; }
        .uploaded-expense .remove-expense:hover { color: #f87171; }
        
        /* Quick Add Section */
        .quick-add-section { margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #1e293b; }
        .quick-add-label { font-size: 0.75rem; color: #64748b; margin-bottom: 0.75rem; text-align: center; }
        .quick-add-buttons { display: grid; grid-template-columns: repeat(4, 1fr); gap: 0.5rem; }
        .quick-add-btn { display: flex; flex-direction: column; align-items: center; gap: 0.25rem; padding: 0.75rem 0.5rem; background: rgba(51,65,85,0.3); border: 1px solid #334155; border-radius: 10px; color: #94a3b8; font-size: 0.75rem; cursor: pointer; transition: all 0.3s; }
        .quick-add-btn:hover { background: rgba(52,211,153,0.15); border-color: rgba(52,211,153,0.3); color: #34d399; }
        .quick-add-btn span { font-weight: 600; }
        
        /* ============================================== */
        /* AI BULK EXPENSE CATEGORIZER STYLES */
        /* ============================================== */
        
        .bulk-upload-section { 
            background: linear-gradient(135deg, rgba(30,41,59,0.95), rgba(15,23,42,0.95)); 
            border-radius: 24px; 
            border: 2px dashed rgba(52,211,153,0.4); 
            padding: 2rem; 
            margin-bottom: 2rem; 
            transition: all 0.3s;
        }
        .bulk-upload-section:hover { border-color: rgba(52,211,153,0.7); }
        .bulk-upload-section.processing { border-style: solid; border-color: rgba(52,211,153,0.5); }
        .bulk-upload-section.completed { border-style: solid; border-color: rgba(52,211,153,0.7); background: linear-gradient(135deg, rgba(30,41,59,0.95), rgba(5,150,105,0.1)); }
        
        .bulk-header { display: flex; align-items: center; gap: 1.5rem; margin-bottom: 1.5rem; flex-wrap: wrap; }
        .bulk-icon-wrapper { width: 72px; height: 72px; border-radius: 20px; background: linear-gradient(135deg, rgba(52,211,153,0.3), rgba(34,211,209,0.2)); display: flex; align-items: center; justify-content: center; flex-shrink: 0; position: relative; }
        .bulk-icon-wrapper::after { content: ''; position: absolute; inset: -3px; border-radius: 23px; border: 2px solid rgba(52,211,153,0.3); animation: pulse-ring 2s ease-out infinite; }
        .bulk-upload-section.processing .bulk-icon-wrapper::after { border-color: rgba(52,211,153,0.5); }
        .bulk-upload-section.completed .bulk-icon-wrapper { background: linear-gradient(135deg, rgba(52,211,153,0.3), rgba(34,211,209,0.2)); }
        .bulk-header-content { flex: 1; min-width: 200px; }
        .bulk-title { font-size: 1.25rem; font-weight: 700; color: #fff; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.75rem; }
        .bulk-title .ai-badge { background: linear-gradient(135deg, #34d399, #22d3d1); padding: 0.25rem 0.75rem; border-radius: 50px; font-size: 0.7rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; }
        .bulk-subtitle { color: #94a3b8; font-size: 0.9rem; }
        
        .bulk-upload-zone { 
            background: rgba(15,23,42,0.5); 
            border: 2px dashed #475569; 
            border-radius: 16px; 
            padding: 2.5rem; 
            text-align: center; 
            cursor: pointer; 
            transition: all 0.3s;
            margin-bottom: 1.5rem;
        }
        .bulk-upload-zone:hover { border-color: #34d399; background: rgba(52,211,153,0.1); }
        .bulk-upload-zone.drag-over { border-color: #34d399; background: rgba(52,211,153,0.15); transform: scale(1.01); }
        .bulk-upload-zone.has-files { border-style: solid; border-color: #34d399; background: rgba(52,211,153,0.1); }
        
        .bulk-upload-icon { font-size: 3.5rem; margin-bottom: 1rem; }
        .bulk-upload-icon i { color: #64748b; }
        .bulk-upload-zone:hover .bulk-upload-icon i { color: #34d399; }
        .bulk-upload-zone.has-files .bulk-upload-icon i { color: #34d399; }
        
        .bulk-upload-text { font-size: 1rem; color: #e2e8f0; margin-bottom: 0.5rem; font-weight: 500; }
        .bulk-upload-hint { font-size: 0.85rem; color: #64748b; }
        .bulk-upload-formats { display: flex; gap: 0.5rem; justify-content: center; margin-top: 1rem; flex-wrap: wrap; }
        .format-badge { background: rgba(51,65,85,0.5); padding: 0.35rem 0.75rem; border-radius: 6px; font-size: 0.75rem; color: #94a3b8; }
        
        /* File List Preview */
        .bulk-files-preview { display: none; margin-bottom: 1.5rem; }
        .bulk-files-preview.show { display: block; }
        .files-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-bottom: 0.75rem; border-bottom: 1px solid #334155; }
        .files-count { display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; color: #e2e8f0; }
        .files-count .count-badge { background: rgba(52,211,153,0.2); color: #34d399; padding: 0.25rem 0.75rem; border-radius: 50px; font-weight: 600; }
        .files-clear { background: none; border: none; color: #64748b; font-size: 0.85rem; cursor: pointer; display: flex; align-items: center; gap: 0.35rem; transition: color 0.3s; }
        .files-clear:hover { color: #f87171; }
        
        .files-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 0.75rem; max-height: 200px; overflow-y: auto; padding: 0.25rem; }
        .file-chip { display: flex; align-items: center; gap: 0.5rem; background: rgba(51,65,85,0.4); border: 1px solid #475569; border-radius: 10px; padding: 0.6rem 0.75rem; font-size: 0.8rem; }
        .file-chip-icon { color: #34d399; flex-shrink: 0; }
        .file-chip-name { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #e2e8f0; }
        .file-chip-remove { background: none; border: none; color: #64748b; cursor: pointer; padding: 0.25rem; transition: color 0.3s; }
        .file-chip-remove:hover { color: #f87171; }
        
        /* AI Categorization Button */
        .categorize-btn { 
            width: 100%; 
            background: linear-gradient(135deg, #34d399, #22d3d1); 
            border: none; 
            padding: 1rem 2rem; 
            border-radius: 14px; 
            font-size: 1rem; 
            font-weight: 700; 
            color: #020617; 
            cursor: pointer; 
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }
        .categorize-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(52,211,153,0.4); }
        .categorize-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; box-shadow: none; }
        .categorize-btn.processing { background: linear-gradient(135deg, #34d399, #22d3d1); }
        
        /* AI Processing Animation */
        .ai-categorization-engine { display: none; margin-top: 2rem; }
        .ai-categorization-engine.show { display: block; animation: fadeIn 0.5s ease; }
        
        .engine-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem; }
        .engine-avatar { width: 60px; height: 60px; border-radius: 16px; background: linear-gradient(135deg, #34d399, #22d3d1); display: flex; align-items: center; justify-content: center; font-weight: bold; color: #020617; font-size: 1.5rem; position: relative; }
        .engine-avatar-ring { position: absolute; inset: -5px; border-radius: 20px; border: 2px solid #34d399; animation: pulse-ring 1.2s ease-out infinite; }
        .engine-status { flex: 1; }
        .engine-status-text { font-size: 1.1rem; font-weight: 600; color: #34d399; margin-bottom: 0.25rem; }
        .engine-status-detail { font-size: 0.85rem; color: #94a3b8; }
        
        /* Processing Steps */
        .categorization-steps { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        @media(max-width: 768px) { .categorization-steps { grid-template-columns: repeat(2, 1fr); } }
        .cat-step { background: rgba(51,65,85,0.3); border-radius: 12px; padding: 1rem; text-align: center; transition: all 0.3s; border: 1px solid transparent; }
        .cat-step.active { background: rgba(52,211,153,0.15); border-color: rgba(52,211,153,0.3); }
        .cat-step.completed { background: rgba(52,211,153,0.1); border-color: rgba(52,211,153,0.3); }
        .cat-step-icon { width: 40px; height: 40px; border-radius: 10px; background: rgba(100,116,139,0.3); display: flex; align-items: center; justify-content: center; margin: 0 auto 0.75rem; color: #64748b; transition: all 0.3s; }
        .cat-step.active .cat-step-icon { background: rgba(52,211,153,0.3); color: #34d399; }
        .cat-step.completed .cat-step-icon { background: rgba(52,211,153,0.3); color: #34d399; }
        .cat-step-label { font-size: 0.8rem; color: #94a3b8; }
        .cat-step.active .cat-step-label { color: #e2e8f0; }
        .cat-step.completed .cat-step-label { color: #34d399; }
        
        /* Categorization Results */
        .categorization-results { display: none; animation: fadeIn 0.5s ease; }
        .categorization-results.show { display: block; }
        
        .results-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.25rem; flex-wrap: wrap; gap: 1rem; }
        .results-title { display: flex; align-items: center; gap: 0.75rem; font-size: 1rem; font-weight: 600; color: #34d399; }
        .results-summary { display: flex; gap: 0.5rem; flex-wrap: wrap; }
        .result-tag { display: flex; align-items: center; gap: 0.35rem; background: rgba(51,65,85,0.4); padding: 0.4rem 0.75rem; border-radius: 8px; font-size: 0.8rem; }
        .result-tag.suppliers { color: #60a5fa; border-left: 3px solid #60a5fa; }
        .result-tag.salaries { color: #a78bfa; border-left: 3px solid #a78bfa; }
        .result-tag.rent { color: #fb923c; border-left: 3px solid #fb923c; }
        .result-tag.misc { color: #94a3b8; border-left: 3px solid #94a3b8; }
        [dir="ltr"] .result-tag { border-left: none; border-right: 3px solid; }
        [dir="ltr"] .result-tag.suppliers { border-right-color: #60a5fa; }
        [dir="ltr"] .result-tag.salaries { border-right-color: #a78bfa; }
        [dir="ltr"] .result-tag.rent { border-right-color: #fb923c; }
        [dir="ltr"] .result-tag.misc { border-right-color: #94a3b8; }
        
        .results-categories { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        @media(max-width: 768px) { .results-categories { grid-template-columns: 1fr; } }
        
        .result-category { background: rgba(15,23,42,0.5); border-radius: 14px; padding: 1rem; border: 1px solid #334155; transition: all 0.3s; }
        .result-category:hover { border-color: rgba(52,211,153,0.3); }
        .result-category-header { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.75rem; }
        .result-cat-icon { width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .result-cat-icon.suppliers { background: rgba(96,165,250,0.2); color: #60a5fa; }
        .result-cat-icon.salaries { background: rgba(167,139,250,0.2); color: #a78bfa; }
        .result-cat-icon.rent { background: rgba(251,146,60,0.2); color: #fb923c; }
        .result-cat-icon.misc { background: rgba(148,163,184,0.2); color: #94a3b8; }
        .result-cat-title { flex: 1; font-size: 0.9rem; font-weight: 600; color: #e2e8f0; }
        .result-cat-count { background: rgba(52,211,153,0.2); color: #34d399; padding: 0.2rem 0.6rem; border-radius: 50px; font-size: 0.75rem; font-weight: 600; }
        
        .result-cat-items { display: flex; flex-direction: column; gap: 0.5rem; max-height: 150px; overflow-y: auto; }
        .result-cat-item { display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem 0.75rem; background: rgba(51,65,85,0.3); border-radius: 8px; font-size: 0.8rem; }
        .result-cat-item-name { flex: 1; color: #e2e8f0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .result-cat-item-amount { color: #34d399; font-weight: 600; }
        .result-cat-item-vat { color: #64748b; font-size: 0.7rem; }
        
        .result-cat-total { display: flex; justify-content: space-between; padding-top: 0.75rem; margin-top: 0.75rem; border-top: 1px solid #334155; font-size: 0.85rem; }
        .result-cat-total-label { color: #94a3b8; }
        .result-cat-total-value { color: #34d399; font-weight: 700; }
        
        .result-category.empty { opacity: 0.5; }
        .result-category.empty .result-cat-items { display: none; }
        .empty-message { color: #64748b; font-size: 0.8rem; text-align: center; padding: 1rem; display: none; }
        .result-category.empty .empty-message { display: block; }
        
        .result-cat-item-info { flex: 1; min-width: 0; }
        .result-cat-item-file { display: block; font-size: 0.7rem; color: #64748b; margin-top: 2px; }
        .demo-badge { font-size: 0.6rem; background: rgba(245,158,11,0.2); color: #f59e0b; padding: 2px 6px; border-radius: 4px; margin-left: 0.5rem; }
        
        /* Apply Button */
        .apply-results-btn { 
            width: 100%; 
            background: linear-gradient(135deg, #34d399, #22d3d1); 
            border: none; 
            padding: 1rem 2rem; 
            border-radius: 14px; 
            font-size: 1rem; 
            font-weight: 700; 
            color: #020617; 
            cursor: pointer; 
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }
        .apply-results-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(52,211,153,0.4); }
        
        /* Success Animation */
        .categorization-success { display: none; text-align: center; padding: 2rem; animation: fadeIn 0.5s ease; }
        .categorization-success.show { display: block; }
        .success-icon { width: 80px; height: 80px; border-radius: 50%; background: linear-gradient(135deg, rgba(52,211,153,0.2), rgba(34,211,209,0.1)); display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; }
        .success-title { font-size: 1.25rem; font-weight: 700; color: #34d399; margin-bottom: 0.5rem; }
        .success-message { color: #94a3b8; font-size: 0.9rem; }
        
        /* AI Expense Processor */
        .ai-expense-processor { background: linear-gradient(135deg, rgba(52,211,153,0.1), rgba(34,211,209,0.05)); border: 1px solid rgba(52,211,153,0.3); border-radius: 16px; padding: 1.5rem; margin-bottom: 2rem; }
        .processor-content { display: flex; align-items: center; justify-content: center; gap: 1rem; }
        .processor-avatar { width: 50px; height: 50px; background: linear-gradient(135deg, #34d399, #22d3d1); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #020617; font-size: 1.25rem; position: relative; }
        .processor-ring { position: absolute; inset: -4px; border-radius: 16px; border: 2px solid #34d399; animation: pulse-ring 1.5s ease-out infinite; }
        .processor-text { font-size: 1rem; color: #34d399; font-weight: 500; }
        
        /* Reconciliation Section */
        .reconciliation-section { background: linear-gradient(135deg, rgba(30,41,59,0.95), rgba(15,23,42,0.95)); border-radius: 24px; border: 1px solid #1e293b; padding: 2rem; }
        .reconciliation-header { text-align: center; margin-bottom: 1.5rem; }
        .recon-badge { display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(52,211,153,0.15); border: 1px solid rgba(52,211,153,0.3); border-radius: 50px; padding: 0.5rem 1.25rem; color: #34d399; font-size: 0.85rem; font-weight: 600; }
        
        /* VAT Reconciliation Cards */
        .vat-reconciliation { display: flex; align-items: center; justify-content: center; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap; }
        .vat-card { background: rgba(51,65,85,0.3); border-radius: 16px; padding: 1.25rem 1.5rem; text-align: center; min-width: 140px; flex: 1; max-width: 200px; transition: all 0.3s; }
        .vat-card.output { border: 1px solid rgba(52,211,153,0.3); }
        .vat-card.input { border: 1px solid rgba(251,146,60,0.3); }
        .vat-card.net { border: 1px solid rgba(167,139,250,0.3); background: rgba(167,139,250,0.1); }
        .vat-card.net.refund { border-color: rgba(52,211,153,0.5); background: rgba(52,211,153,0.15); }
        .vat-card-header { display: flex; align-items: center; justify-content: center; gap: 0.5rem; margin-bottom: 0.75rem; font-size: 0.8rem; color: #94a3b8; }
        .vat-card.output .vat-card-header { color: #34d399; }
        .vat-card.input .vat-card-header { color: #fb923c; }
        .vat-card.net .vat-card-header { color: #a78bfa; }
        .vat-card-value { font-size: 1.5rem; font-weight: 700; color: #fff; }
        .vat-card.output .vat-card-value { color: #34d399; }
        .vat-card.input .vat-card-value { color: #fb923c; }
        .vat-card.net .vat-card-value { color: #a78bfa; }
        .vat-card.net.refund .vat-card-value { color: #34d399; }
        .vat-card-label { font-size: 0.7rem; color: #64748b; margin-top: 0.5rem; }
        
        .vat-operator { font-size: 1.5rem; font-weight: bold; color: #64748b; padding: 0 0.5rem; }
        
        /* Financial Summary */
        .financial-summary { margin-bottom: 2rem; }
        .summary-title { display: flex; align-items: center; justify-content: center; gap: 0.5rem; font-size: 1rem; color: #e2e8f0; margin-bottom: 1.25rem; }
        
        .pnl-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        @media(max-width: 768px) { .pnl-grid { grid-template-columns: repeat(2, 1fr); } }
        .pnl-item { background: rgba(51,65,85,0.3); border-radius: 12px; padding: 1rem; text-align: center; }
        .pnl-item.revenue { border-bottom: 3px solid #34d399; }
        .pnl-item.expenses { border-bottom: 3px solid #fb923c; }
        .pnl-item.profit { border-bottom: 3px solid #a78bfa; }
        .pnl-item.profit.loss { border-bottom-color: #f87171; }
        .pnl-item.margin { border-bottom: 3px solid #22d3d1; }
        .pnl-label { font-size: 0.75rem; color: #94a3b8; margin-bottom: 0.5rem; }
        .pnl-value { font-size: 1.25rem; font-weight: 700; }
        .pnl-item.revenue .pnl-value { color: #34d399; }
        .pnl-item.expenses .pnl-value { color: #fb923c; }
        .pnl-item.profit .pnl-value { color: #a78bfa; }
        .pnl-item.profit.loss .pnl-value { color: #f87171; }
        .pnl-item.margin .pnl-value { color: #22d3d1; }
        
        /* Expense Breakdown */
        .expense-breakdown { background: rgba(15,23,42,0.5); border-radius: 12px; padding: 1.25rem; }
        .breakdown-title { display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem; color: #94a3b8; margin-bottom: 1rem; font-weight: 600; }
        .breakdown-bars { display: flex; flex-direction: column; gap: 0.75rem; }
        .breakdown-item { display: grid; grid-template-columns: 80px 1fr 80px; align-items: center; gap: 1rem; }
        .breakdown-label { font-size: 0.8rem; color: #94a3b8; }
        .breakdown-bar { height: 8px; background: rgba(51,65,85,0.5); border-radius: 4px; overflow: hidden; }
        .breakdown-fill { height: 100%; border-radius: 4px; transition: width 0.5s ease; }
        .breakdown-fill.suppliers { background: linear-gradient(to right, #3b82f6, #60a5fa); }
        .breakdown-fill.salaries { background: linear-gradient(to right, #8b5cf6, #a78bfa); }
        .breakdown-fill.rent { background: linear-gradient(to right, #f97316, #fb923c); }
        .breakdown-fill.misc { background: linear-gradient(to right, #64748b, #94a3b8); }
        .breakdown-value { font-size: 0.8rem; color: #e2e8f0; text-align: left; }
        [dir="ltr"] .breakdown-value { text-align: right; }
        
        /* Report Actions */
        .report-actions { display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; }
        .report-btn { display: flex; align-items: center; gap: 0.5rem; padding: 1rem 2rem; border-radius: 12px; font-size: 0.95rem; font-weight: 600; cursor: pointer; transition: all 0.3s; border: none; }
        .report-btn:not(.secondary) { background: linear-gradient(to right, #34d399, #22d3d1); color: #020617; }
        .report-btn:not(.secondary):hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(52,211,153,0.35); }
        .report-btn.secondary { background: rgba(51,65,85,0.5); border: 1px solid #475569; color: #94a3b8; }
        .report-btn.secondary:hover { background: rgba(51,65,85,0.8); color: #fff; }
        
        @media(max-width: 768px) {
            .summary-cards { grid-template-columns: 1fr; }
            .vat-reconciliation { flex-direction: column; }
            .vat-card { max-width: 100%; }
            .vat-operator { transform: rotate(90deg); padding: 0.5rem 0; }
            .quick-add-buttons { grid-template-columns: repeat(2, 1fr); }
            .breakdown-item { grid-template-columns: 60px 1fr 60px; gap: 0.5rem; }
        }
        
        /* ============================================== */
        /* BUSINESS ALERTS SECTION STYLES */
        /* ============================================== */
        
        .alerts-section { margin-top: 3rem; animation: fadeIn 0.8s ease forwards; }
        
        .alerts-header { text-align: center; margin-bottom: 2rem; }
        .alerts-header .page-subtitle { max-width: 700px; }
        
        /* Alert Categories Grid */
        .alerts-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1.5rem; margin-bottom: 2rem; }
        @media(max-width: 1024px) { .alerts-grid { grid-template-columns: 1fr; } }
        
        /* Alert Panel */
        .alert-panel { background: linear-gradient(135deg, rgba(30,41,59,0.9), rgba(15,23,42,0.9)); border-radius: 20px; border: 1px solid #1e293b; overflow: hidden; transition: all 0.3s; }
        .alert-panel:hover { border-color: rgba(52,211,153,0.3); }
        .alert-panel.financial:hover { border-color: rgba(52,211,153,0.5); }
        .alert-panel.regulatory:hover { border-color: rgba(251,191,36,0.5); }
        
        .alert-panel-header { padding: 1.25rem 1.5rem; border-bottom: 1px solid #1e293b; display: flex; align-items: center; gap: 1rem; }
        .alert-panel-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .alert-panel-icon.financial { background: linear-gradient(135deg, rgba(52,211,153,0.2), rgba(34,211,209,0.2)); color: #34d399; }
        .alert-panel-icon.regulatory { background: linear-gradient(135deg, rgba(251,191,36,0.2), rgba(245,158,11,0.2)); color: #fbbf24; }
        .alert-panel-label { font-size: 0.75rem; color: #64748b; text-transform: uppercase; letter-spacing: 0.05em; }
        .alert-panel-title { font-size: 1rem; font-weight: 700; }
        .alert-panel-count { margin-right: auto; margin-left: 0; display: flex; align-items: center; gap: 0.5rem; }
        [dir="ltr"] .alert-panel-count { margin-left: auto; margin-right: 0; }
        .alert-count-badge { display: inline-flex; align-items: center; justify-content: center; min-width: 24px; height: 24px; border-radius: 50px; font-size: 0.75rem; font-weight: 600; padding: 0 0.5rem; }
        .alert-count-badge.urgent { background: rgba(239,68,68,0.2); color: #ef4444; }
        .alert-count-badge.warning { background: rgba(251,191,36,0.2); color: #fbbf24; }
        .alert-count-badge.ok { background: rgba(52,211,153,0.2); color: #34d399; }
        
        .alert-panel-content { padding: 1rem; max-height: 400px; overflow-y: auto; }
        
        /* Alert Item */
        .alert-item { display: flex; align-items: flex-start; gap: 0.75rem; padding: 1rem; background: rgba(51,65,85,0.2); border-radius: 12px; margin-bottom: 0.75rem; transition: all 0.3s; border: 1px solid transparent; cursor: pointer; }
        .alert-item:last-child { margin-bottom: 0; }
        .alert-item:hover { background: rgba(51,65,85,0.4); }
        .alert-item.urgent { border-color: rgba(239,68,68,0.3); background: rgba(239,68,68,0.1); }
        .alert-item.warning { border-color: rgba(251,191,36,0.3); background: rgba(251,191,36,0.05); }
        .alert-item.completed { opacity: 0.6; }
        .alert-item.completed .alert-item-title { text-decoration: line-through; }
        
        .alert-item-icon { width: 40px; height: 40px; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .alert-item-icon.vat { background: rgba(167,139,250,0.2); color: #a78bfa; }
        .alert-item-icon.electricity { background: rgba(251,191,36,0.2); color: #fbbf24; }
        .alert-item-icon.rent { background: rgba(52,211,153,0.2); color: #34d399; }
        .alert-item-icon.salary { background: rgba(59,130,246,0.2); color: #3b82f6; }
        .alert-item-icon.labor { background: rgba(236,72,153,0.2); color: #ec4899; }
        .alert-item-icon.internet { background: rgba(6,182,212,0.2); color: #06b6d4; }
        .alert-item-icon.municipality { background: rgba(251,146,60,0.2); color: #fb923c; }
        .alert-item-icon.cr { background: rgba(139,92,246,0.2); color: #8b5cf6; }
        .alert-item-icon.gosi { background: rgba(34,197,94,0.2); color: #22c55e; }
        .alert-item-icon.other { background: rgba(148,163,184,0.2); color: #94a3b8; }
        
        .alert-item-content { flex: 1; min-width: 0; }
        .alert-item-title { font-size: 0.9rem; font-weight: 600; color: #e2e8f0; margin-bottom: 0.25rem; }
        .alert-item-desc { font-size: 0.75rem; color: #64748b; margin-bottom: 0.5rem; }
        .alert-item-meta { display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap; }
        
        .alert-due-date { display: inline-flex; align-items: center; gap: 0.35rem; font-size: 0.75rem; padding: 0.25rem 0.5rem; border-radius: 6px; background: rgba(51,65,85,0.5); color: #94a3b8; }
        .alert-due-date.urgent { background: rgba(239,68,68,0.2); color: #ef4444; }
        .alert-due-date.warning { background: rgba(251,191,36,0.2); color: #fbbf24; }
        .alert-due-date.ok { background: rgba(52,211,153,0.2); color: #34d399; }
        
        .alert-frequency { display: inline-flex; align-items: center; gap: 0.35rem; font-size: 0.7rem; color: #64748b; }
        
        .alert-item-actions { display: flex; flex-direction: column; gap: 0.5rem; align-items: flex-end; }
        .alert-action-btn { display: flex; align-items: center; justify-content: center; width: 32px; height: 32px; border-radius: 8px; border: none; cursor: pointer; transition: all 0.3s; }
        .alert-action-btn.complete { background: rgba(52,211,153,0.2); color: #34d399; }
        .alert-action-btn.complete:hover { background: rgba(52,211,153,0.4); }
        .alert-action-btn.remind { background: rgba(59,130,246,0.2); color: #3b82f6; }
        .alert-action-btn.remind:hover { background: rgba(59,130,246,0.4); }
        .alert-item.completed .alert-action-btn.complete { background: #34d399; color: #020617; }
        
        /* Alert Summary Stats */
        .alert-summary { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; margin-bottom: 2rem; }
        @media(max-width: 768px) { .alert-summary { grid-template-columns: repeat(2, 1fr); } }
        
        .alert-stat { background: linear-gradient(135deg, rgba(30,41,59,0.9), rgba(15,23,42,0.9)); border-radius: 16px; border: 1px solid #1e293b; padding: 1.25rem; text-align: center; transition: all 0.3s; }
        .alert-stat:hover { border-color: rgba(52,211,153,0.3); }
        .alert-stat-icon { margin-bottom: 0.75rem; color: #64748b; }
        .alert-stat.urgent .alert-stat-icon { color: #ef4444; }
        .alert-stat.warning .alert-stat-icon { color: #fbbf24; }
        .alert-stat.upcoming .alert-stat-icon { color: #3b82f6; }
        .alert-stat.completed .alert-stat-icon { color: #34d399; }
        .alert-stat-value { font-size: 1.75rem; font-weight: 700; color: #fff; margin-bottom: 0.25rem; }
        .alert-stat.urgent .alert-stat-value { color: #ef4444; }
        .alert-stat.warning .alert-stat-value { color: #fbbf24; }
        .alert-stat.upcoming .alert-stat-value { color: #3b82f6; }
        .alert-stat.completed .alert-stat-value { color: #34d399; }
        .alert-stat-label { font-size: 0.75rem; color: #64748b; }
        
        /* Add Alert Button */
        .add-alert-section { text-align: center; padding: 1.5rem; background: rgba(51,65,85,0.2); border-radius: 16px; border: 1px dashed #334155; margin-top: 1rem; }
        .add-alert-btn { display: inline-flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1.5rem; background: linear-gradient(135deg, #34d399, #22d3d1); border: none; border-radius: 10px; color: #020617; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .add-alert-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(52,211,153,0.3); }
        
        /* Calendar Preview */
        .alert-calendar-preview { background: linear-gradient(135deg, rgba(30,41,59,0.9), rgba(15,23,42,0.9)); border-radius: 20px; border: 1px solid #1e293b; padding: 1.5rem; margin-top: 2rem; }
        .calendar-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem; }
        .calendar-title { display: flex; align-items: center; gap: 0.75rem; font-size: 1rem; font-weight: 600; }
        .calendar-title-icon { width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, rgba(139,92,246,0.2), rgba(167,139,250,0.2)); display: flex; align-items: center; justify-content: center; color: #a78bfa; }
        .calendar-nav { display: flex; gap: 0.5rem; }
        .calendar-nav-btn { width: 32px; height: 32px; border-radius: 8px; border: 1px solid #334155; background: transparent; color: #94a3b8; cursor: pointer; transition: all 0.3s; display: flex; align-items: center; justify-content: center; }
        .calendar-nav-btn:hover { border-color: #34d399; color: #34d399; }
        
        .calendar-days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 0.5rem; }
        .calendar-day-header { text-align: center; font-size: 0.7rem; color: #64748b; padding: 0.5rem; font-weight: 600; }
        .calendar-day { aspect-ratio: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 8px; font-size: 0.85rem; color: #94a3b8; background: rgba(51,65,85,0.2); cursor: pointer; transition: all 0.3s; position: relative; }
        .calendar-day:hover { background: rgba(51,65,85,0.4); }
        .calendar-day.today { background: rgba(52,211,153,0.2); color: #34d399; border: 1px solid rgba(52,211,153,0.3); }
        .calendar-day.has-alert { position: relative; }
        .calendar-day.has-alert::after { content: ''; position: absolute; bottom: 4px; width: 6px; height: 6px; border-radius: 50%; }
        .calendar-day.has-urgent::after { background: #ef4444; }
        .calendar-day.has-warning::after { background: #fbbf24; }
        .calendar-day.has-normal::after { background: #3b82f6; }
        .calendar-day.other-month { opacity: 0.4; }
        
        /* Calendar Tooltip */
        .calendar-tooltip { position: absolute; bottom: 100%; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, rgba(30,41,59,0.98), rgba(15,23,42,0.98)); border: 1px solid rgba(52,211,153,0.3); border-radius: 12px; padding: 0.75rem; min-width: 180px; max-width: 220px; z-index: 100; opacity: 0; visibility: hidden; transition: all 0.3s ease; pointer-events: none; box-shadow: 0 10px 40px rgba(0,0,0,0.4); margin-bottom: 8px; }
        .calendar-tooltip::before { content: ''; position: absolute; bottom: -6px; left: 50%; transform: translateX(-50%) rotate(45deg); width: 12px; height: 12px; background: rgba(15,23,42,0.98); border-right: 1px solid rgba(52,211,153,0.3); border-bottom: 1px solid rgba(52,211,153,0.3); }
        .calendar-day:hover .calendar-tooltip { opacity: 1; visibility: visible; }
        .tooltip-title { font-size: 0.7rem; color: #64748b; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 0.5rem; text-align: center; }
        .tooltip-alert { display: flex; align-items: center; gap: 0.5rem; padding: 0.4rem 0; border-bottom: 1px solid rgba(51,65,85,0.5); }
        .tooltip-alert:last-child { border-bottom: none; }
        .tooltip-alert-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
        .tooltip-alert-dot.urgent { background: #ef4444; }
        .tooltip-alert-dot.warning { background: #fbbf24; }
        .tooltip-alert-dot.ok { background: #3b82f6; }
        .tooltip-alert-text { font-size: 0.75rem; color: #e2e8f0; line-height: 1.3; }
        .tooltip-alert-type { font-size: 0.65rem; color: #64748b; }
        
        /* Notification Settings */
        .notification-settings { background: linear-gradient(135deg, rgba(30,41,59,0.9), rgba(15,23,42,0.9)); border-radius: 20px; border: 1px solid #1e293b; padding: 1.5rem; margin-top: 1.5rem; }
        .notification-header { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem; }
        .notification-icon { width: 40px; height: 40px; border-radius: 10px; background: linear-gradient(135deg, rgba(59,130,246,0.2), rgba(96,165,250,0.2)); display: flex; align-items: center; justify-content: center; color: #3b82f6; }
        .notification-title { font-size: 1rem; font-weight: 600; }
        .notification-options { display: flex; gap: 1rem; flex-wrap: wrap; }
        .notification-option { display: flex; align-items: center; gap: 0.5rem; padding: 0.75rem 1rem; background: rgba(51,65,85,0.3); border-radius: 10px; cursor: pointer; transition: all 0.3s; border: 1px solid transparent; }
        .notification-option:hover { background: rgba(51,65,85,0.5); }
        .notification-option.active { border-color: rgba(52,211,153,0.5); background: rgba(52,211,153,0.1); }
        .notification-option i { color: #64748b; }
        .notification-option.active i { color: #34d399; }
        .notification-option span { font-size: 0.85rem; color: #94a3b8; }
        .notification-option.active span { color: #e2e8f0; }
        
        @media(max-width: 768px) {
            .alert-summary { grid-template-columns: 1fr 1fr; }
            .calendar-days { gap: 0.25rem; }
            .calendar-day { font-size: 0.75rem; }
        }
    </style>
</head>
<body>

<header>
    <div class="header-inner">
        <div class="logo">
            <div class="logo-icon">م</div>
            <span class="logo-text">Muhasib</span>
        </div>
        <div class="header-actions">
            <a href="index.html" class="back-btn">
                <i data-lucide="arrow-right" class="icon"></i>
                <span class="ar">الرجوع للرئيسية</span>
                <span class="en">Back to Home</span>
            </a>
            <div class="lang-toggle">
                <button class="lang-btn active" id="btn-ar" onclick="setLang('ar')">عربي</button>
                <button class="lang-btn" id="btn-en" onclick="setLang('en')">EN</button>
            </div>
        </div>
    </div>
</header>

<main class="demo-container">
    <!-- Page Header -->
    <div class="page-header">
        <div class="page-badge">
            <i data-lucide="store" class="icon icon-sm"></i>
            <span class="ar">محاسبة ذكية لأنظمة ERP/POS</span>
            <span class="en">ERP/POS AI Accounting</span>
        </div>
        <h1 class="page-title">
            <span class="gradient-text"><span class="ar">محاسبة ذكية لعملاء ERP/POS</span><span class="en">AI Accounting for ERP/POS Customers</span></span>
        </h1>
        <p class="page-subtitle">
            <span class="ar">نظام POS يتولى المبيعات، ونحن نتولى الباقي - تتبع التكاليف، هوامش الربح، وتسوية الضريبة تلقائياً</span>
            <span class="en">Your POS handles sales, we handle the rest - cost tracking, profit margins, and automatic VAT reconciliation</span>
        </p>
    </div>
    
    <!-- POS/ERP Integration Flow -->
    <div class="demo-flow">
        <!-- Card 1: POS Connection -->
        <div class="demo-card completed" id="card-pos">
            <div class="card-header">
                <div class="card-icon-wrapper business">
                    <i data-lucide="plug-zap" class="icon icon-xl icon-emerald"></i>
                </div>
                <div>
                    <div class="card-label"><span class="ar">الخطوة ١</span><span class="en">Step 1</span></div>
                    <div class="card-title"><span class="ar">ربط نظام POS</span><span class="en">POS Connection</span></div>
                </div>
                <div class="card-status">
                    <span class="status-badge success" id="status-pos">
                        <i data-lucide="check-circle" class="icon icon-sm"></i>
                        <span class="ar">متصل</span>
                        <span class="en">Connected</span>
                    </span>
                </div>
            </div>
            <div class="card-content">
                <div class="pos-connection-info">
                    <!-- Connected POS System -->
                    <div class="pos-system-card">
                        <div class="pos-logo">
                            <i data-lucide="monitor" class="icon icon-3xl icon-emerald"></i>
                        </div>
                        <div class="pos-system-name">Foodics POS</div>
                        <div class="pos-system-type">
                            <span class="ar">نظام نقاط البيع</span>
                            <span class="en">Point of Sale System</span>
                        </div>
                    </div>
                    
                    <!-- Connection Status -->
                    <div class="connection-details">
                        <div class="connection-item success">
                            <i data-lucide="wifi" class="icon icon-sm"></i>
                            <span><span class="ar">الاتصال نشط</span><span class="en">Connection Active</span></span>
                        </div>
                        <div class="connection-item success">
                            <i data-lucide="refresh-cw" class="icon icon-sm"></i>
                            <span><span class="ar">مزامنة تلقائية</span><span class="en">Auto-sync enabled</span></span>
                        </div>
                        <div class="connection-item success">
                            <i data-lucide="shield-check" class="icon icon-sm"></i>
                            <span><span class="ar">ZATCA متصل</span><span class="en">ZATCA integrated</span></span>
                        </div>
                    </div>
                    
                    <!-- Last Sync -->
                    <div class="last-sync">
                        <i data-lucide="clock" class="icon icon-sm"></i>
                        <span class="ar">آخر مزامنة: منذ ٥ دقائق</span>
                        <span class="en">Last sync: 5 minutes ago</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Arrow 1 -->
        <div class="flow-arrow active" id="arrow-1">
            <i data-lucide="arrow-left" class="icon"></i>
        </div>
        
        <!-- Card 2: Sales Summary -->
        <div class="demo-card active" id="card-sales">
            <div class="card-header">
                <div class="card-icon-wrapper ai">
                    <i data-lucide="bar-chart-3" class="icon icon-xl icon-emerald"></i>
                </div>
                <div>
                    <div class="card-label"><span class="ar">الخطوة ٢</span><span class="en">Step 2</span></div>
                    <div class="card-title"><span class="ar">ملخص المبيعات</span><span class="en">Sales Summary</span></div>
                </div>
                <div class="card-status">
                    <span class="status-badge success" id="status-sales">
                        <i data-lucide="trending-up" class="icon icon-sm"></i>
                        <span class="ar">مباشر</span>
                        <span class="en">Live</span>
                    </span>
                </div>
            </div>
            <div class="card-content">
                <div class="sales-summary-content">
                    <!-- Period Label -->
                    <div class="sales-period">
                        <span class="ar">إجمالي مبيعات اليوم</span>
                        <span class="en">Today's Total Sales</span>
                    </div>
                    
                    <!-- Main Total Display -->
                    <div class="main-total-display">
                        <div class="main-total-value" id="pos-main-total">87,450</div>
                        <div class="main-total-currency">SAR</div>
                    </div>
                    
                    <!-- Stats Row -->
                    <div class="sales-stats-row">
                        <div class="stat-item-small">
                            <i data-lucide="file-text" class="icon icon-sm"></i>
                            <span class="stat-num" id="pos-invoices">156</span>
                            <span class="stat-text"><span class="ar">فاتورة</span><span class="en">invoices</span></span>
                        </div>
                        <div class="stat-divider"></div>
                        <div class="stat-item-small highlight">
                            <i data-lucide="percent" class="icon icon-sm"></i>
                            <span class="stat-num" id="pos-vat">13,117</span>
                            <span class="stat-text"><span class="ar">ضريبة</span><span class="en">VAT</span></span>
                        </div>
                    </div>
                    
                    <!-- Sync Button -->
                    <button class="sync-btn" id="sync-pos-btn" onclick="syncPOSData()">
                        <i data-lucide="refresh-cw" class="icon"></i>
                        <span class="ar">مزامنة الآن</span>
                        <span class="en">Sync Now</span>
                    </button>
                    
                    <!-- Last Sync Info -->
                    <div class="sync-status" id="sync-status">
                        <i data-lucide="check-circle" class="icon icon-sm"></i>
                        <span class="ar">متزامن • منذ لحظات</span>
                        <span class="en">Synced • Just now</span>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Arrow 2 -->
        <div class="flow-arrow active" id="arrow-2">
            <i data-lucide="arrow-left" class="icon"></i>
        </div>
        
        <!-- Card 3: Recent Transactions -->
        <div class="demo-card" id="card-transactions">
            <div class="card-header">
                <div class="card-icon-wrapper zatca">
                    <i data-lucide="receipt" class="icon icon-xl icon-amber"></i>
                </div>
                <div>
                    <div class="card-label"><span class="ar">الخطوة ٣</span><span class="en">Step 3</span></div>
                    <div class="card-title"><span class="ar">آخر المعاملات</span><span class="en">Recent Transactions</span></div>
                </div>
                <div class="card-status">
                    <span class="status-badge success" id="status-transactions">
                        <i data-lucide="check-circle" class="icon icon-sm"></i>
                        <span class="ar">ZATCA معتمد</span>
                        <span class="en">ZATCA Approved</span>
                    </span>
                </div>
            </div>
            <div class="card-content">
                <div class="transactions-list" id="transactions-list">
                    <!-- Transactions will be populated by JS -->
                </div>
                <div class="view-all-btn-wrapper">
                    <button class="view-all-btn" onclick="showAccountingSection()">
                        <span class="ar">عرض التقارير الكاملة</span>
                        <span class="en">View Full Reports</span>
                        <i data-lucide="arrow-down" class="icon"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ============================================== -->
    <!-- STEP 4-5: FULL ACCOUNTING & RECONCILIATION -->
    <!-- ============================================== -->
    <div class="accounting-section" id="accounting-section" style="display:none;">
        <div class="section-divider">
            <div class="divider-line"></div>
            <div class="divider-badge">
                <i data-lucide="arrow-down" class="icon"></i>
                <span class="ar">المحاسبة الكاملة</span>
                <span class="en">Complete Accounting</span>
            </div>
            <div class="divider-line"></div>
        </div>
        
        <div class="accounting-header">
            <div class="page-badge" style="background: rgba(52,211,153,0.15); border-color: rgba(52,211,153,0.3); color: #34d399;">
                <i data-lucide="wallet" class="icon icon-sm"></i>
                <span class="ar">الخطوات ٤-٥</span>
                <span class="en">Steps 4-5</span>
            </div>
            <h2 class="page-title" style="font-size: 1.75rem;">
                <span class="gradient-text-green"><span class="ar">التسوية التلقائية والتقارير المالية</span><span class="en">Auto Reconciliation & Financial Reports</span></span>
            </h2>
            <p class="page-subtitle">
                <span class="ar">أضف مصاريفك وشاهد التسوية الضريبية والتقارير المالية لحظياً</span>
                <span class="en">Add your expenses and see VAT reconciliation & financial reports in real-time</span>
            </p>
        </div>
        
        <!-- ============================================== -->
        <!-- AI BULK EXPENSE CATEGORIZER -->
        <!-- ============================================== -->
        <div class="bulk-upload-section" id="bulk-upload-section">
            <div class="bulk-header">
                <div class="bulk-icon-wrapper">
                    <i data-lucide="sparkles" class="icon icon-3xl icon-emerald"></i>
                </div>
                <div class="bulk-header-content">
                    <h3 class="bulk-title">
                        <span class="ar">رفع جميع المصاريف دفعة واحدة</span>
                        <span class="en">Upload All Expenses at Once</span>
                        <span class="ai-badge">AI</span>
                    </h3>
                    <p class="bulk-subtitle">
                        <span class="ar">ارفع جميع فواتيرك من أي مجلد - سيقوم الذكاء الاصطناعي بتصنيفها تلقائياً وتوزيعها على الفئات المناسبة</span>
                        <span class="en">Upload all your invoices from any folder - AI will automatically categorize and distribute them to appropriate pools</span>
                    </p>
                </div>
            </div>
            
            <!-- Bulk Upload Zone -->
            <div class="bulk-upload-zone" id="bulk-upload-zone" 
                 onclick="if(event.target.tagName !== 'INPUT') document.getElementById('bulk-file-input').click()"
                 ondragover="event.preventDefault(); this.classList.add('drag-over');"
                 ondragleave="this.classList.remove('drag-over');"
                 ondrop="event.preventDefault(); this.classList.remove('drag-over'); handleBulkFiles(event.dataTransfer.files);">
                <input type="file" id="bulk-file-input" multiple accept="image/*,.pdf" style="display:none;" onchange="handleBulkFiles(this.files); this.value=''">
                <div class="bulk-upload-icon">
                    <i data-lucide="folder-up" class="icon icon-4xl"></i>
                </div>
                <div class="bulk-upload-text">
                    <span class="ar">اسحب جميع الفواتير هنا أو انقر للاختيار</span>
                    <span class="en">Drag all invoices here or click to select</span>
                </div>
                <div class="bulk-upload-hint">
                    <span class="ar">فواتير موردين، إيصالات إيجار، كشوف رواتب، فواتير خدمات - كلها معاً!</span>
                    <span class="en">Supplier invoices, rent receipts, payroll, utility bills - all together!</span>
                </div>
                <div class="bulk-upload-formats">
                    <span class="format-badge">PDF</span>
                    <span class="format-badge">PNG</span>
                    <span class="format-badge">JPG</span>
                    <span class="format-badge"><span class="ar">حد أقصى 20 ملف</span><span class="en">Max 20 files</span></span>
                </div>
            </div>
            
            <!-- Files Preview -->
            <div class="bulk-files-preview" id="bulk-files-preview">
                <div class="files-header">
                    <div class="files-count">
                        <i data-lucide="files" class="icon"></i>
                        <span class="ar">الملفات المرفوعة</span>
                        <span class="en">Uploaded Files</span>
                        <span class="count-badge" id="bulk-files-count">0</span>
                    </div>
                    <button class="files-clear" id="bulk-files-clear" onclick="clearBulkUpload()">
                        <i data-lucide="trash-2" class="icon icon-sm"></i>
                        <span class="ar">مسح الكل</span>
                        <span class="en">Clear All</span>
                    </button>
                </div>
                <div class="files-grid" id="bulk-files-grid"></div>
            </div>
            
            <!-- Categorize Button -->
            <button class="categorize-btn" id="categorize-btn" disabled onclick="startCategorization()">
                <i data-lucide="brain" class="icon icon-lg"></i>
                <span class="ar">تصنيف تلقائي بالذكاء الاصطناعي</span>
                <span class="en">Auto-Categorize with AI</span>
            </button>
            
            <!-- AI Categorization Engine Animation -->
            <div class="ai-categorization-engine" id="ai-categorization-engine">
                <div class="engine-header">
                    <div class="engine-avatar">
                        <span>م</span>
                        <div class="engine-avatar-ring"></div>
                    </div>
                    <div class="engine-status">
                        <div class="engine-status-text" id="engine-status-text">
                            <span class="ar">جاري تحليل الفواتير...</span>
                            <span class="en">Analyzing invoices...</span>
                        </div>
                        <div class="engine-status-detail" id="engine-status-detail">
                            <span class="ar">قراءة محتوى الملفات</span>
                            <span class="en">Reading file contents</span>
                        </div>
                    </div>
                </div>
                
                <div class="categorization-steps">
                    <div class="cat-step" id="cat-step-1">
                        <div class="cat-step-icon">
                            <i data-lucide="scan-text" class="icon"></i>
                        </div>
                        <div class="cat-step-label">
                            <span class="ar">قراءة OCR</span>
                            <span class="en">OCR Reading</span>
                        </div>
                    </div>
                    <div class="cat-step" id="cat-step-2">
                        <div class="cat-step-icon">
                            <i data-lucide="brain" class="icon"></i>
                        </div>
                        <div class="cat-step-label">
                            <span class="ar">تحليل AI</span>
                            <span class="en">AI Analysis</span>
                        </div>
                    </div>
                    <div class="cat-step" id="cat-step-3">
                        <div class="cat-step-icon">
                            <i data-lucide="tags" class="icon"></i>
                        </div>
                        <div class="cat-step-label">
                            <span class="ar">تصنيف</span>
                            <span class="en">Categorizing</span>
                        </div>
                    </div>
                    <div class="cat-step" id="cat-step-4">
                        <div class="cat-step-icon">
                            <i data-lucide="calculator" class="icon"></i>
                        </div>
                        <div class="cat-step-label">
                            <span class="ar">استخراج البيانات</span>
                            <span class="en">Data Extraction</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Categorization Results -->
            <div class="categorization-results" id="categorization-results">
                <div class="results-header">
                    <div class="results-title">
                        <i data-lucide="check-circle" class="icon icon-lg"></i>
                        <span class="ar">تم التصنيف بنجاح!</span>
                        <span class="en">Categorization Complete!</span>
                    </div>
                    <div class="results-summary" id="results-summary"></div>
                </div>
                
                <div class="results-categories">
                    <!-- Suppliers Results -->
                    <div class="result-category" id="result-cat-suppliers">
                        <div class="result-category-header">
                            <div class="result-cat-icon suppliers">
                                <i data-lucide="truck" class="icon"></i>
                            </div>
                            <div class="result-cat-title">
                                <span class="ar">فواتير الموردين</span>
                                <span class="en">Supplier Invoices</span>
                            </div>
                            <div class="result-cat-count" id="result-count-suppliers">0</div>
                        </div>
                        <div class="result-cat-items" id="result-items-suppliers"></div>
                        <div class="empty-message">
                            <span class="ar">لا توجد فواتير موردين</span>
                            <span class="en">No supplier invoices</span>
                        </div>
                        <div class="result-cat-total">
                            <span class="result-cat-total-label">
                                <span class="ar">الإجمالي</span>
                                <span class="en">Total</span>
                            </span>
                            <span class="result-cat-total-value" id="result-total-suppliers">0 SAR</span>
                        </div>
                    </div>
                    
                    <!-- Salaries Results -->
                    <div class="result-category" id="result-cat-salaries">
                        <div class="result-category-header">
                            <div class="result-cat-icon salaries">
                                <i data-lucide="users" class="icon"></i>
                            </div>
                            <div class="result-cat-title">
                                <span class="ar">الرواتب والأجور</span>
                                <span class="en">Salaries & Wages</span>
                            </div>
                            <div class="result-cat-count" id="result-count-salaries">0</div>
                        </div>
                        <div class="result-cat-items" id="result-items-salaries"></div>
                        <div class="empty-message">
                            <span class="ar">لا توجد كشوف رواتب</span>
                            <span class="en">No payroll records</span>
                        </div>
                        <div class="result-cat-total">
                            <span class="result-cat-total-label">
                                <span class="ar">الإجمالي</span>
                                <span class="en">Total</span>
                            </span>
                            <span class="result-cat-total-value" id="result-total-salaries">0 SAR</span>
                        </div>
                    </div>
                    
                    <!-- Rent Results -->
                    <div class="result-category" id="result-cat-rent">
                        <div class="result-category-header">
                            <div class="result-cat-icon rent">
                                <i data-lucide="home" class="icon"></i>
                            </div>
                            <div class="result-cat-title">
                                <span class="ar">الإيجار</span>
                                <span class="en">Rent</span>
                            </div>
                            <div class="result-cat-count" id="result-count-rent">0</div>
                        </div>
                        <div class="result-cat-items" id="result-items-rent"></div>
                        <div class="empty-message">
                            <span class="ar">لا توجد إيصالات إيجار</span>
                            <span class="en">No rent receipts</span>
                        </div>
                        <div class="result-cat-total">
                            <span class="result-cat-total-label">
                                <span class="ar">الإجمالي</span>
                                <span class="en">Total</span>
                            </span>
                            <span class="result-cat-total-value" id="result-total-rent">0 SAR</span>
                        </div>
                    </div>
                    
                    <!-- Misc Results -->
                    <div class="result-category" id="result-cat-misc">
                        <div class="result-category-header">
                            <div class="result-cat-icon misc">
                                <i data-lucide="more-horizontal" class="icon"></i>
                            </div>
                            <div class="result-cat-title">
                                <span class="ar">مصاريف أخرى</span>
                                <span class="en">Miscellaneous</span>
                            </div>
                            <div class="result-cat-count" id="result-count-misc">0</div>
                        </div>
                        <div class="result-cat-items" id="result-items-misc"></div>
                        <div class="empty-message">
                            <span class="ar">لا توجد مصاريف أخرى</span>
                            <span class="en">No misc expenses</span>
                        </div>
                        <div class="result-cat-total">
                            <span class="result-cat-total-label">
                                <span class="ar">الإجمالي</span>
                                <span class="en">Total</span>
                            </span>
                            <span class="result-cat-total-value" id="result-total-misc">0 SAR</span>
                        </div>
                    </div>
                </div>
                
                <button class="apply-results-btn" id="apply-results-btn">
                    <i data-lucide="check-check" class="icon icon-lg"></i>
                    <span class="ar">تطبيق التصنيف وتحديث الحسابات</span>
                    <span class="en">Apply Categorization & Update Accounts</span>
                </button>
            </div>
            
            <!-- Success State -->
            <div class="categorization-success" id="categorization-success">
                <div class="success-icon">
                    <i data-lucide="check-circle" class="icon icon-3xl icon-emerald"></i>
                </div>
                <div class="success-title">
                    <span class="ar">تم تطبيق التصنيف بنجاح!</span>
                    <span class="en">Categorization Applied Successfully!</span>
                </div>
                <div class="success-message">
                    <span class="ar">تم توزيع جميع الفواتير على الفئات المناسبة وتحديث الحسابات</span>
                    <span class="en">All invoices have been distributed to appropriate categories and accounts updated</span>
                </div>
            </div>
        </div>
        
        <!-- Two Column Layout: Sales vs Expenses -->
        <div class="accounting-grid">
            <!-- LEFT: Sales Dashboard (POS Synced) -->
            <div class="accounting-panel sales-panel">
                <div class="panel-header">
                    <div class="panel-icon sales">
                        <i data-lucide="trending-up" class="icon icon-xl"></i>
                    </div>
                    <div>
                        <div class="panel-label"><span class="ar">من نظام POS</span><span class="en">From POS</span></div>
                        <div class="panel-title"><span class="ar">إجمالي المبيعات</span><span class="en">Total Sales</span></div>
                    </div>
                    <div class="panel-status">
                        <span class="status-badge success" id="sales-status">
                            <i data-lucide="refresh-cw" class="icon icon-sm"></i>
                            <span class="ar">متزامن</span>
                            <span class="en">Synced</span>
                        </span>
                    </div>
                </div>
                
                <div class="panel-content">
                    <!-- POS Synced Header -->
                    <div class="pos-sales-header">
                        <div class="pos-badge">
                            <i data-lucide="plug-zap" class="icon icon-sm"></i>
                            <span>Foodics POS</span>
                        </div>
                        <div class="sync-info">
                            <span class="ar">آخر مزامنة: الآن</span>
                            <span class="en">Last sync: Just now</span>
                        </div>
                    </div>
                    
                    <!-- Sales Summary Cards -->
                    <div class="summary-cards">
                        <div class="summary-card">
                            <div class="summary-icon"><i data-lucide="file-text" class="icon"></i></div>
                            <div class="summary-value" id="total-invoices">156</div>
                            <div class="summary-label"><span class="ar">الفواتير</span><span class="en">Invoices</span></div>
                        </div>
                        <div class="summary-card highlight">
                            <div class="summary-icon"><i data-lucide="banknote" class="icon"></i></div>
                            <div class="summary-value" id="total-sales">87,450</div>
                            <div class="summary-label"><span class="ar">المبيعات</span><span class="en">Sales (SAR)</span></div>
                        </div>
                        <div class="summary-card">
                            <div class="summary-icon"><i data-lucide="percent" class="icon"></i></div>
                            <div class="summary-value" id="output-vat">13,117</div>
                            <div class="summary-label"><span class="ar">ضريبة المخرجات</span><span class="en">Output VAT</span></div>
                        </div>
                    </div>
                    
                    <!-- Invoice List from POS -->
                    <div class="invoice-list">
                        <div class="list-header">
                            <span><span class="ar">آخر الفواتير من POS</span><span class="en">Recent POS Invoices</span></span>
                            <span class="list-count" id="invoice-list-count">156</span>
                        </div>
                        <div class="invoice-items" id="invoice-items">
                            <!-- Will be populated by JS -->
                        </div>
                    </div>
                    
                    
                    <!-- Sync Button -->
                    <button class="sync-btn" onclick="syncPOSData()" style="margin-top: 0.5rem;">
                        <i data-lucide="refresh-cw" class="icon"></i>
                        <span class="ar">مزامنة البيانات</span>
                        <span class="en">Sync Data</span>
                    </button>
                </div>
            </div>
            
            <!-- RIGHT: Expenses Upload -->
            <div class="accounting-panel expenses-panel">
                <div class="panel-header">
                    <div class="panel-icon expenses">
                        <i data-lucide="receipt" class="icon icon-xl"></i>
                    </div>
                    <div>
                        <div class="panel-label"><span class="ar">الخطوة ٥</span><span class="en">Step 5</span></div>
                        <div class="panel-title"><span class="ar">تكاليف المدخلات</span><span class="en">Input Costs</span></div>
                    </div>
                    <div class="panel-status">
                        <span class="status-badge waiting" id="expenses-status">
                            <span class="ar">أضف المصاريف</span>
                            <span class="en">Add Expenses</span>
                        </span>
                    </div>
                </div>
                
                <div class="panel-content">
                    <!-- Expense Categories -->
                    <div class="expense-categories">
                        <!-- Supplier Invoices -->
                        <div class="expense-category" id="cat-suppliers">
                            <div class="category-header" onclick="toggleExpenseUpload('suppliers')">
                                <div class="category-icon suppliers">
                                    <i data-lucide="truck" class="icon"></i>
                                </div>
                                <div class="category-info">
                                    <div class="category-title"><span class="ar">فواتير الموردين</span><span class="en">Supplier Invoices</span></div>
                                    <div class="category-hint"><span class="ar">مواد، بضائع، مخزون</span><span class="en">Materials, goods, inventory</span></div>
                                </div>
                                <div class="category-amount" id="suppliers-amount">0 SAR</div>
                                <i data-lucide="chevron-down" class="icon category-chevron"></i>
                            </div>
                            <div class="category-upload" id="upload-suppliers">
                                <div class="mini-upload-zone" onclick="triggerExpenseUpload('suppliers')">
                                    <i data-lucide="upload" class="icon"></i>
                                    <span><span class="ar">ارفع الفواتير</span><span class="en">Upload invoices</span></span>
                                </div>
                                <input type="file" id="input-suppliers" accept="image/*,.pdf" multiple onchange="handleExpenseUpload('suppliers', this.files)">
                                <div class="uploaded-expenses" id="expenses-suppliers"></div>
                            </div>
                        </div>
                        
                        <!-- Salaries -->
                        <div class="expense-category" id="cat-salaries">
                            <div class="category-header" onclick="toggleExpenseUpload('salaries')">
                                <div class="category-icon salaries">
                                    <i data-lucide="users" class="icon"></i>
                                </div>
                                <div class="category-info">
                                    <div class="category-title"><span class="ar">الرواتب والأجور</span><span class="en">Salaries & Wages</span></div>
                                    <div class="category-hint"><span class="ar">موظفين، عمالة</span><span class="en">Employees, labor</span></div>
                                </div>
                                <div class="category-amount" id="salaries-amount">0 SAR</div>
                                <i data-lucide="chevron-down" class="icon category-chevron"></i>
                            </div>
                            <div class="category-upload" id="upload-salaries">
                                <div class="mini-upload-zone" onclick="triggerExpenseUpload('salaries')">
                                    <i data-lucide="upload" class="icon"></i>
                                    <span><span class="ar">ارفع كشف الرواتب</span><span class="en">Upload payroll</span></span>
                                </div>
                                <input type="file" id="input-salaries" accept="image/*,.pdf" multiple onchange="handleExpenseUpload('salaries', this.files)">
                                <div class="uploaded-expenses" id="expenses-salaries"></div>
                            </div>
                        </div>
                        
                        <!-- Rent -->
                        <div class="expense-category" id="cat-rent">
                            <div class="category-header" onclick="toggleExpenseUpload('rent')">
                                <div class="category-icon rent">
                                    <i data-lucide="home" class="icon"></i>
                                </div>
                                <div class="category-info">
                                    <div class="category-title"><span class="ar">الإيجار</span><span class="en">Rent</span></div>
                                    <div class="category-hint"><span class="ar">مكتب، محل، مستودع</span><span class="en">Office, shop, warehouse</span></div>
                                </div>
                                <div class="category-amount" id="rent-amount">0 SAR</div>
                                <i data-lucide="chevron-down" class="icon category-chevron"></i>
                            </div>
                            <div class="category-upload" id="upload-rent">
                                <div class="mini-upload-zone" onclick="triggerExpenseUpload('rent')">
                                    <i data-lucide="upload" class="icon"></i>
                                    <span><span class="ar">ارفع عقد/إيصال الإيجار</span><span class="en">Upload rent receipt</span></span>
                                </div>
                                <input type="file" id="input-rent" accept="image/*,.pdf" multiple onchange="handleExpenseUpload('rent', this.files)">
                                <div class="uploaded-expenses" id="expenses-rent"></div>
                            </div>
                        </div>
                        
                        <!-- Miscellaneous -->
                        <div class="expense-category" id="cat-misc">
                            <div class="category-header" onclick="toggleExpenseUpload('misc')">
                                <div class="category-icon misc">
                                    <i data-lucide="more-horizontal" class="icon"></i>
                                </div>
                                <div class="category-info">
                                    <div class="category-title"><span class="ar">مصاريف أخرى</span><span class="en">Miscellaneous</span></div>
                                    <div class="category-hint"><span class="ar">كهرباء، ماء، اتصالات، صيانة</span><span class="en">Utilities, maintenance, etc.</span></div>
                                </div>
                                <div class="category-amount" id="misc-amount">0 SAR</div>
                                <i data-lucide="chevron-down" class="icon category-chevron"></i>
                            </div>
                            <div class="category-upload" id="upload-misc">
                                <div class="mini-upload-zone" onclick="triggerExpenseUpload('misc')">
                                    <i data-lucide="upload" class="icon"></i>
                                    <span><span class="ar">ارفع الفواتير</span><span class="en">Upload receipts</span></span>
                                </div>
                                <input type="file" id="input-misc" accept="image/*,.pdf" multiple onchange="handleExpenseUpload('misc', this.files)">
                                <div class="uploaded-expenses" id="expenses-misc"></div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Quick Add Buttons -->
                    <div class="quick-add-section">
                        <div class="quick-add-label"><span class="ar">إضافة سريعة (تجريبي)</span><span class="en">Quick Add (Demo)</span></div>
                        <div class="quick-add-buttons">
                            <button class="quick-add-btn" onclick="addQuickExpense('suppliers', 'فاتورة مورد', 'Supplier Invoice', 5000)">
                                <i data-lucide="truck" class="icon"></i>
                                <span>5,000</span>
                            </button>
                            <button class="quick-add-btn" onclick="addQuickExpense('salaries', 'راتب موظف', 'Employee Salary', 4500)">
                                <i data-lucide="users" class="icon"></i>
                                <span>4,500</span>
                            </button>
                            <button class="quick-add-btn" onclick="addQuickExpense('rent', 'إيجار شهري', 'Monthly Rent', 3000)">
                                <i data-lucide="home" class="icon"></i>
                                <span>3,000</span>
                            </button>
                            <button class="quick-add-btn" onclick="addQuickExpense('misc', 'كهرباء', 'Electricity', 800)">
                                <i data-lucide="zap" class="icon"></i>
                                <span>800</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- AI Processing Animation for Expenses -->
        <div class="ai-expense-processor" id="ai-expense-processor" style="display:none;">
            <div class="processor-content">
                <div class="processor-avatar">
                    <span>م</span>
                    <div class="processor-ring"></div>
                </div>
                <div class="processor-text">
                    <span class="ar" id="processor-text-ar">جاري تحليل المصروفات...</span>
                    <span class="en" id="processor-text-en">Analyzing expenses...</span>
                </div>
            </div>
        </div>
        
        <!-- ============================================== -->
        <!-- RECONCILIATION & FINANCIAL REPORT SECTION -->
        <!-- ============================================== -->
        <div class="reconciliation-section" id="reconciliation-section">
            <div class="reconciliation-header">
                <div class="recon-badge">
                    <i data-lucide="calculator" class="icon icon-sm"></i>
                    <span class="ar">التسوية التلقائية</span>
                    <span class="en">Auto Reconciliation</span>
                </div>
            </div>
            
            <!-- VAT Reconciliation -->
            <div class="vat-reconciliation">
                <div class="vat-card output">
                    <div class="vat-card-header">
                        <i data-lucide="arrow-up-circle" class="icon"></i>
                        <span><span class="ar">ضريبة المخرجات</span><span class="en">Output VAT</span></span>
                    </div>
                    <div class="vat-card-value" id="recon-output-vat">0</div>
                    <div class="vat-card-label"><span class="ar">مستحقة للهيئة</span><span class="en">Collected from customers</span></div>
                </div>
                
                <div class="vat-operator">
                    <span>−</span>
                </div>
                
                <div class="vat-card input">
                    <div class="vat-card-header">
                        <i data-lucide="arrow-down-circle" class="icon"></i>
                        <span><span class="ar">ضريبة المدخلات</span><span class="en">Input VAT</span></span>
                    </div>
                    <div class="vat-card-value" id="recon-input-vat">0</div>
                    <div class="vat-card-label"><span class="ar">مدفوعة على المصاريف</span><span class="en">Paid on expenses</span></div>
                </div>
                
                <div class="vat-operator">
                    <span>=</span>
                </div>
                
                <div class="vat-card net" id="vat-net-card">
                    <div class="vat-card-header">
                        <i data-lucide="wallet" class="icon"></i>
                        <span><span class="ar">صافي الضريبة</span><span class="en">Net VAT</span></span>
                    </div>
                    <div class="vat-card-value" id="recon-net-vat">0</div>
                    <div class="vat-card-label" id="vat-net-label">
                        <span class="ar">مستحق للهيئة</span>
                        <span class="en">Payable to ZATCA</span>
                    </div>
                </div>
            </div>
            
            <!-- Financial Summary -->
            <div class="financial-summary">
                <h3 class="summary-title">
                    <i data-lucide="bar-chart-3" class="icon"></i>
                    <span class="ar">ملخص الأرباح والخسائر</span>
                    <span class="en">Profit & Loss Summary</span>
                </h3>
                
                <div class="pnl-grid">
                    <div class="pnl-item revenue">
                        <div class="pnl-label"><span class="ar">إجمالي الإيرادات</span><span class="en">Total Revenue</span></div>
                        <div class="pnl-value" id="pnl-revenue">0</div>
                    </div>
                    <div class="pnl-item expenses">
                        <div class="pnl-label"><span class="ar">إجمالي المصاريف</span><span class="en">Total Expenses</span></div>
                        <div class="pnl-value" id="pnl-expenses">0</div>
                    </div>
                    <div class="pnl-item profit" id="pnl-profit-item">
                        <div class="pnl-label"><span class="ar">صافي الربح</span><span class="en">Net Profit</span></div>
                        <div class="pnl-value" id="pnl-profit">0</div>
                    </div>
                    <div class="pnl-item margin">
                        <div class="pnl-label"><span class="ar">هامش الربح</span><span class="en">Profit Margin</span></div>
                        <div class="pnl-value" id="pnl-margin">0%</div>
                    </div>
                </div>
                
                <!-- Expense Breakdown -->
                <div class="expense-breakdown" id="expense-breakdown" style="display:none;">
                    <h4 class="breakdown-title">
                        <i data-lucide="pie-chart" class="icon icon-sm"></i>
                        <span class="ar">تفصيل المصاريف</span>
                        <span class="en">Expense Breakdown</span>
                    </h4>
                    <div class="breakdown-bars">
                        <div class="breakdown-item" id="breakdown-suppliers" style="display:none;">
                            <div class="breakdown-label"><span class="ar">موردين</span><span class="en">Suppliers</span></div>
                            <div class="breakdown-bar"><div class="breakdown-fill suppliers" id="bar-suppliers" style="width:0%"></div></div>
                            <div class="breakdown-value" id="breakdown-suppliers-value">0</div>
                        </div>
                        <div class="breakdown-item" id="breakdown-salaries" style="display:none;">
                            <div class="breakdown-label"><span class="ar">رواتب</span><span class="en">Salaries</span></div>
                            <div class="breakdown-bar"><div class="breakdown-fill salaries" id="bar-salaries" style="width:0%"></div></div>
                            <div class="breakdown-value" id="breakdown-salaries-value">0</div>
                        </div>
                        <div class="breakdown-item" id="breakdown-rent" style="display:none;">
                            <div class="breakdown-label"><span class="ar">إيجار</span><span class="en">Rent</span></div>
                            <div class="breakdown-bar"><div class="breakdown-fill rent" id="bar-rent" style="width:0%"></div></div>
                            <div class="breakdown-value" id="breakdown-rent-value">0</div>
                        </div>
                        <div class="breakdown-item" id="breakdown-misc" style="display:none;">
                            <div class="breakdown-label"><span class="ar">أخرى</span><span class="en">Other</span></div>
                            <div class="breakdown-bar"><div class="breakdown-fill misc" id="bar-misc" style="width:0%"></div></div>
                            <div class="breakdown-value" id="breakdown-misc-value">0</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Generate Report Button -->
            <div class="report-actions">
                <button class="report-btn" onclick="generateFinancialReport()">
                    <i data-lucide="file-spreadsheet" class="icon"></i>
                    <span class="ar">تحميل التقرير المالي</span>
                    <span class="en">Download Financial Report</span>
                </button>
                <button class="report-btn secondary" onclick="generateVATReport()">
                    <i data-lucide="file-text" class="icon"></i>
                    <span class="ar">تقرير الضريبة</span>
                    <span class="en">VAT Report</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- ============================================== -->
    <!-- BUSINESS ALERTS & REMINDERS SECTION -->
    <!-- ============================================== -->
    <div class="alerts-section" id="alerts-section">
        <div class="section-divider">
            <div class="divider-line"></div>
            <div class="divider-badge">
                <i data-lucide="bell-ring" class="icon"></i>
                <span class="ar">التنبيهات والتذكيرات</span>
                <span class="en">Alerts & Reminders</span>
            </div>
            <div class="divider-line"></div>
        </div>
        
        <div class="alerts-header">
            <h2 class="page-title">
                <span class="ar">لا تفوّت أي موعد <span class="gradient-text-green">مهم</span></span>
                <span class="en">Never Miss an <span class="gradient-text-green">Important</span> Deadline</span>
            </h2>
            <p class="page-subtitle">
                <span class="ar">تنبيهات ذكية لمواعيد الدفع والتراخيص والالتزامات التنظيمية - ركّز على نمو أعمالك</span>
                <span class="en">Smart alerts for payment deadlines, licenses & regulatory obligations - focus on growing your business</span>
            </p>
        </div>
        
        <!-- Alert Summary Stats -->
        <div class="alert-summary">
            <div class="alert-stat urgent">
                <div class="alert-stat-icon"><i data-lucide="alert-triangle" class="icon icon-xl"></i></div>
                <div class="alert-stat-value" id="urgent-count">2</div>
                <div class="alert-stat-label"><span class="ar">عاجل</span><span class="en">Urgent</span></div>
            </div>
            <div class="alert-stat warning">
                <div class="alert-stat-icon"><i data-lucide="clock" class="icon icon-xl"></i></div>
                <div class="alert-stat-value" id="warning-count">3</div>
                <div class="alert-stat-label"><span class="ar">هذا الأسبوع</span><span class="en">This Week</span></div>
            </div>
            <div class="alert-stat upcoming">
                <div class="alert-stat-icon"><i data-lucide="calendar" class="icon icon-xl"></i></div>
                <div class="alert-stat-value" id="upcoming-count">5</div>
                <div class="alert-stat-label"><span class="ar">قادم</span><span class="en">Upcoming</span></div>
            </div>
            <div class="alert-stat completed">
                <div class="alert-stat-icon"><i data-lucide="check-circle" class="icon icon-xl"></i></div>
                <div class="alert-stat-value" id="completed-count">8</div>
                <div class="alert-stat-label"><span class="ar">مكتمل</span><span class="en">Completed</span></div>
            </div>
        </div>
        
        <!-- Alert Panels Grid -->
        <div class="alerts-grid">
            <!-- Financial Payments Panel -->
            <div class="alert-panel financial">
                <div class="alert-panel-header">
                    <div class="alert-panel-icon financial">
                        <i data-lucide="wallet" class="icon icon-xl"></i>
                    </div>
                    <div>
                        <div class="alert-panel-label"><span class="ar">المدفوعات</span><span class="en">Payments</span></div>
                        <div class="alert-panel-title"><span class="ar">الالتزامات المالية</span><span class="en">Financial Obligations</span></div>
                    </div>
                    <div class="alert-panel-count">
                        <span class="alert-count-badge urgent" id="financial-urgent">2</span>
                        <span class="alert-count-badge warning" id="financial-warning">2</span>
                    </div>
                </div>
                
                <div class="alert-panel-content" id="financial-alerts">
                    <!-- VAT Filing -->
                    <div class="alert-item urgent" data-alert-id="vat-filing" onclick="toggleAlertDetails('vat-filing')">
                        <div class="alert-item-icon vat">
                            <i data-lucide="percent" class="icon"></i>
                        </div>
                        <div class="alert-item-content">
                            <div class="alert-item-title">
                                <span class="ar">تقديم إقرار ضريبة القيمة المضافة</span>
                                <span class="en">VAT Filing Deadline</span>
                            </div>
                            <div class="alert-item-desc">
                                <span class="ar">Q4 2025 - هيئة الزكاة والضريبة والجمارك</span>
                                <span class="en">Q4 2025 - ZATCA Submission</span>
                            </div>
                            <div class="alert-item-meta">
                                <span class="alert-due-date urgent">
                                    <i data-lucide="calendar" class="icon icon-sm"></i>
                                    <span class="ar">٣١ يناير ٢٠٢٦</span>
                                    <span class="en">Jan 31, 2026</span>
                                </span>
                                <span class="alert-frequency">
                                    <i data-lucide="repeat" class="icon icon-sm"></i>
                                    <span class="ar">ربع سنوي</span>
                                    <span class="en">Quarterly</span>
                                </span>
                            </div>
                        </div>
                        <div class="alert-item-actions">
                            <button class="alert-action-btn complete" onclick="event.stopPropagation(); markAlertComplete('vat-filing')" title="Mark as done">
                                <i data-lucide="check" class="icon icon-sm"></i>
                            </button>
                            <button class="alert-action-btn remind" onclick="event.stopPropagation(); setReminder('vat-filing')" title="Set reminder">
                                <i data-lucide="bell" class="icon icon-sm"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Electricity -->
                    <div class="alert-item urgent" data-alert-id="electricity" onclick="toggleAlertDetails('electricity')">
                        <div class="alert-item-icon electricity">
                            <i data-lucide="zap" class="icon"></i>
                        </div>
                        <div class="alert-item-content">
                            <div class="alert-item-title">
                                <span class="ar">فاتورة الكهرباء</span>
                                <span class="en">Electricity Bill</span>
                            </div>
                            <div class="alert-item-desc">
                                <span class="ar">الشركة السعودية للكهرباء - حساب #12345678</span>
                                <span class="en">Saudi Electricity Co. - Account #12345678</span>
                            </div>
                            <div class="alert-item-meta">
                                <span class="alert-due-date urgent">
                                    <i data-lucide="calendar" class="icon icon-sm"></i>
                                    <span class="ar">٥ فبراير ٢٠٢٦</span>
                                    <span class="en">Feb 5, 2026</span>
                                </span>
                                <span class="alert-frequency">
                                    <i data-lucide="repeat" class="icon icon-sm"></i>
                                    <span class="ar">شهري</span>
                                    <span class="en">Monthly</span>
                                </span>
                            </div>
                        </div>
                        <div class="alert-item-actions">
                            <button class="alert-action-btn complete" onclick="event.stopPropagation(); markAlertComplete('electricity')" title="Mark as done">
                                <i data-lucide="check" class="icon icon-sm"></i>
                            </button>
                            <button class="alert-action-btn remind" onclick="event.stopPropagation(); setReminder('electricity')" title="Set reminder">
                                <i data-lucide="bell" class="icon icon-sm"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Rent Payment -->
                    <div class="alert-item warning" data-alert-id="rent" onclick="toggleAlertDetails('rent')">
                        <div class="alert-item-icon rent">
                            <i data-lucide="home" class="icon"></i>
                        </div>
                        <div class="alert-item-content">
                            <div class="alert-item-title">
                                <span class="ar">إيجار المحل/المكتب</span>
                                <span class="en">Shop/Office Rent</span>
                            </div>
                            <div class="alert-item-desc">
                                <span class="ar">إيجار شهري - عقد إيجار</span>
                                <span class="en">Monthly rent - Lease agreement</span>
                            </div>
                            <div class="alert-item-meta">
                                <span class="alert-due-date warning">
                                    <i data-lucide="calendar" class="icon icon-sm"></i>
                                    <span class="ar">١٠ فبراير ٢٠٢٦</span>
                                    <span class="en">Feb 10, 2026</span>
                                </span>
                                <span class="alert-frequency">
                                    <i data-lucide="repeat" class="icon icon-sm"></i>
                                    <span class="ar">شهري</span>
                                    <span class="en">Monthly</span>
                                </span>
                            </div>
                        </div>
                        <div class="alert-item-actions">
                            <button class="alert-action-btn complete" onclick="event.stopPropagation(); markAlertComplete('rent')" title="Mark as done">
                                <i data-lucide="check" class="icon icon-sm"></i>
                            </button>
                            <button class="alert-action-btn remind" onclick="event.stopPropagation(); setReminder('rent')" title="Set reminder">
                                <i data-lucide="bell" class="icon icon-sm"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Salary Payment -->
                    <div class="alert-item warning" data-alert-id="salary" onclick="toggleAlertDetails('salary')">
                        <div class="alert-item-icon salary">
                            <i data-lucide="users" class="icon"></i>
                        </div>
                        <div class="alert-item-content">
                            <div class="alert-item-title">
                                <span class="ar">رواتب الموظفين</span>
                                <span class="en">Employee Salaries</span>
                            </div>
                            <div class="alert-item-desc">
                                <span class="ar">رواتب شهر فبراير - ٥ موظفين</span>
                                <span class="en">February salaries - 5 employees</span>
                            </div>
                            <div class="alert-item-meta">
                                <span class="alert-due-date warning">
                                    <i data-lucide="calendar" class="icon icon-sm"></i>
                                    <span class="ar">٢٨ فبراير ٢٠٢٦</span>
                                    <span class="en">Feb 28, 2026</span>
                                </span>
                                <span class="alert-frequency">
                                    <i data-lucide="repeat" class="icon icon-sm"></i>
                                    <span class="ar">شهري</span>
                                    <span class="en">Monthly</span>
                                </span>
                            </div>
                        </div>
                        <div class="alert-item-actions">
                            <button class="alert-action-btn complete" onclick="event.stopPropagation(); markAlertComplete('salary')" title="Mark as done">
                                <i data-lucide="check" class="icon icon-sm"></i>
                            </button>
                            <button class="alert-action-btn remind" onclick="event.stopPropagation(); setReminder('salary')" title="Set reminder">
                                <i data-lucide="bell" class="icon icon-sm"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Labor Payment (Weekly) -->
                    <div class="alert-item" data-alert-id="labor" onclick="toggleAlertDetails('labor')">
                        <div class="alert-item-icon labor">
                            <i data-lucide="hard-hat" class="icon"></i>
                        </div>
                        <div class="alert-item-content">
                            <div class="alert-item-title">
                                <span class="ar">أجور العمالة</span>
                                <span class="en">Labor Wages</span>
                            </div>
                            <div class="alert-item-desc">
                                <span class="ar">دفعة أسبوعية - ٣ عمال</span>
                                <span class="en">Weekly payment - 3 workers</span>
                            </div>
                            <div class="alert-item-meta">
                                <span class="alert-due-date ok">
                                    <i data-lucide="calendar" class="icon icon-sm"></i>
                                    <span class="ar">١٢ فبراير ٢٠٢٦</span>
                                    <span class="en">Feb 12, 2026</span>
                                </span>
                                <span class="alert-frequency">
                                    <i data-lucide="repeat" class="icon icon-sm"></i>
                                    <span class="ar">أسبوعي</span>
                                    <span class="en">Weekly</span>
                                </span>
                            </div>
                        </div>
                        <div class="alert-item-actions">
                            <button class="alert-action-btn complete" onclick="event.stopPropagation(); markAlertComplete('labor')" title="Mark as done">
                                <i data-lucide="check" class="icon icon-sm"></i>
                            </button>
                            <button class="alert-action-btn remind" onclick="event.stopPropagation(); setReminder('labor')" title="Set reminder">
                                <i data-lucide="bell" class="icon icon-sm"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Internet/Utilities -->
                    <div class="alert-item" data-alert-id="internet" onclick="toggleAlertDetails('internet')">
                        <div class="alert-item-icon internet">
                            <i data-lucide="wifi" class="icon"></i>
                        </div>
                        <div class="alert-item-content">
                            <div class="alert-item-title">
                                <span class="ar">فاتورة الإنترنت</span>
                                <span class="en">Internet Bill</span>
                            </div>
                            <div class="alert-item-desc">
                                <span class="ar">STC - باقة الأعمال</span>
                                <span class="en">STC - Business Package</span>
                            </div>
                            <div class="alert-item-meta">
                                <span class="alert-due-date ok">
                                    <i data-lucide="calendar" class="icon icon-sm"></i>
                                    <span class="ar">١٥ فبراير ٢٠٢٦</span>
                                    <span class="en">Feb 15, 2026</span>
                                </span>
                                <span class="alert-frequency">
                                    <i data-lucide="repeat" class="icon icon-sm"></i>
                                    <span class="ar">شهري</span>
                                    <span class="en">Monthly</span>
                                </span>
                            </div>
                        </div>
                        <div class="alert-item-actions">
                            <button class="alert-action-btn complete" onclick="event.stopPropagation(); markAlertComplete('internet')" title="Mark as done">
                                <i data-lucide="check" class="icon icon-sm"></i>
                            </button>
                            <button class="alert-action-btn remind" onclick="event.stopPropagation(); setReminder('internet')" title="Set reminder">
                                <i data-lucide="bell" class="icon icon-sm"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Regulatory Compliance Panel -->
            <div class="alert-panel regulatory">
                <div class="alert-panel-header">
                    <div class="alert-panel-icon regulatory">
                        <i data-lucide="shield-check" class="icon icon-xl"></i>
                    </div>
                    <div>
                        <div class="alert-panel-label"><span class="ar">التراخيص</span><span class="en">Licenses</span></div>
                        <div class="alert-panel-title"><span class="ar">الالتزامات التنظيمية</span><span class="en">Regulatory Compliance</span></div>
                    </div>
                    <div class="alert-panel-count">
                        <span class="alert-count-badge warning" id="regulatory-warning">1</span>
                        <span class="alert-count-badge ok" id="regulatory-ok">3</span>
                    </div>
                </div>
                
                <div class="alert-panel-content" id="regulatory-alerts">
                    <!-- Municipality License -->
                    <div class="alert-item warning" data-alert-id="municipality" onclick="toggleAlertDetails('municipality')">
                        <div class="alert-item-icon municipality">
                            <i data-lucide="landmark" class="icon"></i>
                        </div>
                        <div class="alert-item-content">
                            <div class="alert-item-title">
                                <span class="ar">رخصة البلدية</span>
                                <span class="en">Municipality License</span>
                            </div>
                            <div class="alert-item-desc">
                                <span class="ar">تجديد رخصة النشاط التجاري - أمانة الرياض</span>
                                <span class="en">Commercial activity license renewal - Riyadh Municipality</span>
                            </div>
                            <div class="alert-item-meta">
                                <span class="alert-due-date warning">
                                    <i data-lucide="calendar" class="icon icon-sm"></i>
                                    <span class="ar">١٥ مارس ٢٠٢٦</span>
                                    <span class="en">Mar 15, 2026</span>
                                </span>
                                <span class="alert-frequency">
                                    <i data-lucide="repeat" class="icon icon-sm"></i>
                                    <span class="ar">سنوي</span>
                                    <span class="en">Yearly</span>
                                </span>
                            </div>
                        </div>
                        <div class="alert-item-actions">
                            <button class="alert-action-btn complete" onclick="event.stopPropagation(); markAlertComplete('municipality')" title="Mark as done">
                                <i data-lucide="check" class="icon icon-sm"></i>
                            </button>
                            <button class="alert-action-btn remind" onclick="event.stopPropagation(); setReminder('municipality')" title="Set reminder">
                                <i data-lucide="bell" class="icon icon-sm"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Commercial Registration (CR) -->
                    <div class="alert-item" data-alert-id="cr" onclick="toggleAlertDetails('cr')">
                        <div class="alert-item-icon cr">
                            <i data-lucide="file-badge" class="icon"></i>
                        </div>
                        <div class="alert-item-content">
                            <div class="alert-item-title">
                                <span class="ar">السجل التجاري (CR)</span>
                                <span class="en">Commercial Registration (CR)</span>
                            </div>
                            <div class="alert-item-desc">
                                <span class="ar">تجديد السجل التجاري - وزارة التجارة</span>
                                <span class="en">CR Renewal - Ministry of Commerce</span>
                            </div>
                            <div class="alert-item-meta">
                                <span class="alert-due-date ok">
                                    <i data-lucide="calendar" class="icon icon-sm"></i>
                                    <span class="ar">٢٠ يونيو ٢٠٢٦</span>
                                    <span class="en">Jun 20, 2026</span>
                                </span>
                                <span class="alert-frequency">
                                    <i data-lucide="repeat" class="icon icon-sm"></i>
                                    <span class="ar">سنوي</span>
                                    <span class="en">Yearly</span>
                                </span>
                            </div>
                        </div>
                        <div class="alert-item-actions">
                            <button class="alert-action-btn complete" onclick="event.stopPropagation(); markAlertComplete('cr')" title="Mark as done">
                                <i data-lucide="check" class="icon icon-sm"></i>
                            </button>
                            <button class="alert-action-btn remind" onclick="event.stopPropagation(); setReminder('cr')" title="Set reminder">
                                <i data-lucide="bell" class="icon icon-sm"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- GOSI -->
                    <div class="alert-item" data-alert-id="gosi" onclick="toggleAlertDetails('gosi')">
                        <div class="alert-item-icon gosi">
                            <i data-lucide="heart-handshake" class="icon"></i>
                        </div>
                        <div class="alert-item-content">
                            <div class="alert-item-title">
                                <span class="ar">التأمينات الاجتماعية (GOSI)</span>
                                <span class="en">Social Insurance (GOSI)</span>
                            </div>
                            <div class="alert-item-desc">
                                <span class="ar">اشتراكات فبراير - المؤسسة العامة للتأمينات</span>
                                <span class="en">February contributions - GOSI</span>
                            </div>
                            <div class="alert-item-meta">
                                <span class="alert-due-date ok">
                                    <i data-lucide="calendar" class="icon icon-sm"></i>
                                    <span class="ar">١٥ مارس ٢٠٢٦</span>
                                    <span class="en">Mar 15, 2026</span>
                                </span>
                                <span class="alert-frequency">
                                    <i data-lucide="repeat" class="icon icon-sm"></i>
                                    <span class="ar">شهري</span>
                                    <span class="en">Monthly</span>
                                </span>
                            </div>
                        </div>
                        <div class="alert-item-actions">
                            <button class="alert-action-btn complete" onclick="event.stopPropagation(); markAlertComplete('gosi')" title="Mark as done">
                                <i data-lucide="check" class="icon icon-sm"></i>
                            </button>
                            <button class="alert-action-btn remind" onclick="event.stopPropagation(); setReminder('gosi')" title="Set reminder">
                                <i data-lucide="bell" class="icon icon-sm"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Chamber of Commerce -->
                    <div class="alert-item" data-alert-id="chamber" onclick="toggleAlertDetails('chamber')">
                        <div class="alert-item-icon other">
                            <i data-lucide="building-2" class="icon"></i>
                        </div>
                        <div class="alert-item-content">
                            <div class="alert-item-title">
                                <span class="ar">اشتراك الغرفة التجارية</span>
                                <span class="en">Chamber of Commerce</span>
                            </div>
                            <div class="alert-item-desc">
                                <span class="ar">تجديد العضوية السنوية - غرفة الرياض</span>
                                <span class="en">Annual membership renewal - Riyadh Chamber</span>
                            </div>
                            <div class="alert-item-meta">
                                <span class="alert-due-date ok">
                                    <i data-lucide="calendar" class="icon icon-sm"></i>
                                    <span class="ar">١ أبريل ٢٠٢٦</span>
                                    <span class="en">Apr 1, 2026</span>
                                </span>
                                <span class="alert-frequency">
                                    <i data-lucide="repeat" class="icon icon-sm"></i>
                                    <span class="ar">سنوي</span>
                                    <span class="en">Yearly</span>
                                </span>
                            </div>
                        </div>
                        <div class="alert-item-actions">
                            <button class="alert-action-btn complete" onclick="event.stopPropagation(); markAlertComplete('chamber')" title="Mark as done">
                                <i data-lucide="check" class="icon icon-sm"></i>
                            </button>
                            <button class="alert-action-btn remind" onclick="event.stopPropagation(); setReminder('chamber')" title="Set reminder">
                                <i data-lucide="bell" class="icon icon-sm"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Saudization / Nitaqat -->
                    <div class="alert-item" data-alert-id="nitaqat" onclick="toggleAlertDetails('nitaqat')">
                        <div class="alert-item-icon other">
                            <i data-lucide="pie-chart" class="icon"></i>
                        </div>
                        <div class="alert-item-content">
                            <div class="alert-item-title">
                                <span class="ar">نطاقات (السعودة)</span>
                                <span class="en">Nitaqat (Saudization)</span>
                            </div>
                            <div class="alert-item-desc">
                                <span class="ar">مراجعة نسبة التوطين - وزارة الموارد البشرية</span>
                                <span class="en">Saudization ratio review - HRSD</span>
                            </div>
                            <div class="alert-item-meta">
                                <span class="alert-due-date ok">
                                    <i data-lucide="calendar" class="icon icon-sm"></i>
                                    <span class="ar">١ يوليو ٢٠٢٦</span>
                                    <span class="en">Jul 1, 2026</span>
                                </span>
                                <span class="alert-frequency">
                                    <i data-lucide="repeat" class="icon icon-sm"></i>
                                    <span class="ar">ربع سنوي</span>
                                    <span class="en">Quarterly</span>
                                </span>
                            </div>
                        </div>
                        <div class="alert-item-actions">
                            <button class="alert-action-btn complete" onclick="event.stopPropagation(); markAlertComplete('nitaqat')" title="Mark as done">
                                <i data-lucide="check" class="icon icon-sm"></i>
                            </button>
                            <button class="alert-action-btn remind" onclick="event.stopPropagation(); setReminder('nitaqat')" title="Set reminder">
                                <i data-lucide="bell" class="icon icon-sm"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Calendar Preview -->
        <div class="alert-calendar-preview">
            <div class="calendar-header">
                <div class="calendar-title">
                    <div class="calendar-title-icon">
                        <i data-lucide="calendar-days" class="icon"></i>
                    </div>
                    <span>
                        <span class="ar">تقويم المواعيد - فبراير ٢٠٢٦</span>
                        <span class="en">Deadline Calendar - February 2026</span>
                    </span>
                </div>
                <div class="calendar-nav">
                    <button class="calendar-nav-btn" onclick="navigateCalendar(-1)">
                        <i data-lucide="chevron-right" class="icon"></i>
                    </button>
                    <button class="calendar-nav-btn" onclick="navigateCalendar(1)">
                        <i data-lucide="chevron-left" class="icon"></i>
                    </button>
                </div>
            </div>
            <div class="calendar-days" id="calendar-grid">
                <!-- Day headers -->
                <div class="calendar-day-header"><span class="ar">أحد</span><span class="en">Sun</span></div>
                <div class="calendar-day-header"><span class="ar">إثن</span><span class="en">Mon</span></div>
                <div class="calendar-day-header"><span class="ar">ثلا</span><span class="en">Tue</span></div>
                <div class="calendar-day-header"><span class="ar">أرب</span><span class="en">Wed</span></div>
                <div class="calendar-day-header"><span class="ar">خمي</span><span class="en">Thu</span></div>
                <div class="calendar-day-header"><span class="ar">جمع</span><span class="en">Fri</span></div>
                <div class="calendar-day-header"><span class="ar">سبت</span><span class="en">Sat</span></div>
                <!-- Calendar days will be populated by JS -->
            </div>
        </div>
        
        <!-- Notification Settings -->
        <div class="notification-settings">
            <div class="notification-header">
                <div class="notification-icon">
                    <i data-lucide="bell" class="icon"></i>
                </div>
                <div class="notification-title">
                    <span class="ar">إعدادات التنبيهات</span>
                    <span class="en">Notification Settings</span>
                </div>
            </div>
            <div class="notification-options">
                <div class="notification-option active" onclick="toggleNotification(this, 'email')">
                    <i data-lucide="mail" class="icon"></i>
                    <span><span class="ar">بريد إلكتروني</span><span class="en">Email</span></span>
                </div>
                <div class="notification-option active" onclick="toggleNotification(this, 'sms')">
                    <i data-lucide="smartphone" class="icon"></i>
                    <span>SMS</span>
                </div>
                <div class="notification-option active" onclick="toggleNotification(this, 'whatsapp')">
                    <i data-lucide="message-circle" class="icon"></i>
                    <span>WhatsApp</span>
                </div>
                <div class="notification-option active" onclick="toggleNotification(this, 'push')">
                    <i data-lucide="bell-ring" class="icon"></i>
                    <span><span class="ar">إشعارات فورية</span><span class="en">Push</span></span>
                </div>
            </div>
        </div>
        
        <!-- Add Custom Alert -->
        <div class="add-alert-section">
            <button class="add-alert-btn" onclick="showAddAlertModal()">
                <i data-lucide="plus-circle" class="icon"></i>
                <span class="ar">إضافة تنبيه جديد</span>
                <span class="en">Add New Alert</span>
            </button>
        </div>
    </div>
</main>

<script>
// Language Toggle
function setLang(lang) {
    const html = document.getElementById('html-root');
    const btnAr = document.getElementById('btn-ar');
    const btnEn = document.getElementById('btn-en');
    
    if (lang === 'ar') {
        html.setAttribute('dir', 'rtl');
        html.setAttribute('lang', 'ar');
        btnAr.classList.add('active');
        btnEn.classList.remove('active');
    } else {
        html.setAttribute('dir', 'ltr');
        html.setAttribute('lang', 'en');
        btnEn.classList.add('active');
        btnAr.classList.remove('active');
    }
}

// ============================================== //
// POS INTEGRATION - SIMULATED DATA
// ============================================== //

// POS cumulative totals (all transactions for today)
let posTotals = {
    totalSales: 87450,
    totalVAT: 13117,
    invoiceCount: 156
};

// Recent visible transactions (last few shown in the list)
const posTransactions = [
    { id: 'POS-2026-001547', time: '14:32', customer: 'Walk-in', amount: 850, vat: 128 },
    { id: 'POS-2026-001546', time: '14:28', customer: 'Ahmed M.', amount: 1250, vat: 188 },
    { id: 'POS-2026-001545', time: '14:15', customer: 'Walk-in', amount: 520, vat: 78 },
    { id: 'POS-2026-001544', time: '14:02', customer: 'Sara K.', amount: 2100, vat: 315 },
    { id: 'POS-2026-001543', time: '13:55', customer: 'Walk-in', amount: 450, vat: 68 },
    { id: 'POS-2026-001542', time: '13:41', customer: 'Mohammed A.', amount: 1800, vat: 270 },
    { id: 'POS-2026-001541', time: '13:30', customer: 'Walk-in', amount: 680, vat: 102 },
    { id: 'POS-2026-001540', time: '13:22', customer: 'Fatima H.', amount: 950, vat: 143 },
];

// Initialize POS data on page load
document.addEventListener('DOMContentLoaded', function() {
    initializePOSData();
    initBulkUpload();
    lucide.createIcons();
});

function initializePOSData() {
    // Update Step 2 card with cumulative totals from POS
    document.getElementById('pos-main-total').textContent = formatNumber(posTotals.totalSales);
    document.getElementById('pos-vat').textContent = formatNumber(posTotals.totalVAT);
    document.getElementById('pos-invoices').textContent = posTotals.invoiceCount;
    
    // Populate recent transactions list (Step 3)
    populateTransactionsList();
    
    // Populate invoice list in accounting section
    populatePOSInvoiceList();
    
    // Set initial accounting data from POS totals
    accountingData.sales.totalSales = posTotals.totalSales;
    accountingData.sales.outputVAT = posTotals.totalVAT;
    accountingData.sales.invoices = posTransactions.map(t => ({
        id: t.id,
        customer: t.customer,
        amount: t.amount,
        vat: t.vat,
        total: t.amount + t.vat
    }));
    
    // Show accounting section immediately (since POS is already connected)
    setTimeout(() => {
        showAccountingSection();
    }, 500);
}

function populateTransactionsList() {
    const container = document.getElementById('transactions-list');
    if (!container) return;
    
    container.innerHTML = posTransactions.slice(0, 5).map(t => `
        <div class="transaction-item">
            <div class="transaction-icon">
                <i data-lucide="receipt" class="icon"></i>
            </div>
            <div class="transaction-details">
                <div class="transaction-id">${t.id}</div>
                <div class="transaction-time">${t.time} - ${t.customer}</div>
            </div>
            <div class="transaction-amount">
                <div class="amount">${formatNumber(t.amount + t.vat)} SAR</div>
                <div class="vat">+${formatNumber(t.vat)} VAT</div>
            </div>
        </div>
    `).join('');
    
    lucide.createIcons();
}

function populatePOSInvoiceList() {
    const container = document.getElementById('invoice-items');
    if (!container) return;
    
    container.innerHTML = posTransactions.map(t => `
        <div class="invoice-item">
            <div class="invoice-item-icon">
                <i data-lucide="file-check" class="icon"></i>
            </div>
            <div class="invoice-item-details">
                <div class="invoice-item-title">${t.id}</div>
                <div class="invoice-item-meta">${t.customer} • ${t.time}</div>
            </div>
            <div class="invoice-item-amount">
                <div class="amount">${formatNumber(t.amount + t.vat)} <small>SAR</small></div>
                <div class="vat-badge">+${formatNumber(t.vat)} ${isArabic() ? 'ض' : 'VAT'}</div>
            </div>
        </div>
    `).join('');
    
    lucide.createIcons();
}

// Sync POS Data
async function syncPOSData() {
    const syncBtn = document.querySelector('.sync-btn');
    const mainTotal = document.getElementById('pos-main-total');
    const syncStatus = document.getElementById('sync-status');
    if (!syncBtn) return;
    
    syncBtn.classList.add('syncing');
    syncBtn.innerHTML = `<i data-lucide="refresh-cw" class="icon"></i><span class="ar">جاري المزامنة...</span><span class="en">Syncing...</span>`;
    syncStatus.innerHTML = `<i data-lucide="loader" class="icon icon-sm"></i><span class="ar">جاري الاتصال بـ POS...</span><span class="en">Connecting to POS...</span>`;
    syncStatus.style.color = '#94a3b8';
    lucide.createIcons();
    
    // Simulate API call
    await sleep(1500);
    
    // Add 1-3 new random transactions (simulating new sales from POS)
    const newTransactionsCount = Math.floor(Math.random() * 3) + 1;
    let addedSales = 0;
    let addedVAT = 0;
    
    for (let i = 0; i < newTransactionsCount; i++) {
        const amount = Math.floor(Math.random() * 2000) + 300;
        const vat = Math.round(amount * 0.15);
        
        const newTransaction = {
            id: `POS-2026-00${1548 + posTotals.invoiceCount + i}`,
            time: new Date().toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: false }),
            customer: ['Walk-in', 'Ahmed M.', 'Sara K.', 'Mohammed A.', 'Fatima H.'][Math.floor(Math.random() * 5)],
            amount: amount,
            vat: vat
        };
        
        // Add to visible transactions list
        posTransactions.unshift(newTransaction);
        
        // Add to cumulative totals
        addedSales += amount;
        addedVAT += vat;
    }
    
    // Update cumulative totals
    posTotals.totalSales += addedSales;
    posTotals.totalVAT += addedVAT;
    posTotals.invoiceCount += newTransactionsCount;
    
    // Animate the main total update
    mainTotal.classList.add('updating');
    
    // Update Step 2 card totals
    document.getElementById('pos-main-total').textContent = formatNumber(posTotals.totalSales);
    document.getElementById('pos-vat').textContent = formatNumber(posTotals.totalVAT);
    document.getElementById('pos-invoices').textContent = posTotals.invoiceCount;
    
    // Update accounting section totals
    document.getElementById('total-sales').textContent = formatNumber(posTotals.totalSales);
    document.getElementById('output-vat').textContent = formatNumber(posTotals.totalVAT);
    document.getElementById('total-invoices').textContent = posTotals.invoiceCount;
    document.getElementById('invoice-list-count').textContent = posTotals.invoiceCount;
    
    // Update accounting data
    accountingData.sales.totalSales = posTotals.totalSales;
    accountingData.sales.outputVAT = posTotals.totalVAT;
    
    // Update reconciliation
    updateVATReconciliation(accountingData.totals.inputVAT);
    updateProfitLoss(accountingData.totals.totalExpenses);
    
    // Refresh lists
    populateTransactionsList();
    populatePOSInvoiceList();
    
    // Remove animation class
    setTimeout(() => mainTotal.classList.remove('updating'), 300);
    
    syncBtn.classList.remove('syncing');
    syncBtn.innerHTML = `<i data-lucide="check-circle" class="icon"></i><span class="ar">تم! +${formatNumber(addedSales)} ر.س</span><span class="en">Done! +${formatNumber(addedSales)} SAR</span>`;
    syncStatus.innerHTML = `<i data-lucide="check-circle" class="icon icon-sm"></i><span class="ar">متزامن • منذ لحظات</span><span class="en">Synced • Just now</span>`;
    syncStatus.style.color = '#34d399';
    lucide.createIcons();
    
    // Reset button after delay
    await sleep(2500);
    syncBtn.innerHTML = `<i data-lucide="refresh-cw" class="icon"></i><span class="ar">مزامنة الآن</span><span class="en">Sync Now</span>`;
    lucide.createIcons();
}

// Reset Demo for POS version
function resetDemo() {
    // Reset POS totals to initial values
    posTotals = {
        totalSales: 87450,
        totalVAT: 13117,
        invoiceCount: 156
    };
    
    // Reset accounting data
    accountingData = {
        sales: {
            invoices: posTransactions.slice(0, 8).map(t => ({
                id: t.id,
                customer: t.customer,
                amount: t.amount,
                vat: t.vat,
                total: t.amount + t.vat
            })),
            totalSales: 87450,
            outputVAT: 13117
        },
        expenses: {
            suppliers: [],
            salaries: [],
            rent: [],
            misc: []
        },
        totals: {
            totalExpenses: 0,
            inputVAT: 0
        }
    };
    
    // Update Step 2 card totals
    document.getElementById('pos-main-total').textContent = formatNumber(posTotals.totalSales);
    document.getElementById('pos-vat').textContent = formatNumber(posTotals.totalVAT);
    document.getElementById('pos-invoices').textContent = posTotals.invoiceCount;
    
    // Update accounting section totals
    document.getElementById('total-sales').textContent = formatNumber(posTotals.totalSales);
    document.getElementById('output-vat').textContent = formatNumber(posTotals.totalVAT);
    document.getElementById('total-invoices').textContent = posTotals.invoiceCount;
    document.getElementById('invoice-list-count').textContent = posTotals.invoiceCount;
    
    // Reset expense categories
    ['suppliers', 'salaries', 'rent', 'misc'].forEach(cat => {
        document.getElementById(`expenses-${cat}`).innerHTML = '';
        document.getElementById(`${cat}-amount`).textContent = '0 SAR';
        document.getElementById(`cat-${cat}`).classList.remove('has-expenses', 'active');
    });
    
    // Reset reconciliation
    updateVATReconciliation(0);
    updateProfitLoss(0);
    
    // Reset expense breakdown
    document.getElementById('expense-breakdown').style.display = 'none';
    
    // Refresh transaction lists
    populateTransactionsList();
    populatePOSInvoiceList();
    
    lucide.createIcons();
}

// Helper functions
function updateStatus(section, type, text) {
    const badge = document.getElementById(`status-${section}`);
    badge.className = `status-badge ${type}`;
    badge.innerHTML = text;
}

function updateAIMessage(message) {
    document.getElementById('ai-message').textContent = message;
}

function isArabic() {
    return document.getElementById('html-root').getAttribute('lang') === 'ar';
}

function formatFileSize(bytes) {
    if (bytes < 1024) return bytes + ' B';
    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
    return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
}

function generateZATCAId() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let id = 'INV-2026-ZATCA-';
    for (let i = 0; i < 12; i++) {
        id += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return id;
}

function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

// Initialize Lucide icons
lucide.createIcons();

// ============================================== //
// ACCOUNTING SECTION FUNCTIONALITY
// ============================================== //

// Data storage for accounting
let accountingData = {
    sales: {
        invoices: [],
        totalSales: 0,
        outputVAT: 0
    },
    expenses: {
        suppliers: [],
        salaries: [],
        rent: [],
        misc: []
    },
    totals: {
        totalExpenses: 0,
        inputVAT: 0
    }
};

// Show accounting section with POS data
function showAccountingSection() {
    const section = document.getElementById('accounting-section');
    section.style.display = 'block';
    
    // Populate invoice list from POS data
    populatePOSInvoiceList();
    
    // Update reconciliation with POS data
    updateVATReconciliation(accountingData.totals.inputVAT);
    updateProfitLoss(accountingData.totals.totalExpenses);
    
    // Smooth scroll to accounting section
    setTimeout(() => {
        section.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }, 300);
    
    lucide.createIcons();
}

// Toggle expense upload section
function toggleExpenseUpload(category) {
    const catEl = document.getElementById(`cat-${category}`);
    const wasActive = catEl.classList.contains('active');
    
    // Close all others
    document.querySelectorAll('.expense-category').forEach(el => {
        el.classList.remove('active');
    });
    
    // Toggle this one
    if (!wasActive) {
        catEl.classList.add('active');
    }
}

// Trigger file input for expense
function triggerExpenseUpload(category) {
    document.getElementById(`input-${category}`).click();
}

// Handle expense file upload
async function handleExpenseUpload(category, files) {
    if (!files || files.length === 0) return;
    
    for (const file of files) {
        // Show AI processor
        showAIProcessor(isArabic() ? `جاري تحليل ${file.name}...` : `Analyzing ${file.name}...`);
        
        // Simulate AI processing
        await sleep(1500);
        
        // Generate random amount for demo
        const amounts = {
            suppliers: [2500, 3500, 5000, 7500, 10000],
            salaries: [3000, 4000, 4500, 5000, 6000],
            rent: [2000, 3000, 4000, 5000],
            misc: [200, 500, 800, 1000, 1500]
        };
        const amountOptions = amounts[category] || [1000, 2000, 3000];
        const amount = amountOptions[Math.floor(Math.random() * amountOptions.length)];
        
        // Calculate VAT (15% for suppliers and misc, 0 for salaries and rent)
        const vatApplicable = category === 'suppliers' || category === 'misc';
        const vat = vatApplicable ? Math.round(amount * 0.15) : 0;
        
        // Add expense
        addExpenseToCategory(category, file.name, amount, vat);
        
        hideAIProcessor();
    }
    
    // Reset file input
    document.getElementById(`input-${category}`).value = '';
}

// Quick add expense (demo mode)
async function addQuickExpense(category, nameAr, nameEn, amount) {
    const name = isArabic() ? nameAr : nameEn;
    
    // Show AI processor
    showAIProcessor(isArabic() ? `جاري إضافة ${name}...` : `Adding ${name}...`);
    
    await sleep(800);
    
    // Calculate VAT
    const vatApplicable = category === 'suppliers' || category === 'misc';
    const vat = vatApplicable ? Math.round(amount * 0.15) : 0;
    
    addExpenseToCategory(category, name, amount, vat);
    
    hideAIProcessor();
}

// Add expense to category
function addExpenseToCategory(category, name, amount, vat) {
    const expenseId = `exp-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
    
    // Add to data
    accountingData.expenses[category].push({
        id: expenseId,
        name: name,
        amount: amount,
        vat: vat
    });
    
    // Update category UI
    const container = document.getElementById(`expenses-${category}`);
    const expenseHTML = `
        <div class="uploaded-expense" id="${expenseId}">
            <i data-lucide="file-check" class="icon icon-sm" style="color:#34d399;"></i>
            <span class="expense-name">${name}</span>
            <span class="expense-amount">${formatNumber(amount)}</span>
            ${vat > 0 ? `<span class="expense-vat">+${formatNumber(vat)} VAT</span>` : ''}
            <button class="remove-expense" onclick="removeExpense('${category}', '${expenseId}')">
                <i data-lucide="x" class="icon icon-sm"></i>
            </button>
        </div>
    `;
    container.insertAdjacentHTML('beforeend', expenseHTML);
    
    // Mark category as having expenses
    document.getElementById(`cat-${category}`).classList.add('has-expenses');
    
    // Update totals
    updateAccountingTotals();
    
    lucide.createIcons();
}

// Remove expense
function removeExpense(category, expenseId) {
    // Remove from data
    accountingData.expenses[category] = accountingData.expenses[category].filter(e => e.id !== expenseId);
    
    // Remove from UI
    document.getElementById(expenseId).remove();
    
    // Check if category is empty
    if (accountingData.expenses[category].length === 0) {
        document.getElementById(`cat-${category}`).classList.remove('has-expenses');
    }
    
    updateAccountingTotals();
}

// Update all accounting totals
function updateAccountingTotals() {
    // Calculate totals per category
    const categories = ['suppliers', 'salaries', 'rent', 'misc'];
    let totalExpenses = 0;
    let totalInputVAT = 0;
    
    categories.forEach(cat => {
        const catTotal = accountingData.expenses[cat].reduce((sum, e) => sum + e.amount, 0);
        const catVAT = accountingData.expenses[cat].reduce((sum, e) => sum + e.vat, 0);
        
        totalExpenses += catTotal;
        totalInputVAT += catVAT;
        
        // Update category amount display
        document.getElementById(`${cat}-amount`).textContent = `${formatNumber(catTotal)} SAR`;
    });
    
    accountingData.totals.totalExpenses = totalExpenses;
    accountingData.totals.inputVAT = totalInputVAT;
    
    // Update expenses status
    const expenseCount = categories.reduce((sum, cat) => sum + accountingData.expenses[cat].length, 0);
    const expensesStatus = document.getElementById('expenses-status');
    if (expenseCount > 0) {
        expensesStatus.className = 'status-badge success';
        expensesStatus.innerHTML = `<i data-lucide="check-circle" class="icon icon-sm"></i> ${expenseCount} ${isArabic() ? 'مصروف' : 'expenses'}`;
    } else {
        expensesStatus.className = 'status-badge waiting';
        expensesStatus.innerHTML = `<span class="ar">أضف المصاريف</span><span class="en">Add Expenses</span>`;
    }
    
    // Update VAT reconciliation
    updateVATReconciliation(totalInputVAT);
    
    // Update P&L
    updateProfitLoss(totalExpenses);
    
    // Update expense breakdown
    updateExpenseBreakdown(totalExpenses);
    
    lucide.createIcons();
}

// Update VAT reconciliation display
function updateVATReconciliation(inputVAT) {
    const outputVAT = accountingData.sales.outputVAT;
    const netVAT = outputVAT - inputVAT;
    
    document.getElementById('recon-output-vat').textContent = formatNumber(outputVAT);
    document.getElementById('recon-input-vat').textContent = formatNumber(inputVAT);
    document.getElementById('recon-net-vat').textContent = formatNumber(Math.abs(netVAT));
    
    const netCard = document.getElementById('vat-net-card');
    const netLabel = document.getElementById('vat-net-label');
    
    if (netVAT < 0) {
        netCard.classList.add('refund');
        netLabel.innerHTML = `<span class="ar">مسترد من الهيئة</span><span class="en">Refundable from ZATCA</span>`;
    } else {
        netCard.classList.remove('refund');
        netLabel.innerHTML = `<span class="ar">مستحق للهيئة</span><span class="en">Payable to ZATCA</span>`;
    }
}

// Update Profit & Loss display
function updateProfitLoss(totalExpenses) {
    const revenue = accountingData.sales.totalSales;
    const profit = revenue - totalExpenses;
    const margin = revenue > 0 ? Math.round((profit / revenue) * 100) : 0;
    
    document.getElementById('pnl-revenue').textContent = formatNumber(revenue);
    document.getElementById('pnl-expenses').textContent = formatNumber(totalExpenses);
    document.getElementById('pnl-profit').textContent = formatNumber(Math.abs(profit));
    document.getElementById('pnl-margin').textContent = `${margin}%`;
    
    const profitItem = document.getElementById('pnl-profit-item');
    const profitLabel = profitItem.querySelector('.pnl-label');
    
    if (profit < 0) {
        profitItem.classList.add('loss');
        profitLabel.innerHTML = `<span class="ar">صافي الخسارة</span><span class="en">Net Loss</span>`;
    } else {
        profitItem.classList.remove('loss');
        profitLabel.innerHTML = `<span class="ar">صافي الربح</span><span class="en">Net Profit</span>`;
    }
}

// Update expense breakdown chart
function updateExpenseBreakdown(totalExpenses) {
    const breakdown = document.getElementById('expense-breakdown');
    
    if (totalExpenses === 0) {
        breakdown.style.display = 'none';
        return;
    }
    
    breakdown.style.display = 'block';
    
    const categories = ['suppliers', 'salaries', 'rent', 'misc'];
    
    categories.forEach(cat => {
        const catTotal = accountingData.expenses[cat].reduce((sum, e) => sum + e.amount, 0);
        const percentage = totalExpenses > 0 ? (catTotal / totalExpenses) * 100 : 0;
        
        const itemEl = document.getElementById(`breakdown-${cat}`);
        const barEl = document.getElementById(`bar-${cat}`);
        const valueEl = document.getElementById(`breakdown-${cat}-value`);
        
        if (catTotal > 0) {
            itemEl.style.display = 'grid';
            barEl.style.width = `${percentage}%`;
            valueEl.textContent = formatNumber(catTotal);
        } else {
            itemEl.style.display = 'none';
        }
    });
}

// Add sample invoice - Not needed for POS version (invoices come from POS)
function addSampleInvoice() {
    // For POS version, trigger a sync instead
    syncPOSData();
}

// Show AI processor animation
function showAIProcessor(message) {
    const processor = document.getElementById('ai-expense-processor');
    document.getElementById('processor-text-ar').textContent = message;
    document.getElementById('processor-text-en').textContent = message;
    processor.style.display = 'block';
}

// Hide AI processor
function hideAIProcessor() {
    document.getElementById('ai-expense-processor').style.display = 'none';
}

// Generate Financial Report
function generateFinancialReport() {
    const isRTL = isArabic();
    const date = new Date().toLocaleDateString(isRTL ? 'ar-SA' : 'en-US');
    
    const reportHTML = generateReportHTML('financial', isRTL, date);
    const reportWindow = window.open('', '_blank');
    reportWindow.document.write(reportHTML);
    reportWindow.document.close();
}

// Generate VAT Report
function generateVATReport() {
    const isRTL = isArabic();
    const date = new Date().toLocaleDateString(isRTL ? 'ar-SA' : 'en-US');
    
    const reportHTML = generateReportHTML('vat', isRTL, date);
    const reportWindow = window.open('', '_blank');
    reportWindow.document.write(reportHTML);
    reportWindow.document.close();
}

// Generate report HTML
function generateReportHTML(type, isRTL, date) {
    const revenue = accountingData.sales.totalSales;
    const expenses = accountingData.totals.totalExpenses;
    const outputVAT = accountingData.sales.outputVAT;
    const inputVAT = accountingData.totals.inputVAT;
    const netVAT = outputVAT - inputVAT;
    const profit = revenue - expenses;
    const margin = revenue > 0 ? Math.round((profit / revenue) * 100) : 0;
    
    const categories = ['suppliers', 'salaries', 'rent', 'misc'];
    const catNames = {
        suppliers: { ar: 'موردين', en: 'Suppliers' },
        salaries: { ar: 'رواتب', en: 'Salaries' },
        rent: { ar: 'إيجار', en: 'Rent' },
        misc: { ar: 'أخرى', en: 'Miscellaneous' }
    };
    
    let expenseRows = '';
    categories.forEach(cat => {
        const catTotal = accountingData.expenses[cat].reduce((sum, e) => sum + e.amount, 0);
        const catVAT = accountingData.expenses[cat].reduce((sum, e) => sum + e.vat, 0);
        if (catTotal > 0) {
            expenseRows += `
                <tr>
                    <td>${isRTL ? catNames[cat].ar : catNames[cat].en}</td>
                    <td style="text-align:${isRTL ? 'left' : 'right'};">${formatNumber(catTotal)} SAR</td>
                    <td style="text-align:${isRTL ? 'left' : 'right'};">${formatNumber(catVAT)} SAR</td>
                </tr>
            `;
        }
    });
    
    const title = type === 'financial' 
        ? (isRTL ? 'التقرير المالي' : 'Financial Report')
        : (isRTL ? 'تقرير ضريبة القيمة المضافة' : 'VAT Report');
    
    return `<!DOCTYPE html>
<html lang="${isRTL ? 'ar' : 'en'}" dir="${isRTL ? 'rtl' : 'ltr'}">
<head>
    <meta charset="UTF-8">
    <title>${title} - Muhasib</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: '${isRTL ? 'Tajawal' : 'Inter'}', Arial, sans-serif; background: #f1f5f9; min-height: 100vh; padding: 20px; }
        .report { max-width: 800px; margin: 0 auto; background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); overflow: hidden; }
        .report-header { background: linear-gradient(135deg, #a78bfa, #818cf8); color: white; padding: 30px; }
        .report-header h1 { font-size: 1.5rem; margin-bottom: 5px; }
        .report-header p { opacity: 0.9; font-size: 0.9rem; }
        .report-content { padding: 30px; }
        .section { margin-bottom: 30px; }
        .section h2 { font-size: 1.1rem; color: #1e293b; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #e2e8f0; }
        .summary-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 20px; }
        .summary-item { background: #f8fafc; border-radius: 10px; padding: 15px; border-${isRTL ? 'right' : 'left'}: 4px solid #a78bfa; }
        .summary-item.revenue { border-color: #34d399; }
        .summary-item.expenses { border-color: #fb923c; }
        .summary-item.profit { border-color: #a78bfa; }
        .summary-item.loss { border-color: #f87171; }
        .summary-item .label { font-size: 0.8rem; color: #64748b; margin-bottom: 5px; }
        .summary-item .value { font-size: 1.25rem; font-weight: 700; color: #1e293b; }
        .summary-item.revenue .value { color: #059669; }
        .summary-item.expenses .value { color: #ea580c; }
        .summary-item.profit .value { color: #7c3aed; }
        .summary-item.loss .value { color: #dc2626; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { background: #f1f5f9; padding: 12px; text-align: ${isRTL ? 'right' : 'left'}; font-size: 0.85rem; color: #64748b; border-bottom: 2px solid #e2e8f0; }
        td { padding: 12px; border-bottom: 1px solid #e2e8f0; font-size: 0.9rem; }
        .vat-summary { display: flex; justify-content: space-between; align-items: center; background: ${netVAT >= 0 ? 'rgba(167,139,250,0.1)' : 'rgba(52,211,153,0.1)'}; border-radius: 12px; padding: 20px; margin-top: 20px; }
        .vat-item { text-align: center; }
        .vat-item .label { font-size: 0.8rem; color: #64748b; margin-bottom: 5px; }
        .vat-item .value { font-size: 1.5rem; font-weight: 700; }
        .vat-item.output .value { color: #059669; }
        .vat-item.input .value { color: #ea580c; }
        .vat-item.net .value { color: ${netVAT >= 0 ? '#7c3aed' : '#059669'}; }
        .operator { font-size: 1.5rem; color: #64748b; }
        .footer { background: #f8fafc; padding: 20px; text-align: center; font-size: 0.8rem; color: #64748b; border-top: 1px solid #e2e8f0; }
        .print-btn { position: fixed; bottom: 20px; right: 20px; background: #a78bfa; color: white; border: none; padding: 15px 25px; border-radius: 10px; font-size: 1rem; cursor: pointer; box-shadow: 0 4px 15px rgba(167,139,250,0.4); }
        .print-btn:hover { background: #8b5cf6; }
        @media print { .print-btn { display: none; } body { background: white; padding: 0; } .report { box-shadow: none; } }
    </style>
</head>
<body>
    <div class="report">
        <div class="report-header">
            <h1>${title}</h1>
            <p>${isRTL ? 'تاريخ التقرير' : 'Report Date'}: ${date}</p>
        </div>
        <div class="report-content">
            ${type === 'financial' ? `
            <div class="section">
                <h2>${isRTL ? 'ملخص الأرباح والخسائر' : 'Profit & Loss Summary'}</h2>
                <div class="summary-grid">
                    <div class="summary-item revenue">
                        <div class="label">${isRTL ? 'إجمالي الإيرادات' : 'Total Revenue'}</div>
                        <div class="value">${formatNumber(revenue)} SAR</div>
                    </div>
                    <div class="summary-item expenses">
                        <div class="label">${isRTL ? 'إجمالي المصاريف' : 'Total Expenses'}</div>
                        <div class="value">${formatNumber(expenses)} SAR</div>
                    </div>
                    <div class="summary-item ${profit >= 0 ? 'profit' : 'loss'}">
                        <div class="label">${profit >= 0 ? (isRTL ? 'صافي الربح' : 'Net Profit') : (isRTL ? 'صافي الخسارة' : 'Net Loss')}</div>
                        <div class="value">${formatNumber(Math.abs(profit))} SAR</div>
                    </div>
                    <div class="summary-item">
                        <div class="label">${isRTL ? 'هامش الربح' : 'Profit Margin'}</div>
                        <div class="value">${margin}%</div>
                    </div>
                </div>
            </div>
            <div class="section">
                <h2>${isRTL ? 'تفصيل المصاريف' : 'Expense Breakdown'}</h2>
                <table>
                    <thead>
                        <tr>
                            <th>${isRTL ? 'الفئة' : 'Category'}</th>
                            <th style="text-align:${isRTL ? 'left' : 'right'};">${isRTL ? 'المبلغ' : 'Amount'}</th>
                            <th style="text-align:${isRTL ? 'left' : 'right'};">${isRTL ? 'الضريبة' : 'VAT'}</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${expenseRows || `<tr><td colspan="3" style="text-align:center;color:#64748b;">${isRTL ? 'لا توجد مصاريف' : 'No expenses'}</td></tr>`}
                    </tbody>
                </table>
            </div>
            ` : ''}
            <div class="section">
                <h2>${isRTL ? 'تسوية ضريبة القيمة المضافة' : 'VAT Reconciliation'}</h2>
                <div class="vat-summary">
                    <div class="vat-item output">
                        <div class="label">${isRTL ? 'ضريبة المخرجات' : 'Output VAT'}</div>
                        <div class="value">${formatNumber(outputVAT)}</div>
                    </div>
                    <div class="operator">−</div>
                    <div class="vat-item input">
                        <div class="label">${isRTL ? 'ضريبة المدخلات' : 'Input VAT'}</div>
                        <div class="value">${formatNumber(inputVAT)}</div>
                    </div>
                    <div class="operator">=</div>
                    <div class="vat-item net">
                        <div class="label">${netVAT >= 0 ? (isRTL ? 'مستحق للهيئة' : 'Payable') : (isRTL ? 'مسترد' : 'Refundable')}</div>
                        <div class="value">${formatNumber(Math.abs(netVAT))}</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="footer">
            <p>${isRTL ? 'تم إنشاء هذا التقرير بواسطة مُحاسِب - محاسبة ذكية بالذكاء الاصطناعي' : 'Generated by Muhasib - AI-Powered Smart Accounting'}</p>
        </div>
    </div>
    <button class="print-btn" onclick="window.print()">📄 ${isRTL ? 'طباعة / حفظ PDF' : 'Print / Save PDF'}</button>
</body>
</html>`;
}

// Helper: Format number with commas (handles decimals properly)
function formatNumber(num) {
    // Round to 2 decimal places to avoid floating-point precision issues
    const rounded = Math.round(num * 100) / 100;
    const parts = rounded.toString().split('.');
    // Add commas only to the integer part
    parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ",");
    return parts.join('.');
}


// ============================================== //
// AI BULK EXPENSE CATEGORIZER FUNCTIONALITY
// ============================================== //

// Bulk upload data storage
let bulkUploadFiles = [];
let categorizationResults = {
    suppliers: [],
    salaries: [],
    rent: [],
    misc: []
};

// DOM Elements for bulk upload
let bulkUploadZone, bulkFileInput, bulkFilesPreview, bulkFilesGrid, bulkFilesCount, bulkFilesClear, categorizeBtn, bulkUploadSection;

// Initialize bulk upload functionality
function initBulkUpload() {
    bulkUploadZone = document.getElementById('bulk-upload-zone');
    bulkFileInput = document.getElementById('bulk-file-input');
    bulkFilesPreview = document.getElementById('bulk-files-preview');
    bulkFilesGrid = document.getElementById('bulk-files-grid');
    bulkFilesCount = document.getElementById('bulk-files-count');
    bulkFilesClear = document.getElementById('bulk-files-clear');
    categorizeBtn = document.getElementById('categorize-btn');
    bulkUploadSection = document.getElementById('bulk-upload-section');
    
    // Event handlers are now inline in HTML (onclick, ondragover, etc.)
    // This function just initializes the DOM references
    
    console.log('Bulk upload initialized');
}

// Handle bulk files
function handleBulkFiles(files) {
    console.log('handleBulkFiles called with', files ? files.length : 0, 'files');
    if (!files || files.length === 0) return;
    
    const validTypes = ['image/jpeg', 'image/png', 'image/jpg', 'application/pdf'];
    
    for (const file of files) {
        console.log('Processing file:', file.name, file.type);
        if (bulkUploadFiles.length >= 20) {
            alert(isArabic() ? 'الحد الأقصى 20 ملف' : 'Maximum 20 files allowed');
            break;
        }
        
        if (!validTypes.includes(file.type)) {
            console.log('Invalid type:', file.type);
            continue;
        }
        
        if (file.size > 10 * 1024 * 1024) {
            console.log('File too large:', file.size);
            continue;
        }
        
        // Check for duplicates
        if (!bulkUploadFiles.some(f => f.name === file.name && f.size === file.size)) {
            bulkUploadFiles.push(file);
            console.log('File added:', file.name);
        }
    }
    
    console.log('Total files now:', bulkUploadFiles.length);
    updateBulkFilesPreview();
}

// Update files preview
function updateBulkFilesPreview() {
    // Get elements directly to ensure they exist
    const preview = document.getElementById('bulk-files-preview');
    const zone = document.getElementById('bulk-upload-zone');
    const btn = document.getElementById('categorize-btn');
    const countEl = document.getElementById('bulk-files-count');
    const grid = document.getElementById('bulk-files-grid');
    
    console.log('updateBulkFilesPreview called, files:', bulkUploadFiles.length);
    
    if (bulkUploadFiles.length === 0) {
        if (preview) preview.classList.remove('show');
        if (zone) zone.classList.remove('has-files');
        if (btn) btn.disabled = true;
        return;
    }
    
    if (preview) preview.classList.add('show');
    if (zone) zone.classList.add('has-files');
    if (btn) btn.disabled = false;
    
    if (countEl) countEl.textContent = bulkUploadFiles.length;
    
    if (grid) {
        grid.innerHTML = bulkUploadFiles.map((file, index) => `
            <div class="file-chip" data-index="${index}">
                <i data-lucide="${file.type === 'application/pdf' ? 'file-text' : 'image'}" class="icon file-chip-icon"></i>
                <span class="file-chip-name">${file.name}</span>
                <button class="file-chip-remove" onclick="removeBulkFile(${index})">
                    <i data-lucide="x" class="icon icon-sm"></i>
                </button>
            </div>
        `).join('');
    }
    
    lucide.createIcons();
}

// Remove single file
function removeBulkFile(index) {
    bulkUploadFiles.splice(index, 1);
    updateBulkFilesPreview();
}

// Clear all bulk upload
function clearBulkUpload() {
    bulkUploadFiles = [];
    bulkFileInput.value = '';
    updateBulkFilesPreview();
    resetCategorization();
}

// Reset categorization state
function resetCategorization() {
    categorizationResults = { suppliers: [], salaries: [], rent: [], misc: [] };
    
    document.getElementById('ai-categorization-engine').classList.remove('show');
    document.getElementById('categorization-results').classList.remove('show');
    document.getElementById('categorization-success').classList.remove('show');
    
    bulkUploadSection.classList.remove('processing', 'completed');
    
    // Reset categorization steps
    for (let i = 1; i <= 4; i++) {
        document.getElementById(`cat-step-${i}`).classList.remove('active', 'completed');
    }
    
    categorizeBtn.disabled = bulkUploadFiles.length === 0;
    categorizeBtn.innerHTML = `
        <i data-lucide="brain" class="icon icon-lg"></i>
        <span class="ar">تصنيف تلقائي بالذكاء الاصطناعي</span>
        <span class="en">Auto-Categorize with AI</span>
    `;
    categorizeBtn.classList.remove('processing');
    lucide.createIcons();
}

// Categorize button click handler is set in initBulkUpload()

// Start AI categorization
async function startCategorization() {
    if (bulkUploadFiles.length === 0) return;
    
    // Update UI state
    categorizeBtn.disabled = true;
    categorizeBtn.innerHTML = `<span class="spinner"></span> <span class="ar">جاري التحليل...</span><span class="en">Analyzing...</span>`;
    categorizeBtn.classList.add('processing');
    bulkUploadSection.classList.add('processing');
    
    // Show AI engine
    const aiEngine = document.getElementById('ai-categorization-engine');
    aiEngine.classList.add('show');
    
    // Hide previous results
    document.getElementById('categorization-results').classList.remove('show');
    document.getElementById('categorization-success').classList.remove('show');
    
    // Reset results
    categorizationResults = { suppliers: [], salaries: [], rent: [], misc: [] };
    
    try {
        // Step 1: OCR Reading
        // Mark all steps active with spinners
        for (let i = 1; i <= 4; i++) {
            const step = document.getElementById(`cat-step-${i}`);
            step.classList.add('active');
        }
        
        // Update status
        document.getElementById('engine-status-detail').innerHTML = `
            <span class="ar">بدء معالجة ${bulkUploadFiles.length} ملف...</span>
            <span class="en">Starting to process ${bulkUploadFiles.length} files...</span>
        `;
        
        // Process files with OCR
        await categorizeFiles();
        
        // Mark all steps complete
        for (let i = 1; i <= 4; i++) {
            const step = document.getElementById(`cat-step-${i}`);
            step.classList.remove('active');
            step.classList.add('completed');
            step.querySelector('.cat-step-icon').innerHTML = '<i data-lucide="check" class="icon"></i>';
        }
        lucide.createIcons();
        
        // Show results
        showCategorizationResults();
        
    } catch (error) {
        console.error('Categorization error:', error);
        resetCategorization();
    }
}

// Animate categorization step
async function animateCatStep(stepNum, statusText, delay) {
    const step = document.getElementById(`cat-step-${stepNum}`);
    step.classList.add('active');
    
    // Update status
    document.getElementById('engine-status-detail').innerHTML = statusText;
    
    // Add spinner
    const icon = step.querySelector('.cat-step-icon');
    icon.innerHTML = '<span class="spinner" style="width:18px;height:18px;"></span>';
    
    await sleep(delay);
    
    step.classList.remove('active');
    step.classList.add('completed');
    icon.innerHTML = '<i data-lucide="check" class="icon"></i>';
    lucide.createIcons();
}

// Process files with OCR API
async function categorizeFiles() {
    const totalFiles = bulkUploadFiles.length;
    let processed = 0;
    
    for (const file of bulkUploadFiles) {
        processed++;
        
        // Update status
        document.getElementById('engine-status-detail').innerHTML = `
            <span class="ar">معالجة ${processed} من ${totalFiles}: ${file.name}</span>
            <span class="en">Processing ${processed} of ${totalFiles}: ${file.name}</span>
        `;
        
        try {
            // Convert file to base64
            const base64 = await fileToBase64(file);
            
            // Call OCR API
            const result = await processWithOCR(base64, file.name);
            
            if (result && result.data) {
                const data = result.data;
                const category = data.category || 'misc';
                
                // Log OCR error if present (for debugging)
                if (data.ocr_error) {
                    console.warn('OCR API Error for', file.name, ':', data.ocr_error, data.ocr_error_code);
                }
                
                // Add to results
                categorizationResults[category].push({
                    id: `bulk-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
                    name: file.name,
                    vendor: data.vendor_name || file.name,
                    amount: data.subtotal || data.total || 1000,
                    vat: data.vat_amount || 0,
                    total: data.total || (data.subtotal + (data.vat_amount || 0)),
                    date: data.date,
                    invoiceNumber: data.invoice_number,
                    confidence: data.confidence || 0,
                    isDemo: data.demo || false,
                    ocrError: data.ocr_error || null,
                    originalFile: file
                });
            } else {
                // Fallback to filename-based categorization
                const fallbackResult = categorizeFallback(file);
                categorizationResults[fallbackResult.category].push(fallbackResult);
            }
        } catch (error) {
            console.error('OCR error for file:', file.name, error);
            // Use fallback
            const fallbackResult = categorizeFallback(file);
            categorizationResults[fallbackResult.category].push(fallbackResult);
        }
        
        // Small delay between files to avoid rate limiting
        await sleep(100);
    }
}

// Convert file to base64
function fileToBase64(file) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
    });
}

// Call OCR API
async function processWithOCR(base64Image, filename) {
    try {
        const response = await fetch('/api/ocr', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                image: base64Image,
                filename: filename
            })
        });
        
        if (!response.ok) {
            const error = await response.json();
            console.warn('OCR API error:', error);
            // Return demo data if API fails
            return { data: error.data || null };
        }
        
        return await response.json();
    } catch (error) {
        console.error('OCR fetch error:', error);
        return null;
    }
}

// Fallback filename-based categorization
function categorizeFallback(file) {
    const categoryPatterns = {
        salaries: {
            keywords: ['salary', 'payroll', 'راتب', 'رواتب', 'wages', 'أجور', 'employee', 'موظف', 'staff', 'payslip'],
            amounts: [3500, 4000, 4500, 5000, 5500, 6000, 7000, 8000],
            hasVAT: false
        },
        rent: {
            keywords: ['rent', 'إيجار', 'lease', 'rental', 'property'],
            amounts: [2500, 3000, 3500, 4000, 4500, 5000],
            hasVAT: false
        },
        suppliers: {
            keywords: ['supplier', 'vendor', 'مورد', 'materials', 'inventory', 'purchase', 'wholesale', 'equipment'],
            amounts: [2500, 3500, 5000, 7500, 10000],
            hasVAT: true
        },
        misc: {
            keywords: ['electricity', 'water', 'internet', 'maintenance', 'utility', 'furniture', 'cleaning'],
            amounts: [200, 500, 800, 1200, 1500, 2000],
            hasVAT: true
        }
    };
    
    const fileName = file.name.toLowerCase();
    let category = 'misc';
    
    for (const [cat, patterns] of Object.entries(categoryPatterns)) {
        if (patterns.keywords.some(keyword => fileName.includes(keyword))) {
            category = cat;
            break;
        }
    }
    
    const catPatterns = categoryPatterns[category];
    const amount = catPatterns.amounts[Math.floor(Math.random() * catPatterns.amounts.length)];
    const vat = catPatterns.hasVAT ? Math.round(amount * 0.15) : 0;
    
    return {
        id: `bulk-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,
        name: file.name,
        vendor: file.name,
        amount: amount,
        vat: vat,
        total: amount + vat,
        category: category,
        confidence: 50,
        isDemo: true,
        originalFile: file
    };
}

// Show categorization results
function showCategorizationResults() {
    // Update status
    document.getElementById('engine-status-text').innerHTML = `
        <span class="ar">اكتمل التصنيف!</span>
        <span class="en">Categorization Complete!</span>
    `;
    document.getElementById('engine-status-detail').innerHTML = `
        <span class="ar">تم تصنيف ${bulkUploadFiles.length} فاتورة</span>
        <span class="en">${bulkUploadFiles.length} invoices categorized</span>
    `;
    
    // Build summary tags
    const summaryHTML = [];
    const categories = ['suppliers', 'salaries', 'rent', 'misc'];
    const catLabels = {
        suppliers: { ar: 'موردين', en: 'Suppliers' },
        salaries: { ar: 'رواتب', en: 'Salaries' },
        rent: { ar: 'إيجار', en: 'Rent' },
        misc: { ar: 'أخرى', en: 'Other' }
    };
    
    categories.forEach(cat => {
        const count = categorizationResults[cat].length;
        if (count > 0) {
            summaryHTML.push(`
                <span class="result-tag ${cat}">
                    ${count} <span class="ar">${catLabels[cat].ar}</span><span class="en">${catLabels[cat].en}</span>
                </span>
            `);
        }
    });
    document.getElementById('results-summary').innerHTML = summaryHTML.join('');
    
    // Populate each category
    categories.forEach(cat => {
        const items = categorizationResults[cat];
        const container = document.getElementById(`result-items-${cat}`);
        const countEl = document.getElementById(`result-count-${cat}`);
        const totalEl = document.getElementById(`result-total-${cat}`);
        const categoryEl = document.getElementById(`result-cat-${cat}`);
        
        countEl.textContent = items.length;
        
        if (items.length === 0) {
            categoryEl.classList.add('empty');
            container.innerHTML = '';
            totalEl.textContent = '0 SAR';
        } else {
            categoryEl.classList.remove('empty');
            
            const total = items.reduce((sum, item) => sum + item.amount, 0);
            totalEl.textContent = `${formatNumber(total)} SAR`;
            
            container.innerHTML = items.map(item => `
                <div class="result-cat-item">
                    <i data-lucide="${item.isDemo ? 'file-text' : 'file-check'}" class="icon icon-sm" style="color:${item.isDemo ? '#f59e0b' : '#34d399'};"></i>
                    <div class="result-cat-item-info">
                        <span class="result-cat-item-name">${item.vendor || item.name}</span>
                        ${item.vendor && item.vendor !== item.name ? `<span class="result-cat-item-file">${item.name}</span>` : ''}
                    </div>
                    <span class="result-cat-item-amount">${formatNumber(item.amount)}</span>
                    ${item.vat > 0 ? `<span class="result-cat-item-vat">+${formatNumber(item.vat)} VAT</span>` : ''}
                    ${item.isDemo ? `<span class="demo-badge" title="${item.ocrError || 'Using demo data'}">Demo</span>` : ''}
                </div>
            `).join('');
        }
    });
    
    // Show results section
    document.getElementById('categorization-results').classList.add('show');
    
    // Reset button state
    categorizeBtn.disabled = false;
    categorizeBtn.innerHTML = `
        <i data-lucide="brain" class="icon"></i>
        <span class="ar">بدء التصنيف الذكي</span>
        <span class="en">Start AI Categorization</span>
    `;
    categorizeBtn.classList.remove('processing');
    bulkUploadSection.classList.remove('processing');
    
    lucide.createIcons();
}

// Apply results button
document.getElementById('apply-results-btn').addEventListener('click', applyCategorizationResults);

// Apply categorization results to expense categories
async function applyCategorizationResults() {
    const applyBtn = document.getElementById('apply-results-btn');
    applyBtn.disabled = true;
    applyBtn.innerHTML = `<span class="spinner"></span> <span class="ar">جاري التطبيق...</span><span class="en">Applying...</span>`;
    
    // Show AI processor
    showAIProcessor(isArabic() ? 'جاري نقل الفواتير إلى الفئات...' : 'Moving invoices to categories...');
    
    await sleep(800);
    
    // Add each categorized expense to its category
    const categories = ['suppliers', 'salaries', 'rent', 'misc'];
    
    for (const cat of categories) {
        for (const item of categorizationResults[cat]) {
            // Add to accounting data
            accountingData.expenses[cat].push({
                id: item.id,
                name: item.name,
                amount: item.amount,
                vat: item.vat
            });
            
            // Add to UI
            const container = document.getElementById(`expenses-${cat}`);
            const expenseHTML = `
                <div class="uploaded-expense" id="${item.id}">
                    <i data-lucide="file-check" class="icon icon-sm" style="color:#34d399;"></i>
                    <span class="expense-name">${item.name}</span>
                    <span class="expense-amount">${formatNumber(item.amount)}</span>
                    ${item.vat > 0 ? `<span class="expense-vat">+${formatNumber(item.vat)} VAT</span>` : ''}
                    <button class="remove-expense" onclick="removeExpense('${cat}', '${item.id}')">
                        <i data-lucide="x" class="icon icon-sm"></i>
                    </button>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', expenseHTML);
            
            // Mark category as having expenses
            document.getElementById(`cat-${cat}`).classList.add('has-expenses');
        }
    }
    
    hideAIProcessor();
    
    // Update all totals
    updateAccountingTotals();
    
    // Show success state
    document.getElementById('categorization-results').classList.remove('show');
    document.getElementById('ai-categorization-engine').classList.remove('show');
    document.getElementById('categorization-success').classList.add('show');
    bulkUploadSection.classList.remove('processing');
    bulkUploadSection.classList.add('completed');
    
    // Update button
    categorizeBtn.innerHTML = `
        <i data-lucide="check-circle" class="icon icon-lg"></i>
        <span class="ar">تم التطبيق بنجاح!</span>
        <span class="en">Applied Successfully!</span>
    `;
    categorizeBtn.style.background = 'linear-gradient(135deg, #34d399, #22d3d1)';
    
    // Clear bulk upload data after a delay
    await sleep(2000);
    
    // Reset for new uploads
    bulkUploadFiles = [];
    bulkFileInput.value = '';
    updateBulkFilesPreview();
    
    await sleep(1000);
    
    // Reset the section for new uploads
    resetCategorization();
    categorizeBtn.style.background = '';
    
    // Scroll to show the updated expense categories
    document.getElementById('cat-suppliers').scrollIntoView({ behavior: 'smooth', block: 'center' });
    
    lucide.createIcons();
}

// Extend resetDemo to also reset bulk upload
const originalResetDemo2 = resetDemo;
resetDemo = function() {
    originalResetDemo2();
    clearBulkUpload();
    clearSalesBulkUpload();
};

// Placeholder for clearSalesBulkUpload (no longer needed for POS version)
function clearSalesBulkUpload() {
    // No-op for POS version - sales come from POS system
}

// ============================================== //
// BUSINESS ALERTS FUNCTIONALITY
// ============================================== //

// Alert data structure
// Dynamic date calculation based on today's date
const today = new Date();
today.setHours(0, 0, 0, 0);

// Helper function to add days to today
function addDays(days) {
    const date = new Date(today);
    date.setDate(date.getDate() + days);
    return date;
}

// Helper function to subtract days from today
function subtractDays(days) {
    const date = new Date(today);
    date.setDate(date.getDate() - days);
    return date;
}

// Calculate alert status based on days until due
// Urgent: overdue or due within 3 days
// Warning/This Week: due within 4-7 days
// OK/Upcoming: due in more than 7 days
function calculateAlertStatus(dueDate) {
    const due = new Date(dueDate);
    due.setHours(0, 0, 0, 0);
    const diffTime = due - today;
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
    
    if (diffDays <= 3) return 'urgent';      // Overdue or due within 3 days
    if (diffDays <= 7) return 'warning';     // Due within 4-7 days (This Week)
    return 'ok';                              // Due in more than 7 days (Upcoming)
}

const businessAlerts = {
    financial: [
        // Overdue: VAT filing was due 5 days ago
        { id: 'vat-filing', type: 'vat', dueDate: subtractDays(5), completed: false },
        // Urgent: Electricity due today
        { id: 'electricity', type: 'electricity', dueDate: addDays(0), completed: false },
        // Urgent: Rent due in 2 days
        { id: 'rent', type: 'rent', dueDate: addDays(2), completed: false },
        // This Week: Labor wages due in 5 days
        { id: 'labor', type: 'labor', dueDate: addDays(5), completed: false },
        // This Week: Internet due in 7 days
        { id: 'internet', type: 'internet', dueDate: addDays(7), completed: false },
        // Upcoming: Salary due in 23 days
        { id: 'salary', type: 'salary', dueDate: addDays(23), completed: false }
    ],
    regulatory: [
        // Upcoming: GOSI due in 10 days
        { id: 'gosi', type: 'gosi', dueDate: addDays(10), completed: false },
        // Upcoming: Municipality license due in 38 days
        { id: 'municipality', type: 'municipality', dueDate: addDays(38), completed: false },
        // Upcoming: Chamber membership due in 55 days
        { id: 'chamber', type: 'chamber', dueDate: addDays(55), completed: false },
        // Upcoming: CR renewal due in 135 days
        { id: 'cr', type: 'cr', dueDate: addDays(135), completed: false },
        // Upcoming: Nitaqat review due in 146 days
        { id: 'nitaqat', type: 'nitaqat', dueDate: addDays(146), completed: false }
    ]
};

// Calculate status for each alert based on due date
function initializeAlertStatuses() {
    for (const category of ['financial', 'regulatory']) {
        businessAlerts[category].forEach(alert => {
            alert.status = calculateAlertStatus(alert.dueDate);
        });
    }
}

// Initialize statuses on load
initializeAlertStatuses();

// Notification settings
const notificationSettings = {
    email: true,
    sms: true,
    whatsapp: true,
    push: true
};

// Initialize alerts on page load
document.addEventListener('DOMContentLoaded', function() {
    setTimeout(() => {
        initializeAlerts();
        populateCalendar();
    }, 1000);
});

function initializeAlerts() {
    updateAlertElements();
    updateAlertCounts();
    lucide.createIcons();
}

// Format date for display
function formatAlertDate(date, arabic = false) {
    const months = arabic 
        ? ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو', 'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر']
        : ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
    
    const day = date.getDate();
    const month = months[date.getMonth()];
    const year = date.getFullYear();
    
    if (arabic) {
        const arabicNumerals = ['٠', '١', '٢', '٣', '٤', '٥', '٦', '٧', '٨', '٩'];
        const toArabicNum = (num) => num.toString().split('').map(d => arabicNumerals[parseInt(d)]).join('');
        return `${toArabicNum(day)} ${month} ${toArabicNum(year)}`;
    }
    return `${month} ${day}, ${year}`;
}

// Update alert DOM elements with dynamic dates and statuses
function updateAlertElements() {
    const allAlerts = [...businessAlerts.financial, ...businessAlerts.regulatory];
    
    allAlerts.forEach(alert => {
        const alertEl = document.querySelector(`[data-alert-id="${alert.id}"]`);
        if (!alertEl) return;
        
        // Update status class
        alertEl.classList.remove('urgent', 'warning', 'ok');
        alertEl.classList.add(alert.status);
        
        // Update due date display
        const dueDateEl = alertEl.querySelector('.alert-due-date');
        if (dueDateEl) {
            dueDateEl.classList.remove('urgent', 'warning', 'ok');
            dueDateEl.classList.add(alert.status);
            
            const arSpan = dueDateEl.querySelector('.ar');
            const enSpan = dueDateEl.querySelector('.en');
            
            if (arSpan) arSpan.textContent = formatAlertDate(alert.dueDate, true);
            if (enSpan) enSpan.textContent = formatAlertDate(alert.dueDate, false);
        }
    });
}

// Mark alert as complete
function markAlertComplete(alertId) {
    const alertEl = document.querySelector(`[data-alert-id="${alertId}"]`);
    if (!alertEl) return;
    
    const isCompleted = alertEl.classList.toggle('completed');
    
    // Update alert data
    for (const category of ['financial', 'regulatory']) {
        const alert = businessAlerts[category].find(a => a.id === alertId);
        if (alert) {
            alert.completed = isCompleted;
            break;
        }
    }
    
    // Show feedback
    const btn = alertEl.querySelector('.alert-action-btn.complete');
    if (isCompleted) {
        btn.innerHTML = '<i data-lucide="check-circle" class="icon icon-sm"></i>';
        showAlertToast(isArabic() ? 'تم إكمال المهمة!' : 'Task completed!', 'success');
    } else {
        btn.innerHTML = '<i data-lucide="check" class="icon icon-sm"></i>';
        showAlertToast(isArabic() ? 'تم إلغاء الإكمال' : 'Marked as incomplete', 'info');
    }
    
    lucide.createIcons();
    updateAlertCounts();
}

// Set reminder for alert
function setReminder(alertId) {
    const alert = [...businessAlerts.financial, ...businessAlerts.regulatory].find(a => a.id === alertId);
    if (!alert) return;
    
    // Show reminder options (in a real app, this would open a modal)
    const reminderOptions = isArabic() 
        ? ['قبل يوم واحد', 'قبل ٣ أيام', 'قبل أسبوع', 'قبل شهر']
        : ['1 day before', '3 days before', '1 week before', '1 month before'];
    
    showAlertToast(
        isArabic() 
            ? 'تم تفعيل التذكير! ستصلك إشعارات قبل الموعد' 
            : 'Reminder set! You\'ll receive notifications before the deadline',
        'success'
    );
    
    // Visual feedback
    const alertEl = document.querySelector(`[data-alert-id="${alertId}"]`);
    const btn = alertEl?.querySelector('.alert-action-btn.remind');
    if (btn) {
        btn.style.background = 'rgba(52,211,153,0.3)';
        btn.style.color = '#34d399';
        setTimeout(() => {
            btn.style.background = '';
            btn.style.color = '';
        }, 2000);
    }
}

// Toggle alert details
function toggleAlertDetails(alertId) {
    // In a real app, this would expand to show more details
    console.log('Toggle details for:', alertId);
}

// Update alert counts
function updateAlertCounts() {
    // Recalculate statuses based on current date
    initializeAlertStatuses();
    
    let urgentCount = 0;
    let thisWeekCount = 0;  // "This Week" = warning status (4-7 days)
    let upcomingCount = 0;
    let completedCount = 0;
    
    const allAlerts = [...businessAlerts.financial, ...businessAlerts.regulatory];
    
    allAlerts.forEach(alert => {
        if (alert.completed) {
            completedCount++;
        } else if (alert.status === 'urgent') {
            urgentCount++;
        } else if (alert.status === 'warning') {
            thisWeekCount++;  // Warning = This Week (4-7 days)
        } else {
            upcomingCount++;
        }
    });
    
    // Update summary stats
    document.getElementById('urgent-count').textContent = urgentCount;
    document.getElementById('warning-count').textContent = thisWeekCount;  // "This Week" count
    document.getElementById('upcoming-count').textContent = upcomingCount;
    document.getElementById('completed-count').textContent = completedCount;
    
    // Update panel badges - count by status within each category
    const financialUrgent = businessAlerts.financial.filter(a => !a.completed && a.status === 'urgent').length;
    const financialOther = businessAlerts.financial.filter(a => !a.completed && a.status !== 'urgent').length;
    const regulatoryUrgent = businessAlerts.regulatory.filter(a => !a.completed && a.status === 'urgent').length;
    const regulatoryOk = businessAlerts.regulatory.filter(a => !a.completed && a.status !== 'urgent').length;
    
    document.getElementById('financial-urgent').textContent = financialUrgent;
    document.getElementById('financial-warning').textContent = financialOther;
    document.getElementById('regulatory-warning').textContent = regulatoryUrgent;
    document.getElementById('regulatory-ok').textContent = regulatoryOk;
}

// Toggle notification option
function toggleNotification(element, type) {
    element.classList.toggle('active');
    notificationSettings[type] = element.classList.contains('active');
    
    showAlertToast(
        notificationSettings[type]
            ? (isArabic() ? `تم تفعيل إشعارات ${getNotificationLabel(type)}` : `${getNotificationLabel(type)} notifications enabled`)
            : (isArabic() ? `تم إيقاف إشعارات ${getNotificationLabel(type)}` : `${getNotificationLabel(type)} notifications disabled`),
        'info'
    );
}

function getNotificationLabel(type) {
    const labels = {
        email: isArabic() ? 'البريد الإلكتروني' : 'Email',
        sms: 'SMS',
        whatsapp: 'WhatsApp',
        push: isArabic() ? 'الإشعارات الفورية' : 'Push'
    };
    return labels[type] || type;
}

// Show add alert modal (placeholder)
function showAddAlertModal() {
    showAlertToast(
        isArabic() 
            ? 'قريباً! إضافة تنبيهات مخصصة' 
            : 'Coming soon! Add custom alerts',
        'info'
    );
}

// Navigate calendar
let currentCalendarMonth = 1; // February (0-indexed)
let currentCalendarYear = 2026;

function navigateCalendar(direction) {
    currentCalendarMonth += direction;
    if (currentCalendarMonth > 11) {
        currentCalendarMonth = 0;
        currentCalendarYear++;
    } else if (currentCalendarMonth < 0) {
        currentCalendarMonth = 11;
        currentCalendarYear--;
    }
    populateCalendar();
}

// Get alert display name by type
function getAlertName(type, arabic = false) {
    const names = {
        'vat': { ar: 'ضريبة القيمة المضافة', en: 'VAT Filing' },
        'electricity': { ar: 'فاتورة الكهرباء', en: 'Electricity Bill' },
        'rent': { ar: 'دفع الإيجار', en: 'Rent Payment' },
        'salary': { ar: 'رواتب الموظفين', en: 'Employee Salaries' },
        'labor': { ar: 'أجور العمالة', en: 'Labor Wages' },
        'internet': { ar: 'فاتورة الإنترنت', en: 'Internet Bill' },
        'municipality': { ar: 'رخصة البلدية', en: 'Municipality License' },
        'cr': { ar: 'السجل التجاري', en: 'Commercial Registration' },
        'gosi': { ar: 'التأمينات الاجتماعية', en: 'GOSI Payment' },
        'chamber': { ar: 'الغرفة التجارية', en: 'Chamber of Commerce' },
        'nitaqat': { ar: 'نطاقات', en: 'Nitaqat Review' }
    };
    
    const alertName = names[type];
    if (alertName) {
        return arabic ? alertName.ar : alertName.en;
    }
    return type; // Fallback to type if not found
}

// Populate calendar with alerts
function populateCalendar() {
    const grid = document.getElementById('calendar-grid');
    if (!grid) return;
    
    // Keep day headers
    const headers = grid.querySelectorAll('.calendar-day-header');
    grid.innerHTML = '';
    headers.forEach(h => grid.appendChild(h));
    
    const year = currentCalendarYear;
    const month = currentCalendarMonth;
    
    // Get first day of month and total days
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const daysInPrevMonth = new Date(year, month, 0).getDate();
    
    // Get all alert dates for this month - store full alert data for tooltips
    const allAlerts = [...businessAlerts.financial, ...businessAlerts.regulatory];
    const alertDates = {};
    allAlerts.forEach(alert => {
        if (!alert.completed && alert.dueDate.getMonth() === month && alert.dueDate.getFullYear() === year) {
            const day = alert.dueDate.getDate();
            if (!alertDates[day]) alertDates[day] = [];
            alertDates[day].push(alert); // Store full alert object for tooltip
        }
    });
    
    const today = new Date();
    const isCurrentMonth = today.getMonth() === month && today.getFullYear() === year;
    
    // Previous month days
    for (let i = firstDay - 1; i >= 0; i--) {
        const dayEl = document.createElement('div');
        dayEl.className = 'calendar-day other-month';
        dayEl.textContent = daysInPrevMonth - i;
        grid.appendChild(dayEl);
    }
    
    // Current month days
    for (let day = 1; day <= daysInMonth; day++) {
        const dayEl = document.createElement('div');
        dayEl.className = 'calendar-day';
        dayEl.textContent = day;
        
        if (isCurrentMonth && day === today.getDate()) {
            dayEl.classList.add('today');
        }
        
        if (alertDates[day]) {
            dayEl.classList.add('has-alert');
            const alerts = alertDates[day];
            const statuses = alerts.map(a => a.status);
            
            // Prioritize urgent > warning > normal for the dot color
            if (statuses.includes('urgent')) {
                dayEl.classList.add('has-urgent');
            } else if (statuses.includes('warning')) {
                dayEl.classList.add('has-warning');
            } else {
                dayEl.classList.add('has-normal');
            }
            
            // Create tooltip with alert details
            const tooltip = document.createElement('div');
            tooltip.className = 'calendar-tooltip';
            
            const titleText = isArabic() ? 'المهام المستحقة' : 'Due Tasks';
            let tooltipHTML = `<div class="tooltip-title">${titleText}</div>`;
            
            alerts.forEach(alert => {
                const alertName = getAlertName(alert.type, isArabic());
                tooltipHTML += `
                    <div class="tooltip-alert">
                        <div class="tooltip-alert-dot ${alert.status}"></div>
                        <div>
                            <div class="tooltip-alert-text">${alertName}</div>
                        </div>
                    </div>
                `;
            });
            
            tooltip.innerHTML = tooltipHTML;
            dayEl.appendChild(tooltip);
        }
        
        grid.appendChild(dayEl);
    }
    
    // Next month days to fill the grid
    const totalCells = grid.children.length;
    const remainingCells = 42 - (totalCells - 7); // 6 rows * 7 days - header row
    for (let day = 1; day <= remainingCells && totalCells + day - 7 < 42; day++) {
        const dayEl = document.createElement('div');
        dayEl.className = 'calendar-day other-month';
        dayEl.textContent = day;
        grid.appendChild(dayEl);
    }
    
    // Update calendar title
    const monthNames = isArabic() 
        ? ['يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو', 'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر']
        : ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
    
    const calendarTitle = document.querySelector('.calendar-title span');
    if (calendarTitle) {
        calendarTitle.innerHTML = `
            <span class="ar">تقويم المواعيد - ${monthNames[month]} ${year}</span>
            <span class="en">Deadline Calendar - ${monthNames[month]} ${year}</span>
        `;
    }
}

// Show toast notification
function showAlertToast(message, type = 'info') {
    // Remove existing toast
    const existingToast = document.querySelector('.alert-toast');
    if (existingToast) existingToast.remove();
    
    const toast = document.createElement('div');
    toast.className = 'alert-toast';
    toast.style.cssText = `
        position: fixed;
        bottom: 2rem;
        left: 50%;
        transform: translateX(-50%);
        padding: 1rem 1.5rem;
        border-radius: 12px;
        font-size: 0.9rem;
        font-weight: 500;
        z-index: 1000;
        animation: fadeIn 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        ${type === 'success' 
            ? 'background: rgba(52,211,153,0.9); color: #020617;' 
            : 'background: rgba(59,130,246,0.9); color: #fff;'}
    `;
    
    const icon = type === 'success' ? 'check-circle' : 'info';
    toast.innerHTML = `<i data-lucide="${icon}" class="icon" style="width:18px;height:18px;"></i> ${message}`;
    
    document.body.appendChild(toast);
    lucide.createIcons();
    
    setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transition = 'opacity 0.3s ease';
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}
</script>

</body>
</html>
