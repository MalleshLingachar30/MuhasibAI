<!DOCTYPE html>
<html lang="ar" dir="rtl" id="html-root">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مُحاسِب - تجربة الفوترة الإلكترونية | E-Invoicing Demo</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <!-- PDF Generation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        /* Base Styles from main site */
        .icon { display: inline-flex; align-items: center; justify-content: center; vertical-align: middle; }
        .icon svg { width: 1em; height: 1em; stroke-width: 2; }
        .icon-sm svg { width: 0.875em; height: 0.875em; }
        .icon-lg svg { width: 1.25em; height: 1.25em; }
        .icon-xl svg { width: 2em; height: 2em; }
        .icon-2xl svg { width: 2.5em; height: 2.5em; }
        .icon-3xl svg { width: 3rem; height: 3rem; }
        .icon-4xl svg { width: 4rem; height: 4rem; }
        .icon-emerald { color: #34d399; }
        .icon-purple { color: #a78bfa; }
        .icon-cyan { color: #22d3d1; }
        .icon-white { color: #fff; }
        .icon-amber { color: #fbbf24; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Tajawal', sans-serif; background: #020617; color: #fff; line-height: 1.6; min-height: 100vh; }
        [dir="ltr"] body { font-family: 'Inter', sans-serif; }
        a { text-decoration: none; color: inherit; }
        
        /* Header */
        header { position: fixed; top: 0; width: 100%; background: rgba(2,6,23,0.9); backdrop-filter: blur(8px); z-index: 50; border-bottom: 1px solid #1e293b; }
        .header-inner { display: flex; justify-content: space-between; align-items: center; padding: 1rem 2rem; max-width: 1400px; margin: 0 auto; }
        .logo { display: flex; align-items: center; gap: 0.5rem; }
        .logo-icon { width: 40px; height: 40px; background: linear-gradient(135deg, #a78bfa, #818cf8); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #020617; font-size: 1.25rem; }
        .logo-text { font-size: 1.25rem; font-weight: bold; }
        .header-actions { display: flex; align-items: center; gap: 1rem; }
        .lang-toggle { display: flex; background: #1e293b; border-radius: 8px; padding: 4px; }
        .lang-btn { padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.875rem; font-weight: 500; border: none; cursor: pointer; transition: all 0.3s; background: transparent; color: #94a3b8; }
        .lang-btn.active { background: #a78bfa; color: #fff; }
        .back-btn { display: flex; align-items: center; gap: 0.5rem; color: #94a3b8; font-size: 0.875rem; transition: color 0.3s; }
        .back-btn:hover { color: #fff; }
        
        /* Main Container */
        .demo-container { padding: 7rem 2rem 3rem; max-width: 1400px; margin: 0 auto; }
        
        /* Page Header */
        .page-header { text-align: center; margin-bottom: 2rem; }
        .page-badge { display: inline-flex; align-items: center; gap: 0.5rem; background: rgba(167,139,250,0.15); border: 1px solid rgba(167,139,250,0.3); border-radius: 50px; padding: 0.5rem 1.25rem; color: #a78bfa; font-size: 0.875rem; margin-bottom: 1rem; }
        .page-title { font-size: 2rem; font-weight: 800; margin-bottom: 0.75rem; }
        @media(min-width:768px) { .page-title { font-size: 2.5rem; } }
        .gradient-text { background: linear-gradient(to left, #a78bfa, #818cf8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
        .page-subtitle { color: #94a3b8; font-size: 1rem; max-width: 600px; margin: 0 auto; }
        
        /* Demo Flow Container */
        .demo-flow { display: grid; grid-template-columns: 1fr auto 1fr auto 1fr; align-items: stretch; gap: 1rem; margin-top: 2rem; }
        @media(max-width: 1024px) { 
            .demo-flow { grid-template-columns: 1fr; gap: 1.5rem; }
            .flow-arrow { display: none; }
        }
        
        /* Flow Arrows */
        .flow-arrow { display: flex; align-items: center; justify-content: center; padding: 0 0.5rem; }
        .flow-arrow svg { width: 2rem; height: 2rem; color: #475569; transition: color 0.3s; }
        .flow-arrow.active svg { color: #a78bfa; }
        [dir="ltr"] .flow-arrow { transform: scaleX(-1); }
        
        /* Demo Cards */
        .demo-card { background: linear-gradient(135deg, rgba(30,41,59,0.9), rgba(15,23,42,0.9)); border-radius: 20px; border: 1px solid #1e293b; overflow: hidden; display: flex; flex-direction: column; min-height: 450px; transition: all 0.3s; }
        .demo-card.active { border-color: rgba(167,139,250,0.5); box-shadow: 0 0 40px rgba(167,139,250,0.15); }
        .demo-card.completed { border-color: rgba(52,211,153,0.5); }
        
        .card-header { padding: 1.25rem 1.5rem; border-bottom: 1px solid #1e293b; display: flex; align-items: center; gap: 1rem; }
        .card-icon-wrapper { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .card-icon-wrapper.business { background: linear-gradient(135deg, rgba(167,139,250,0.2), rgba(129,140,248,0.2)); }
        .card-icon-wrapper.ai { background: linear-gradient(135deg, rgba(52,211,153,0.2), rgba(34,211,209,0.2)); }
        .card-icon-wrapper.zatca { background: linear-gradient(135deg, rgba(251,191,36,0.2), rgba(245,158,11,0.2)); }
        .card-title { font-size: 1rem; font-weight: 700; margin-bottom: 0.25rem; }
        .card-label { font-size: 0.75rem; color: #64748b; text-transform: uppercase; letter-spacing: 0.05em; }
        .card-status { margin-right: auto; margin-left: 0; }
        [dir="ltr"] .card-status { margin-left: auto; margin-right: 0; }
        
        .status-badge { display: inline-flex; align-items: center; gap: 0.35rem; padding: 0.25rem 0.75rem; border-radius: 50px; font-size: 0.75rem; font-weight: 500; }
        .status-badge.waiting { background: rgba(100,116,139,0.2); color: #94a3b8; }
        .status-badge.processing { background: rgba(167,139,250,0.2); color: #a78bfa; }
        .status-badge.success { background: rgba(52,211,153,0.2); color: #34d399; }
        .status-badge.error { background: rgba(248,113,113,0.2); color: #f87171; }
        
        .card-content { flex: 1; padding: 1.5rem; display: flex; flex-direction: column; }
        
        /* Upload Zone */
        .upload-zone { flex: 1; border: 2px dashed #334155; border-radius: 16px; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem; cursor: pointer; transition: all 0.3s; text-align: center; }
        .upload-zone:hover { border-color: #a78bfa; background: rgba(167,139,250,0.05); }
        .upload-zone.drag-over { border-color: #a78bfa; background: rgba(167,139,250,0.1); }
        .upload-zone.has-file { border-style: solid; border-color: #34d399; background: rgba(52,211,153,0.05); cursor: default; }
        .upload-icon { font-size: 3rem; margin-bottom: 1rem; color: #64748b; }
        .upload-zone.has-file .upload-icon { color: #34d399; }
        .upload-text { font-size: 0.9rem; color: #94a3b8; margin-bottom: 0.5rem; }
        .upload-hint { font-size: 0.75rem; color: #64748b; }
        .upload-input { display: none; }
        
        /* File Preview */
        .file-preview { display: none; flex: 1; flex-direction: column; }
        .file-preview.show { display: flex; }
        .file-info { display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(51,65,85,0.3); border-radius: 12px; margin-bottom: 1rem; }
        .file-icon { width: 48px; height: 48px; background: rgba(167,139,250,0.2); border-radius: 8px; display: flex; align-items: center; justify-content: center; }
        .file-name { font-size: 0.875rem; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .file-size { font-size: 0.75rem; color: #64748b; }
        .file-remove { margin-right: auto; margin-left: 0; background: none; border: none; color: #64748b; cursor: pointer; padding: 0.5rem; transition: color 0.3s; }
        [dir="ltr"] .file-remove { margin-left: auto; margin-right: 0; }
        .file-remove:hover { color: #f87171; }
        
        .invoice-preview { flex: 1; background: #0f172a; border-radius: 12px; padding: 1rem; overflow: hidden; display: flex; align-items: center; justify-content: center; }
        .invoice-preview img { max-width: 100%; max-height: 200px; border-radius: 8px; object-fit: contain; }
        .invoice-preview .pdf-placeholder { text-align: center; color: #64748b; }
        
        .upload-btn { margin-top: 1rem; background: linear-gradient(to right, #a78bfa, #818cf8); border: none; padding: 0.875rem 1.5rem; border-radius: 10px; font-weight: 600; color: #fff; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 0.5rem; width: 100%; }
        .upload-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(167,139,250,0.3); }
        .upload-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; box-shadow: none; }
        
        /* AI Agent Center */
        .ai-agent-center { display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .ai-avatar { width: 100px; height: 100px; border-radius: 24px; background: linear-gradient(135deg, #34d399, #22d3d1); display: flex; align-items: center; justify-content: center; font-size: 2.5rem; font-weight: bold; color: #020617; margin-bottom: 1.5rem; position: relative; }
        .ai-avatar::after { content: ''; position: absolute; inset: -4px; border-radius: 28px; border: 2px solid transparent; background: linear-gradient(135deg, #34d399, #22d3d1) border-box; -webkit-mask: linear-gradient(#fff 0 0) padding-box, linear-gradient(#fff 0 0); -webkit-mask-composite: xor; mask-composite: exclude; opacity: 0; animation: pulse-ring 2s ease-out infinite; }
        .ai-agent-center.processing .ai-avatar::after { opacity: 1; }
        
        @keyframes pulse-ring { 0% { transform: scale(1); opacity: 0.5; } 100% { transform: scale(1.2); opacity: 0; } }
        
        .ai-status { font-size: 1rem; font-weight: 600; margin-bottom: 0.5rem; }
        .ai-message { font-size: 0.85rem; color: #94a3b8; margin-bottom: 1.5rem; min-height: 40px; }
        
        /* Processing Steps */
        .processing-steps { width: 100%; }
        .step-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: rgba(51,65,85,0.2); border-radius: 10px; margin-bottom: 0.5rem; font-size: 0.85rem; transition: all 0.3s; }
        .step-item.active { background: rgba(167,139,250,0.15); }
        .step-item.completed { background: rgba(52,211,153,0.1); }
        .step-icon { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; background: rgba(100,116,139,0.3); color: #64748b; flex-shrink: 0; }
        .step-item.active .step-icon { background: rgba(167,139,250,0.3); color: #a78bfa; }
        .step-item.completed .step-icon { background: rgba(52,211,153,0.3); color: #34d399; }
        .step-text { color: #94a3b8; }
        .step-item.active .step-text { color: #fff; }
        .step-item.completed .step-text { color: #e2e8f0; }
        
        /* Spinner */
        .spinner { width: 16px; height: 16px; border: 2px solid transparent; border-top-color: currentColor; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* ZATCA Section */
        .zatca-content { display: flex; flex-direction: column; gap: 1rem; }
        .zatca-status-box { background: rgba(51,65,85,0.3); border-radius: 12px; padding: 1.25rem; text-align: center; }
        .zatca-logo { width: 80px; height: 80px; background: rgba(251,191,36,0.15); border-radius: 16px; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem; }
        .zatca-logo img { width: 60px; height: 60px; }
        .zatca-title { font-size: 1rem; font-weight: 600; margin-bottom: 0.25rem; }
        .zatca-subtitle { font-size: 0.8rem; color: #64748b; }
        
        /* Validation Results */
        .validation-result { display: none; flex-direction: column; gap: 0.75rem; }
        .validation-result.show { display: flex; }
        .result-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: rgba(51,65,85,0.2); border-radius: 10px; font-size: 0.85rem; }
        .result-item.success { background: rgba(52,211,153,0.1); }
        .result-icon { width: 24px; height: 24px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .result-item.success .result-icon { background: rgba(52,211,153,0.3); color: #34d399; }
        
        /* Approved Invoice */
        .approved-invoice { display: none; }
        .approved-invoice.show { display: block; }
        .approved-badge { display: flex; align-items: center; justify-content: center; gap: 0.5rem; background: rgba(52,211,153,0.15); border: 1px solid rgba(52,211,153,0.3); border-radius: 12px; padding: 1rem; margin-bottom: 1rem; }
        .approved-badge span { color: #34d399; font-weight: 600; font-size: 0.9rem; }
        
        .qr-code-box { background: #fff; border-radius: 12px; padding: 1rem; text-align: center; margin-bottom: 1rem; }
        .qr-code { width: 120px; height: 120px; background: linear-gradient(45deg, #000 25%, transparent 25%), linear-gradient(-45deg, #000 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #000 75%), linear-gradient(-45deg, transparent 75%, #000 75%); background-size: 20px 20px; background-position: 0 0, 0 10px, 10px -10px, -10px 0px; margin: 0 auto 0.5rem; border-radius: 8px; }
        .qr-label { font-size: 0.7rem; color: #64748b; }
        
        .invoice-id { background: rgba(51,65,85,0.3); border-radius: 10px; padding: 1rem; }
        .invoice-id-label { font-size: 0.75rem; color: #64748b; margin-bottom: 0.25rem; }
        .invoice-id-value { font-family: 'Courier New', monospace; font-size: 0.8rem; color: #a78bfa; word-break: break-all; }
        
        .download-btn { margin-top: 1rem; background: linear-gradient(to right, #34d399, #22d3d1); border: none; padding: 0.875rem 1.5rem; border-radius: 10px; font-weight: 600; color: #020617; cursor: pointer; font-size: 0.9rem; transition: all 0.3s; display: flex; align-items: center; justify-content: center; gap: 0.5rem; width: 100%; }
        .download-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(52,211,153,0.3); }
        
        /* Customer Delivery */
        .customer-delivery { display: none; margin-top: 1rem; padding-top: 1rem; border-top: 1px solid #1e293b; }
        .customer-delivery.show { display: block; }
        .delivery-header { display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem; }
        .delivery-icon { width: 40px; height: 40px; background: rgba(167,139,250,0.2); border-radius: 10px; display: flex; align-items: center; justify-content: center; }
        .delivery-title { font-size: 0.9rem; font-weight: 600; }
        .delivery-subtitle { font-size: 0.75rem; color: #64748b; }
        .delivery-options { display: flex; gap: 0.5rem; }
        .delivery-option { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 0.5rem; padding: 1rem; background: rgba(51,65,85,0.3); border-radius: 10px; cursor: pointer; transition: all 0.3s; border: 1px solid transparent; }
        .delivery-option:hover { background: rgba(167,139,250,0.1); border-color: rgba(167,139,250,0.3); }
        .delivery-option span { font-size: 0.75rem; color: #94a3b8; }
        
        /* Reset Button */
        .reset-section { text-align: center; margin-top: 2rem; padding-top: 2rem; border-top: 1px solid #1e293b; }
        .reset-btn { background: rgba(51,65,85,0.5); border: 1px solid #334155; padding: 0.75rem 2rem; border-radius: 10px; color: #94a3b8; cursor: pointer; font-size: 0.875rem; transition: all 0.3s; }
        .reset-btn:hover { background: rgba(51,65,85,0.8); color: #fff; }
        
        /* Language */
        .en { display: none; }
        .ar { display: inline; }
        [dir="ltr"] .en { display: inline; }
        [dir="ltr"] .ar { display: none; }
        
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-in { animation: fadeIn 0.5s ease forwards; }
        
        /* Mobile Adjustments */
        @media(max-width: 768px) {
            .demo-container { padding: 6rem 1rem 2rem; }
            .demo-card { min-height: auto; }
            .page-title { font-size: 1.75rem; }
        }
    </style>
</head>
<body>

<header>
    <div class="header-inner">
        <div class="logo">
            <div class="logo-icon">م</div>
            <span class="logo-text">Muhasib</span>
        </div>
        <div class="header-actions">
            <a href="index.html" class="back-btn">
                <i data-lucide="arrow-right" class="icon"></i>
                <span class="ar">الرجوع للرئيسية</span>
                <span class="en">Back to Home</span>
            </a>
            <div class="lang-toggle">
                <button class="lang-btn active" id="btn-ar" onclick="setLang('ar')">عربي</button>
                <button class="lang-btn" id="btn-en" onclick="setLang('en')">EN</button>
            </div>
        </div>
    </div>
</header>

<main class="demo-container">
    <!-- Page Header -->
    <div class="page-header">
        <div class="page-badge">
            <i data-lucide="zap" class="icon icon-sm"></i>
            <span class="ar">تجربة تفاعلية</span>
            <span class="en">Interactive Demo</span>
        </div>
        <h1 class="page-title">
            <span class="gradient-text"><span class="ar">فوترة إلكترونية متوافقة مع زاتكا</span><span class="en">ZATCA Compliant E-Invoicing</span></span>
        </h1>
        <p class="page-subtitle">
            <span class="ar">شاهد كيف يساعدك محاسب AI في إصدار فواتير إلكترونية معتمدة من الحكومة بخطوات بسيطة</span>
            <span class="en">See how Muhasib AI helps you issue government-approved e-invoices in simple steps</span>
        </p>
    </div>
    
    <!-- Demo Flow -->
    <div class="demo-flow">
        <!-- Card 1: Business/Upload -->
        <div class="demo-card" id="card-business">
            <div class="card-header">
                <div class="card-icon-wrapper business">
                    <i data-lucide="building-2" class="icon icon-xl icon-purple"></i>
                </div>
                <div>
                    <div class="card-label"><span class="ar">الخطوة ١</span><span class="en">Step 1</span></div>
                    <div class="card-title"><span class="ar">رفع الفاتورة</span><span class="en">Upload Invoice</span></div>
                </div>
                <div class="card-status">
                    <span class="status-badge waiting" id="status-business">
                        <span class="ar">في انتظار الفاتورة</span>
                        <span class="en">Waiting for invoice</span>
                    </span>
                </div>
            </div>
            <div class="card-content">
                <!-- Upload Zone -->
                <div class="upload-zone" id="upload-zone">
                    <input type="file" class="upload-input" id="file-input" accept="image/*,.pdf">
                    <div class="upload-icon">
                        <i data-lucide="upload-cloud" class="icon icon-4xl"></i>
                    </div>
                    <div class="upload-text">
                        <span class="ar">اسحب الفاتورة هنا أو انقر للرفع</span>
                        <span class="en">Drag invoice here or click to upload</span>
                    </div>
                    <div class="upload-hint">
                        <span class="ar">PDF, PNG, JPG (حد أقصى 10MB)</span>
                        <span class="en">PDF, PNG, JPG (max 10MB)</span>
                    </div>
                </div>
                
                <!-- File Preview -->
                <div class="file-preview" id="file-preview">
                    <div class="file-info">
                        <div class="file-icon">
                            <i data-lucide="file-text" class="icon icon-xl icon-purple"></i>
                        </div>
                        <div>
                            <div class="file-name" id="file-name">invoice.pdf</div>
                            <div class="file-size" id="file-size">2.4 MB</div>
                        </div>
                        <button class="file-remove" id="file-remove">
                            <i data-lucide="x" class="icon icon-lg"></i>
                        </button>
                    </div>
                    <div class="invoice-preview" id="invoice-preview">
                        <div class="pdf-placeholder">
                            <i data-lucide="file-text" class="icon icon-3xl" style="color:#64748b;"></i>
                            <p style="margin-top:0.5rem;font-size:0.8rem;"><span class="ar">معاينة الفاتورة</span><span class="en">Invoice Preview</span></p>
                        </div>
                    </div>
                    <button class="upload-btn" id="process-btn">
                        <i data-lucide="send" class="icon"></i>
                        <span class="ar">إرسال للمعالجة</span>
                        <span class="en">Send for Processing</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Arrow 1 -->
        <div class="flow-arrow" id="arrow-1">
            <i data-lucide="arrow-left" class="icon"></i>
        </div>
        
        <!-- Card 2: AI Agent -->
        <div class="demo-card" id="card-ai">
            <div class="card-header">
                <div class="card-icon-wrapper ai">
                    <i data-lucide="bot" class="icon icon-xl icon-emerald"></i>
                </div>
                <div>
                    <div class="card-label"><span class="ar">الخطوة ٢</span><span class="en">Step 2</span></div>
                    <div class="card-title"><span class="ar">معالجة AI</span><span class="en">AI Processing</span></div>
                </div>
                <div class="card-status">
                    <span class="status-badge waiting" id="status-ai">
                        <span class="ar">في انتظار البيانات</span>
                        <span class="en">Waiting for data</span>
                    </span>
                </div>
            </div>
            <div class="card-content">
                <div class="ai-agent-center" id="ai-agent">
                    <div class="ai-avatar">م</div>
                    <div class="ai-status" id="ai-status-text">
                        <span class="ar">جاهز للمعالجة</span>
                        <span class="en">Ready to Process</span>
                    </div>
                    <div class="ai-message" id="ai-message">
                        <span class="ar">ارفع فاتورتك وسأقوم بالتحقق منها وإرسالها لزاتكا</span>
                        <span class="en">Upload your invoice and I'll validate it and send to ZATCA</span>
                    </div>
                    
                    <!-- Processing Steps -->
                    <div class="processing-steps" id="processing-steps">
                        <div class="step-item" id="step-1">
                            <div class="step-icon"><i data-lucide="scan" class="icon icon-sm"></i></div>
                            <span class="step-text"><span class="ar">قراءة بيانات الفاتورة</span><span class="en">Reading invoice data</span></span>
                        </div>
                        <div class="step-item" id="step-2">
                            <div class="step-icon"><i data-lucide="check-circle" class="icon icon-sm"></i></div>
                            <span class="step-text"><span class="ar">التحقق من الامتثال</span><span class="en">Validating compliance</span></span>
                        </div>
                        <div class="step-item" id="step-3">
                            <div class="step-icon"><i data-lucide="calculator" class="icon icon-sm"></i></div>
                            <span class="step-text"><span class="ar">حساب الضريبة</span><span class="en">Calculating VAT</span></span>
                        </div>
                        <div class="step-item" id="step-4">
                            <div class="step-icon"><i data-lucide="send" class="icon icon-sm"></i></div>
                            <span class="step-text"><span class="ar">إرسال إلى زاتكا</span><span class="en">Sending to ZATCA</span></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Arrow 2 -->
        <div class="flow-arrow" id="arrow-2">
            <i data-lucide="arrow-left" class="icon"></i>
        </div>
        
        <!-- Card 3: ZATCA & Customer -->
        <div class="demo-card" id="card-zatca">
            <div class="card-header">
                <div class="card-icon-wrapper zatca">
                    <i data-lucide="shield-check" class="icon icon-xl icon-amber"></i>
                </div>
                <div>
                    <div class="card-label"><span class="ar">الخطوة ٣</span><span class="en">Step 3</span></div>
                    <div class="card-title"><span class="ar">اعتماد زاتكا</span><span class="en">ZATCA Approval</span></div>
                </div>
                <div class="card-status">
                    <span class="status-badge waiting" id="status-zatca">
                        <span class="ar">في الانتظار</span>
                        <span class="en">Waiting</span>
                    </span>
                </div>
            </div>
            <div class="card-content">
                <div class="zatca-content">
                    <!-- Initial State -->
                    <div class="zatca-status-box" id="zatca-waiting">
                        <div class="zatca-logo">
                            <i data-lucide="landmark" class="icon icon-3xl icon-amber"></i>
                        </div>
                        <div class="zatca-title">
                            <span class="ar">بوابة زاتكا</span>
                            <span class="en">ZATCA Portal</span>
                        </div>
                        <div class="zatca-subtitle">
                            <span class="ar">هيئة الزكاة والضريبة والجمارك</span>
                            <span class="en">Zakat, Tax and Customs Authority</span>
                        </div>
                    </div>
                    
                    <!-- Validation Results -->
                    <div class="validation-result" id="validation-result">
                        <div class="result-item success">
                            <div class="result-icon"><i data-lucide="check" class="icon icon-sm"></i></div>
                            <span><span class="ar">الرقم الضريبي صالح</span><span class="en">Tax ID valid</span></span>
                        </div>
                        <div class="result-item success">
                            <div class="result-icon"><i data-lucide="check" class="icon icon-sm"></i></div>
                            <span><span class="ar">بيانات الفاتورة مكتملة</span><span class="en">Invoice data complete</span></span>
                        </div>
                        <div class="result-item success">
                            <div class="result-icon"><i data-lucide="check" class="icon icon-sm"></i></div>
                            <span><span class="ar">حساب الضريبة صحيح</span><span class="en">VAT calculation correct</span></span>
                        </div>
                    </div>
                    
                    <!-- Approved Invoice -->
                    <div class="approved-invoice" id="approved-invoice">
                        <div class="approved-badge">
                            <i data-lucide="badge-check" class="icon icon-lg icon-emerald"></i>
                            <span><span class="ar">تمت الموافقة</span><span class="en">Approved</span></span>
                        </div>
                        <div class="qr-code-box">
                            <div class="qr-code" id="qr-code"></div>
                            <div class="qr-label"><span class="ar">رمز التحقق</span><span class="en">Verification QR</span></div>
                        </div>
                        <div class="invoice-id">
                            <div class="invoice-id-label"><span class="ar">معرّف الفاتورة من زاتكا</span><span class="en">ZATCA Invoice ID</span></div>
                            <div class="invoice-id-value" id="zatca-id">INV-2026-ZATCA-A1B2C3D4E5F6</div>
                        </div>
                        <button class="download-btn" id="download-btn">
                            <i data-lucide="download" class="icon"></i>
                            <span class="ar">تحميل الفاتورة المعتمدة</span>
                            <span class="en">Download Approved Invoice</span>
                        </button>
                    </div>
                    
                    <!-- Customer Delivery -->
                    <div class="customer-delivery" id="customer-delivery">
                        <div class="delivery-header">
                            <div class="delivery-icon">
                                <i data-lucide="user-check" class="icon icon-lg icon-purple"></i>
                            </div>
                            <div>
                                <div class="delivery-title"><span class="ar">إرسال للعميل</span><span class="en">Send to Customer</span></div>
                                <div class="delivery-subtitle"><span class="ar">اختر طريقة الإرسال</span><span class="en">Choose delivery method</span></div>
                            </div>
                        </div>
                        <div class="delivery-options">
                            <div class="delivery-option" onclick="deliverInvoice('whatsapp')">
                                <i data-lucide="message-circle" class="icon icon-xl" style="color:#25D366;"></i>
                                <span>WhatsApp</span>
                            </div>
                            <div class="delivery-option" onclick="deliverInvoice('email')">
                                <i data-lucide="mail" class="icon icon-xl" style="color:#ea4335;"></i>
                                <span><span class="ar">بريد</span><span class="en">Email</span></span>
                            </div>
                            <div class="delivery-option" onclick="deliverInvoice('sms')">
                                <i data-lucide="smartphone" class="icon icon-xl" style="color:#a78bfa;"></i>
                                <span>SMS</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Reset Section -->
    <div class="reset-section" id="reset-section" style="display:none;">
        <button class="reset-btn" onclick="resetDemo()">
            <i data-lucide="rotate-ccw" class="icon icon-sm"></i>
            <span class="ar">إعادة التجربة</span>
            <span class="en">Reset Demo</span>
        </button>
    </div>
</main>

<script>
// Language Toggle
function setLang(lang) {
    const html = document.getElementById('html-root');
    const btnAr = document.getElementById('btn-ar');
    const btnEn = document.getElementById('btn-en');
    
    if (lang === 'ar') {
        html.setAttribute('dir', 'rtl');
        html.setAttribute('lang', 'ar');
        btnAr.classList.add('active');
        btnEn.classList.remove('active');
    } else {
        html.setAttribute('dir', 'ltr');
        html.setAttribute('lang', 'en');
        btnEn.classList.add('active');
        btnAr.classList.remove('active');
    }
}

// File Upload Handling
const uploadZone = document.getElementById('upload-zone');
const fileInput = document.getElementById('file-input');
const filePreview = document.getElementById('file-preview');
const fileNameEl = document.getElementById('file-name');
const fileSizeEl = document.getElementById('file-size');
const invoicePreview = document.getElementById('invoice-preview');
const fileRemove = document.getElementById('file-remove');
const processBtn = document.getElementById('process-btn');

let uploadedFile = null;

// Click to upload
uploadZone.addEventListener('click', () => {
    if (!uploadZone.classList.contains('has-file')) {
        fileInput.click();
    }
});

// Drag and drop
uploadZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    uploadZone.classList.add('drag-over');
});

uploadZone.addEventListener('dragleave', () => {
    uploadZone.classList.remove('drag-over');
});

uploadZone.addEventListener('drop', (e) => {
    e.preventDefault();
    uploadZone.classList.remove('drag-over');
    const files = e.dataTransfer.files;
    if (files.length > 0) {
        handleFile(files[0]);
    }
});

// File input change
fileInput.addEventListener('change', (e) => {
    if (e.target.files.length > 0) {
        handleFile(e.target.files[0]);
    }
});

// Handle file
function handleFile(file) {
    // Validate file type
    const validTypes = ['image/jpeg', 'image/png', 'image/jpg', 'application/pdf'];
    if (!validTypes.includes(file.type)) {
        alert(isArabic() ? 'نوع الملف غير مدعوم' : 'File type not supported');
        return;
    }
    
    // Validate file size (10MB max)
    if (file.size > 10 * 1024 * 1024) {
        alert(isArabic() ? 'حجم الملف كبير جداً (الحد الأقصى 10MB)' : 'File too large (max 10MB)');
        return;
    }
    
    uploadedFile = file;
    fileNameEl.textContent = file.name;
    fileSizeEl.textContent = formatFileSize(file.size);
    
    // Show preview
    uploadZone.style.display = 'none';
    filePreview.classList.add('show');
    
    // Update status
    updateStatus('business', 'success', isArabic() ? 'تم رفع الفاتورة' : 'Invoice uploaded');
    document.getElementById('card-business').classList.add('completed');
    
    // Preview image or show PDF placeholder
    if (file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = (e) => {
            invoicePreview.innerHTML = `<img src="${e.target.result}" alt="Invoice Preview">`;
        };
        reader.readAsDataURL(file);
    } else {
        invoicePreview.innerHTML = `
            <div class="pdf-placeholder">
                <i data-lucide="file-text" class="icon icon-3xl" style="color:#a78bfa;"></i>
                <p style="margin-top:0.5rem;font-size:0.8rem;color:#a78bfa;">${file.name}</p>
            </div>
        `;
        lucide.createIcons();
    }
    
    lucide.createIcons();
}

// Remove file
fileRemove.addEventListener('click', (e) => {
    e.stopPropagation();
    resetUpload();
});

function resetUpload() {
    uploadedFile = null;
    fileInput.value = '';
    uploadZone.style.display = 'flex';
    filePreview.classList.remove('show');
    updateStatus('business', 'waiting', isArabic() ? 'في انتظار الفاتورة' : 'Waiting for invoice');
    document.getElementById('card-business').classList.remove('completed');
}

// Process button click - Start the flow
processBtn.addEventListener('click', startProcessing);

async function startProcessing() {
    if (!uploadedFile) return;
    
    console.log('Starting processing...');
    processBtn.disabled = true;
    processBtn.innerHTML = `<span class="spinner"></span> <span class="ar">جاري الإرسال...</span><span class="en">Sending...</span>`;
    
    // Activate arrow 1
    document.getElementById('arrow-1').classList.add('active');
    
    try {
        // Start AI processing
        console.log('Starting AI processing...');
        await processWithAI();
        console.log('AI processing complete');
        
        // Reset button after completion
        processBtn.innerHTML = `<i data-lucide="check-circle" class="icon"></i><span class="ar">تم الإرسال</span><span class="en">Sent Successfully</span>`;
        processBtn.style.background = 'linear-gradient(to right, #34d399, #22d3d1)';
        lucide.createIcons();
    } catch (error) {
        console.error('Processing error:', error);
        processBtn.disabled = false;
        processBtn.innerHTML = `<i data-lucide="alert-circle" class="icon"></i><span class="ar">حدث خطأ - حاول مجدداً</span><span class="en">Error - Try Again</span>`;
        processBtn.style.background = '#ef4444';
        lucide.createIcons();
    }
}

async function processWithAI() {
    console.log('processWithAI started');
    const aiCard = document.getElementById('card-ai');
    const aiAgent = document.getElementById('ai-agent');
    
    if (!aiCard || !aiAgent) {
        throw new Error('AI card elements not found');
    }
    
    aiCard.classList.add('active');
    aiAgent.classList.add('processing');
    updateStatus('ai', 'processing', isArabic() ? 'جاري المعالجة' : 'Processing');
    
    // Update AI message
    updateAIMessage(isArabic() ? 'أقوم الآن بقراءة بيانات الفاتورة...' : 'Reading invoice data...');
    
    // Step 1: Reading invoice
    console.log('Step 1');
    await animateStep(1, 1500);
    updateAIMessage(isArabic() ? 'التحقق من متطلبات زاتكا...' : 'Validating ZATCA requirements...');
    
    // Step 2: Validating
    console.log('Step 2');
    await animateStep(2, 1200);
    updateAIMessage(isArabic() ? 'حساب ضريبة القيمة المضافة...' : 'Calculating VAT...');
    
    // Step 3: Calculating VAT
    console.log('Step 3');
    await animateStep(3, 1000);
    updateAIMessage(isArabic() ? 'إرسال الفاتورة إلى بوابة زاتكا...' : 'Sending invoice to ZATCA portal...');
    
    // Step 4: Sending to ZATCA
    console.log('Step 4');
    await animateStep(4, 800);
    
    // Activate arrow 2
    document.getElementById('arrow-2').classList.add('active');
    
    // Complete AI processing
    aiAgent.classList.remove('processing');
    aiCard.classList.remove('active');
    aiCard.classList.add('completed');
    updateStatus('ai', 'success', isArabic() ? 'اكتملت المعالجة' : 'Processing complete');
    updateAIMessage(isArabic() ? 'تم إرسال الفاتورة بنجاح!' : 'Invoice sent successfully!');
    
    console.log('Calling processZATCA');
    // Start ZATCA processing
    await processZATCA();
    console.log('processZATCA complete');
}

async function animateStep(stepNum, delay) {
    const step = document.getElementById(`step-${stepNum}`);
    step.classList.add('active');
    
    // Add spinner to active step
    const icon = step.querySelector('.step-icon');
    icon.innerHTML = '<span class="spinner" style="width:14px;height:14px;"></span>';
    
    await sleep(delay);
    
    step.classList.remove('active');
    step.classList.add('completed');
    icon.innerHTML = '<i data-lucide="check" class="icon icon-sm"></i>';
    lucide.createIcons();
}

async function processZATCA() {
    const zatcaCard = document.getElementById('card-zatca');
    zatcaCard.classList.add('active');
    updateStatus('zatca', 'processing', isArabic() ? 'جاري التحقق' : 'Verifying');
    
    // Hide waiting, show validation
    await sleep(800);
    document.getElementById('zatca-waiting').style.display = 'none';
    document.getElementById('validation-result').classList.add('show');
    
    // Animate validation results
    const results = document.querySelectorAll('.result-item');
    for (let i = 0; i < results.length; i++) {
        results[i].classList.add('animate-in');
        await sleep(500);
    }
    
    await sleep(800);
    
    // Show approved invoice
    document.getElementById('approved-invoice').classList.add('show');
    
    // Generate random ZATCA ID
    const zatcaId = generateZATCAId();
    document.getElementById('zatca-id').textContent = zatcaId;
    
    // Complete ZATCA
    zatcaCard.classList.remove('active');
    zatcaCard.classList.add('completed');
    updateStatus('zatca', 'success', isArabic() ? 'تمت الموافقة' : 'Approved');
    
    // Show customer delivery options
    await sleep(500);
    document.getElementById('customer-delivery').classList.add('show');
    
    // Show reset section
    document.getElementById('reset-section').style.display = 'block';
    
    lucide.createIcons();
}

// Open invoice in new window with action buttons
function deliverInvoice(method) {
    openInvoiceWindow(method);
}

// Open invoice window with all sharing options
function openInvoiceWindow(highlightMethod = null) {
    const zatcaId = document.getElementById('zatca-id').textContent;
    const fileName = uploadedFile ? uploadedFile.name : 'invoice';
    const approvalDate = new Date().toLocaleDateString('en-CA');
    const approvalTime = new Date().toLocaleTimeString('en-US', { hour12: false });
    
    const invoiceHTML = generateInvoiceWithActions(zatcaId, fileName, approvalDate, approvalTime, highlightMethod);
    
    const invoiceWindow = window.open('', '_blank');
    invoiceWindow.document.write(invoiceHTML);
    invoiceWindow.document.close();
}

// Generate complete invoice HTML with action buttons
function generateInvoiceWithActions(zatcaId, fileName, approvalDate, approvalTime, highlightMethod) {
    const isRTL = isArabic();
    const align = isRTL ? 'right' : 'left';
    const alignOpp = isRTL ? 'left' : 'right';
    
    const emailSubject = encodeURIComponent(isRTL ? `فاتورة معتمدة من زاتكا - ${zatcaId}` : `ZATCA Approved Invoice - ${zatcaId}`);
    const emailBody = encodeURIComponent(isRTL 
        ? `مرحباً،\n\nمرفق فاتورتكم المعتمدة من زاتكا.\n\nرقم الفاتورة: ${zatcaId}\nتاريخ الاعتماد: ${approvalDate}\nالحالة: ✓ معتمدة\n\nيرجى حفظ الفاتورة كـ PDF وإرفاقها.\n\nشكراً لتعاملكم معنا!`
        : `Hello,\n\nPlease find your ZATCA approved invoice.\n\nInvoice ID: ${zatcaId}\nApproval Date: ${approvalDate}\nStatus: ✓ Approved\n\nPlease save the invoice as PDF and attach it.\n\nThank you for your business!`);
    
    const whatsappMsg = encodeURIComponent(isRTL
        ? `مرحباً،\n\nمرفق فاتورتكم المعتمدة من زاتكا.\n\nرقم الفاتورة: ${zatcaId}\nتاريخ الاعتماد: ${approvalDate}\nالحالة: ✓ معتمدة\n\nيرجى حفظ الفاتورة كـ PDF من المتصفح وإرفاقها.`
        : `Hello,\n\nPlease find your ZATCA approved invoice.\n\nInvoice ID: ${zatcaId}\nApproval Date: ${approvalDate}\nStatus: ✓ Approved\n\nPlease save invoice as PDF from browser and attach.`);

    return `<!DOCTYPE html>
<html lang="${isRTL ? 'ar' : 'en'}" dir="${isRTL ? 'rtl' : 'ltr'}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${isRTL ? 'فاتورة معتمدة من زاتكا' : 'ZATCA Approved Invoice'} - ${zatcaId}</title>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: '${isRTL ? 'Tajawal' : 'Inter'}', Arial, sans-serif; background: #f1f5f9; min-height: 100vh; }
        .invoice-container { max-width: 800px; margin: 20px auto; background: white; box-shadow: 0 4px 20px rgba(0,0,0,0.1); border-radius: 12px; overflow: hidden; }
        .approved-banner { background: linear-gradient(135deg, #059669, #10b981); color: white; padding: 15px; text-align: center; font-weight: bold; font-size: 18px; }
        .header { background: linear-gradient(135deg, #059669, #10b981); color: white; padding: 25px; display: flex; justify-content: space-between; align-items: flex-start; }
        .company-info h1 { font-size: 1.5rem; margin-bottom: 8px; }
        .company-info p { font-size: 0.9rem; opacity: 0.9; margin: 2px 0; }
        .invoice-title { text-align: ${alignOpp}; }
        .invoice-title h2 { font-size: 1.75rem; }
        .invoice-id { background: rgba(255,255,255,0.2); padding: 8px 15px; border-radius: 6px; font-size: 0.8rem; margin-top: 10px; display: inline-block; }
        .content { padding: 25px; }
        .zatca-section { border: 2px solid #10b981; border-radius: 12px; padding: 20px; margin-bottom: 25px; background: linear-gradient(135deg, rgba(5,150,105,0.05), rgba(16,185,129,0.1)); display: flex; gap: 20px; }
        .qr-code { width: 100px; height: 100px; background: repeating-conic-gradient(#000 0% 25%, #fff 0% 50%) 50%/8px 8px; border: 1px solid #ccc; border-radius: 8px; flex-shrink: 0; }
        .zatca-details h3 { color: #059669; font-size: 1.1rem; margin-bottom: 15px; }
        .zatca-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dashed #e2e8f0; font-size: 0.9rem; }
        .zatca-row:last-child { border-bottom: none; }
        .zatca-label { color: #64748b; }
        .zatca-value { color: #059669; font-weight: 600; font-family: monospace; }
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px; }
        .info-box { background: #f8fafc; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0; }
        .info-box h4 { font-size: 0.7rem; text-transform: uppercase; color: #64748b; margin-bottom: 8px; letter-spacing: 0.05em; }
        .info-box .name { font-weight: 700; color: #059669; margin-bottom: 5px; }
        .info-box p { font-size: 0.85rem; margin: 3px 0; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 25px; }
        th { background: #059669; color: white; padding: 12px; text-align: ${align}; font-size: 0.85rem; }
        th:last-child { text-align: ${alignOpp}; }
        td { padding: 12px; border-bottom: 1px solid #e2e8f0; font-size: 0.9rem; }
        td:last-child { text-align: ${alignOpp}; }
        tr:nth-child(even) { background: #f8fafc; }
        .totals { margin-${isRTL ? 'right' : 'left'}: auto; width: 280px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 15px; }
        .total-row { display: flex; justify-content: space-between; padding: 8px 0; font-size: 0.9rem; }
        .total-row.grand { border-top: 2px solid #059669; margin-top: 10px; padding-top: 12px; font-size: 1.1rem; font-weight: 700; color: #059669; }
        .footer { background: #f0fdf4; padding: 20px; border-top: 2px solid #10b981; text-align: center; }
        .footer p { color: #059669; font-size: 0.9rem; }
        .verification { font-family: monospace; background: white; padding: 8px 20px; border-radius: 6px; display: inline-block; margin-top: 10px; border: 1px solid #10b981; font-size: 0.85rem; }
        
        /* Action Buttons */
        .action-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #1e293b; padding: 15px 20px; display: flex; justify-content: center; gap: 15px; box-shadow: 0 -4px 20px rgba(0,0,0,0.2); z-index: 100; }
        .action-btn { display: flex; align-items: center; gap: 8px; padding: 12px 24px; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; border: none; transition: all 0.3s; text-decoration: none; }
        .action-btn.pdf { background: #059669; color: white; }
        .action-btn.pdf:hover { background: #047857; transform: translateY(-2px); }
        .action-btn.email { background: #ef4444; color: white; }
        .action-btn.email:hover { background: #dc2626; transform: translateY(-2px); }
        .action-btn.whatsapp { background: #22c55e; color: white; }
        .action-btn.whatsapp:hover { background: #16a34a; transform: translateY(-2px); }
        .action-btn.highlight { animation: pulse 1s ease-in-out 3; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        
        .spacer { height: 100px; }
        
        @media print {
            body { background: white; }
            .action-bar { display: none !important; }
            .spacer { display: none; }
            .invoice-container { box-shadow: none; margin: 0; border-radius: 0; }
        }
        @page { size: A4; margin: 10mm; }
    </style>
</head>
<body>
    <div class="invoice-container">
        <div class="approved-banner">✓ ${isRTL ? 'فاتورة معتمدة من هيئة الزكاة والضريبة والجمارك' : 'Invoice Approved by ZATCA'}</div>
        
        <div class="header">
            <div class="company-info">
                <h1>${isRTL ? '🏢 شركة العرض التجريبي' : '🏢 Demo Business Company'}</h1>
                <p>${isRTL ? 'شارع الملك فهد، الرياض 12345' : 'King Fahd Road, Riyadh 12345'}</p>
                <p>${isRTL ? 'هاتف' : 'Phone'}: +966 11 123 4567</p>
                <p style="margin-top:10px;"><strong>${isRTL ? 'الرقم الضريبي' : 'VAT Number'}:</strong> 300123456789012</p>
            </div>
            <div class="invoice-title">
                <h2>${isRTL ? 'فاتورة ضريبية' : 'Tax Invoice'}</h2>
                <div class="invoice-id">${zatcaId}</div>
            </div>
        </div>
        
        <div class="content">
            <div class="zatca-section">
                <div class="qr-code"></div>
                <div class="zatca-details">
                    <h3>🛡️ ${isRTL ? 'بيانات الاعتماد من زاتكا' : 'ZATCA Approval Details'}</h3>
                    <div class="zatca-row"><span class="zatca-label">${isRTL ? 'معرّف الفاتورة' : 'Invoice ID'}</span><span class="zatca-value">${zatcaId}</span></div>
                    <div class="zatca-row"><span class="zatca-label">${isRTL ? 'تاريخ الاعتماد' : 'Approval Date'}</span><span class="zatca-value">${approvalDate}</span></div>
                    <div class="zatca-row"><span class="zatca-label">${isRTL ? 'وقت الاعتماد' : 'Approval Time'}</span><span class="zatca-value">${approvalTime}</span></div>
                    <div class="zatca-row"><span class="zatca-label">${isRTL ? 'الحالة' : 'Status'}</span><span class="zatca-value">✓ ${isRTL ? 'معتمدة' : 'APPROVED'}</span></div>
                </div>
            </div>
            
            <div class="info-grid">
                <div class="info-box">
                    <h4>${isRTL ? 'معلومات العميل' : 'Customer Info'}</h4>
                    <div class="name">${isRTL ? 'شركة العميل للتجارة' : 'Customer Trading Co.'}</div>
                    <p>${isRTL ? 'الرياض، المملكة العربية السعودية' : 'Riyadh, Saudi Arabia'}</p>
                    <p>${isRTL ? 'الرقم الضريبي' : 'VAT'}: 310987654321098</p>
                </div>
                <div class="info-box">
                    <h4>${isRTL ? 'تفاصيل الفاتورة' : 'Invoice Details'}</h4>
                    <p><strong>${isRTL ? 'التاريخ' : 'Date'}:</strong> ${approvalDate}</p>
                    <p><strong>${isRTL ? 'الملف الأصلي' : 'Original File'}:</strong> ${fileName}</p>
                </div>
            </div>
            
            <table>
                <thead>
                    <tr>
                        <th>${isRTL ? 'الوصف' : 'Description'}</th>
                        <th style="text-align:center;width:80px;">${isRTL ? 'الكمية' : 'Qty'}</th>
                        <th style="text-align:center;width:100px;">${isRTL ? 'السعر' : 'Price'}</th>
                        <th style="width:120px;">${isRTL ? 'المجموع' : 'Total'}</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>${isRTL ? 'خدمات استشارية' : 'Consulting Services'}</td><td style="text-align:center;">1</td><td style="text-align:center;">10,000.00</td><td>10,000.00</td></tr>
                    <tr><td>${isRTL ? 'خدمات تقنية' : 'Technical Services'}</td><td style="text-align:center;">2</td><td style="text-align:center;">2,500.00</td><td>5,000.00</td></tr>
                    <tr><td>${isRTL ? 'دعم فني' : 'Technical Support'}</td><td style="text-align:center;">1</td><td style="text-align:center;">900.00</td><td>900.00</td></tr>
                </tbody>
            </table>
            
            <div class="totals">
                <div class="total-row"><span>${isRTL ? 'المجموع الفرعي' : 'Subtotal'}</span><span>15,900.00 ${isRTL ? 'ر.س' : 'SAR'}</span></div>
                <div class="total-row"><span>${isRTL ? 'ضريبة القيمة المضافة' : 'VAT'} (15%)</span><span>2,385.00 ${isRTL ? 'ر.س' : 'SAR'}</span></div>
                <div class="total-row grand"><span>${isRTL ? 'الإجمالي' : 'Grand Total'}</span><span>18,285.00 ${isRTL ? 'ر.س' : 'SAR'}</span></div>
            </div>
        </div>
        
        <div class="footer">
            <p>${isRTL ? 'تم اعتماد هذه الفاتورة إلكترونياً من قبل هيئة الزكاة والضريبة والجمارك' : 'This invoice has been electronically approved by ZATCA'}</p>
            <div class="verification">${isRTL ? 'رمز التحقق' : 'Verification'}: ${zatcaId.split('-').pop()}</div>
        </div>
    </div>
    
    <div class="spacer"></div>
    
    <!-- Action Bar -->
    <div class="action-bar">
        <button class="action-btn pdf" onclick="window.print()">
            📄 ${isRTL ? 'حفظ كـ PDF' : 'Save as PDF'}
        </button>
        <a class="action-btn email ${highlightMethod === 'email' ? 'highlight' : ''}" href="mailto:?subject=${emailSubject}&body=${emailBody}">
            ✉️ ${isRTL ? 'إرسال بالبريد' : 'Send Email'}
        </a>
        <a class="action-btn whatsapp ${highlightMethod === 'whatsapp' ? 'highlight' : ''}" href="https://wa.me/?text=${whatsappMsg}" target="_blank">
            💬 ${isRTL ? 'إرسال واتساب' : 'Send WhatsApp'}
        </a>
    </div>
</body>
</html>`;
}


// Download Approved Invoice - opens invoice page with action buttons
document.getElementById('download-btn').addEventListener('click', function() {
    openInvoiceWindow();
});

function resetDemo() {
    // Reset all states
    uploadedFile = null;
    fileInput.value = '';
    
    // Reset upload section
    uploadZone.style.display = 'flex';
    filePreview.classList.remove('show');
    processBtn.disabled = false;
    processBtn.innerHTML = `<i data-lucide="send" class="icon"></i><span class="ar">إرسال للمعالجة</span><span class="en">Send for Processing</span>`;
    
    // Reset cards
    const cards = document.querySelectorAll('.demo-card');
    cards.forEach(card => card.classList.remove('active', 'completed'));
    
    // Reset arrows
    document.querySelectorAll('.flow-arrow').forEach(arrow => arrow.classList.remove('active'));
    
    // Reset statuses
    updateStatus('business', 'waiting', isArabic() ? 'في انتظار الفاتورة' : 'Waiting for invoice');
    updateStatus('ai', 'waiting', isArabic() ? 'في انتظار البيانات' : 'Waiting for data');
    updateStatus('zatca', 'waiting', isArabic() ? 'في الانتظار' : 'Waiting');
    
    // Reset AI section
    document.getElementById('ai-agent').classList.remove('processing');
    updateAIMessage(isArabic() ? 'ارفع فاتورتك وسأقوم بالتحقق منها وإرسالها لزاتكا' : 'Upload your invoice and I\'ll validate it and send to ZATCA');
    document.getElementById('ai-status-text').innerHTML = `<span class="ar">جاهز للمعالجة</span><span class="en">Ready to Process</span>`;
    
    // Reset processing steps
    for (let i = 1; i <= 4; i++) {
        const step = document.getElementById(`step-${i}`);
        step.classList.remove('active', 'completed');
    }
    
    // Reset ZATCA section
    document.getElementById('zatca-waiting').style.display = 'block';
    document.getElementById('validation-result').classList.remove('show');
    document.getElementById('approved-invoice').classList.remove('show');
    document.getElementById('customer-delivery').classList.remove('show');
    
    // Hide reset section
    document.getElementById('reset-section').style.display = 'none';
    
    lucide.createIcons();
}

// Helper functions
function updateStatus(section, type, text) {
    const badge = document.getElementById(`status-${section}`);
    badge.className = `status-badge ${type}`;
    badge.innerHTML = text;
}

function updateAIMessage(message) {
    document.getElementById('ai-message').textContent = message;
}

function isArabic() {
    return document.getElementById('html-root').getAttribute('lang') === 'ar';
}

function formatFileSize(bytes) {
    if (bytes < 1024) return bytes + ' B';
    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
    return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
}

function generateZATCAId() {
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    let id = 'INV-2026-ZATCA-';
    for (let i = 0; i < 12; i++) {
        id += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return id;
}

function sleep(ms) {
    return new Promise(resolve => setTimeout(resolve, ms));
}

// Initialize Lucide icons
lucide.createIcons();
</script>

</body>
</html>
